import{d as H,r as h,I as W,J as O,o as A,x as d,y as m,z as a,K as S,L as I,M as F,A as r,N as M,O as z,P as J,_ as q}from"./PIpq5hpi.js";import{normalizeGithubRepoUrl as K,parseGitHubUrl as V,getRepoZip as P}from"./DEcQ07UY.js";import{isAllowedExtension as x,convertToJson as Q}from"./Czx6p1fB.js";import{GameSystemFiles as j}from"./Ct-5TeT_.js";import"./CDRs11_G.js";import"./lvShBcCt.js";import"./C4ErDbKS.js";const Z={class:"container"},X={class:"input-section"},Y={class:"repo-grid"},ee=["onClick"],te={class:"repo-icon"},se={class:"repo-info"},ae={class:"repo-url"},oe={key:0,class:"input-section"},le={class:"repo-grid"},ie=["onClick"],ne={class:"repo-info"},re=["onClick"],ce={class:"input-section"},ue={class:"input-group"},de=["disabled"],me={class:"input-section input-folder"},pe={class:"input-group"},he=["disabled"],fe={key:1,class:"error"},ye={key:2,class:"success"},ge=H({__name:"index",setup(ve){const y=h(""),w=h(),i=h(!1),u=h(""),g=h(null),f=W(),R=O(),c=new j,_=h([{name:"NewRecruit",description:"NewRecruit application interface strings",url:"newrecruit",displayUrl:"newrecruit",isTranslationSource:!0},{name:"Warhammer 40k 10th Edition",description:"Official Warhammer 40,000 10th Edition rules",url:"https://github.com/BSData/wh40k-10e",displayUrl:"BSData/wh40k-10e"},{name:"Warhammer 40k 9th Edition",description:"Warhammer 40,000 9th Edition rules",url:"https://github.com/BSData/wh40k-9e",displayUrl:"BSData/wh40k-9e"},{name:"Age of Sigmar 4.0",description:"Warhammer Age of Sigmar rules",url:"https://github.com/BSData/age-of-sigmar-4th",displayUrl:"BSData/age-of-sigmar-4th"},{name:"Kill Team (2024)",description:"Warhammer 40k Kill Team rules",url:"https://github.com/BSData/wh40k-killteam",displayUrl:"BSData/wh40k-killteam"},{name:"Horus Heresy (2022)",description:"Horus Heresy (2022) game rules",url:"https://github.com/BSData/horus-heresy-2nd-edition",displayUrl:"BSData/horus-heresy-2nd-edition"},{name:"Trench Crusade",description:"Trench Crusade game rules",url:"https://github.com/Fawkstrot11/TrenchCrusade",displayUrl:"Fawkstrot11/TrenchCrusade"}]),n=h([]),D=()=>{w.value?.click()},k=async t=>{for(const{path:s,content:l}of t)try{const o=await Q(l,s);o.gameSystem?(await c.setSystem(o),g.value={name:o.gameSystem.name}):o.catalogue&&await c.setCatalogue(o)}catch(o){console.error(`Failed to process file ${s}:`,o)}if(!g.value)throw new Error("No game system found in files");globalThis.system=c,console.log("loaded",c.gameSystem?.gameSystem?.name??"Unknown System");const e=y.value?.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(e){const s=`${e[1]}/${e[2]}`;await f.push(`/languages/${encodeURIComponent(s)}`)}else{const s=c.gameSystem?.gameSystem?.id;s?await f.push(`/languages/${encodeURIComponent(s)}`):await f.push("/")}},b=async()=>{u.value="",i.value=!0;try{const t=K(y.value);if(!t)throw new Error("Invalid GitHub URL format");const{githubOwner:e,githubName:s}=V(t),l=await P(e,s),o=[];for(const[p,v]of l){if(v.isDirectory||!x(p))continue;const G=await v.text();o.push({path:p,content:G})}await k(o)}catch(t){u.value=t.message||"Failed to load from GitHub"}finally{i.value=!1}},B=async t=>{u.value="",i.value=!0;try{const e=t.target,s=Array.from(e.files||[]);if(s.length===0)throw new Error("No files selected");const l=[];for(const o of s){if(!x(o.name))continue;const p=await o.text();l.push({path:o.name,content:p})}await k(l),await E(c)}catch(e){u.value=e.message||"Failed to load local files"}finally{i.value=!1}},U=async t=>{if(t.isTranslationSource){const e=t.displayUrl;await f.push(`/languages/${encodeURIComponent(e)}`)}else{const e=t.displayUrl;await f.push(`/languages/${encodeURIComponent(e)}`)}},C=async t=>{i.value=!0,u.value="";try{if(t.data.gameSystem&&(await c.setSystem(t.data.gameSystem),g.value={name:t.name}),t.data.catalogues)for(const e of t.data.catalogues)await c.setCatalogue(e);globalThis.system=c,await f.push(`/languages/${encodeURIComponent(t.id)}`)}catch(e){u.value=e.message||"Failed to load local system"}finally{i.value=!1}},T=t=>{const e=n.value.findIndex(s=>s.id===t);e!==-1&&(n.value.splice(e,1),L())},E=async t=>{if(!t.gameSystem)return;const e={gameSystem:t.gameSystem,catalogues:Object.values(t.catalogueFiles)},s=t.gameSystem.gameSystem.id,l=t.gameSystem.gameSystem.name,o=n.value.findIndex(v=>v.id===s),p={id:s,name:l,description:"Uploaded from local files",data:e};o!==-1?n.value[o]=p:n.value.push(p),L()},L=()=>{localStorage.setItem("nr-translation-local-systems",JSON.stringify(n.value))},N=()=>{try{const t=localStorage.getItem("nr-translation-local-systems");t&&(n.value=JSON.parse(t))}catch(t){console.error("Failed to load local systems:",t)}},$=async()=>{const t=R.query.system;if(!t)return;const e=n.value.find(l=>l.id===t);if(e){await C(e);return}const s=_.value.find(l=>l.url.includes(t)||l.displayUrl===t);if(s){await U(s);return}t.startsWith("http")&&(y.value=t,await b())};return A(()=>{N(),$()}),(t,e)=>(m(),d("div",Z,[e[7]||(e[7]=a("h1",null,"Load Game System",-1)),a("div",X,[e[1]||(e[1]=a("h2",null,"Quick Select",-1)),a("div",Y,[(m(!0),d(I,null,F(_.value,s=>(m(),d("div",{key:s.url,class:"repo-card",onClick:l=>U(s)},[a("div",te,r(s.isTranslationSource?"🌐":"📁"),1),a("div",se,[a("h3",null,r(s.name),1),a("p",null,r(s.description),1),a("span",ae,r(s.displayUrl),1)])],8,ee))),128))])]),n.value.length>0?(m(),d("div",oe,[e[4]||(e[4]=a("h2",null,"Local Systems",-1)),a("div",le,[(m(!0),d(I,null,F(n.value,s=>(m(),d("div",{key:s.id,class:"repo-card local",onClick:l=>C(s)},[e[3]||(e[3]=a("div",{class:"repo-icon"},"💾",-1)),a("div",ne,[a("h3",null,r(s.name),1),a("p",null,r(s.description||"Local system"),1),e[2]||(e[2]=a("span",{class:"repo-url"},"Local",-1))]),a("button",{onClick:M(l=>T(s.id),["stop"]),class:"remove-btn"},"×",8,re)],8,ie))),128))])])):S("",!0),a("div",ce,[e[5]||(e[5]=a("h2",null,"Load from GitHub Repository",-1)),a("div",ue,[z(a("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),type:"text",placeholder:"https://github.com/user/repo",class:"url-input"},null,512),[[J,y.value]]),a("button",{onClick:b,disabled:i.value},r(i.value?"Loading...":"Load from GitHub"),9,de)])]),a("div",me,[e[6]||(e[6]=a("h2",null,"Load from Local Folder",-1)),a("div",pe,[a("input",{type:"file",ref_key:"folderInput",ref:w,webkitdirectory:"",directory:"",multiple:"",onChange:B,class:"file-input"},null,544),a("button",{onClick:D,disabled:i.value},r(i.value?"Loading...":"Select Folder"),9,he)])]),u.value?(m(),d("div",fe,r(u.value),1)):S("",!0),g.value?(m(),d("div",ye," Loaded: "+r(g.value.name),1)):S("",!0)]))}}),Le=q(ge,[["__scopeId","data-v-7f53a72b"]]);export{Le as default};
//# sourceMappingURL=wQrc8hzs.js.map
