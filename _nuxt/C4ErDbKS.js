import{k as d,c as G}from"./CDRs11_G.js";const k={catalogueLinks:{type:"catalogueLink"},publications:{type:"publication"},costs:{type:"cost"},costTypes:{allowedChildrens:["modifiers"],type:"costType"},costLimits:{type:"costLimit"},profileTypes:{allowedChildrens:["characteristicTypes","attributeTypes"],type:"profileType"},characteristicTypes:{type:"characteristicType"},characteristics:{type:"characteristic"},attributeTypes:{type:"attributeType"},attributes:{type:"attribute"},categoryEntries:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"],type:"categoryEntry"},categoryLinks:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"],type:"categoryLink"},categories:{type:"category"},forceEntries:{allowedChildrens:["forceEntries","categoryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","costs"],type:"forceEntry"},forces:{type:"force"},selections:{type:"selection"},entryLinks:{allowedChildrens:"type",type:"entryLink"},selectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntryGroup"},sharedSelectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntryGroup"},selectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntry"},sharedSelectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntry"},associations:{type:"association"},sharedRules:{allowedChildrens:["modifiers","modifierGroups"],type:"rule"},rules:{allowedChildrens:["modifiers","modifierGroups"],type:"rule"},profiles:{allowedChildrens:["modifiers","modifierGroups","characteristics","attributes"],type:"profile"},sharedProfiles:{allowedChildrens:["modifiers","modifierGroups","characteristics","attributes"],type:"profile"},infoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"],type:"infoGroup"},sharedInfoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"],type:"infoGroup"},infoLinks:{allowedChildrens:"type",type:"infoLink"},modifiers:{allowedChildrens:["conditions","conditionGroups","localConditionGroups","repeats"],type:"modifier"},modifierGroups:{allowedChildrens:["modifiers","modifierGroups","conditions","conditionGroups","localConditionGroups","repeats"],type:"modifierGroup"},repeats:{allowedChildrens:[],type:"repeat"},conditions:{allowedChildrens:[],type:"condition"},constraints:{allowedChildrens:[],type:"constraint"},conditionGroups:{allowedChildrens:["conditions","conditionGroups","localConditionGroups"],type:"conditionGroup"},localConditionGroups:{allowedChildrens:["conditions","conditionGroups"],type:"localConditionGroup"},catalogue:{allowedChildrens:["catalogueLinks","publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]},gameSystem:{allowedChildrens:["publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]}},L=["modifiers","modifierGroups","constraints","entryLinks","categoryLinks","selectionEntries","selectionEntryGroups","infoLinks","infoGroups","rules","profiles"],h=new Set([...Object.keys(k).filter(s=>s.endsWith("s"))]);function R(s){if(s.isCatalogue&&s.isCatalogue())return s;if(s.gameSystem)return s.gameSystem;if(s.catalogue)return s.catalogue;throw Error("getDataObject data argument is not a valid system or catalogue")}class f{id;type;subType;shared;import;collective;comment;publicationId;typeName;typeId;categoryEntryId;name;hidden;value;page;defaultAmount;profiles;rules;infoLinks;infoGroups;publications;costs;selectionEntries;selectionEntryGroups;entryLinks;profileTypes;categoryEntries;categoryLinks;forceEntries;sharedSelectionEntryGroups;sharedSelectionEntries;sharedProfiles;sharedRules;sharedInfoGroups;target;modifiers;modifierGroups;constraints;conditions;conditionGroups;localConditionGroups;catalogue;extra_constraints;childs;loaded;collective_recursive;limited_to_one;associations;associationConstraints;flatten;collapsible;sortIndex;alias;noindex;constructor(e){return Object.setPrototypeOf(e,Object.getPrototypeOf(this))}get url(){return"%{main_catalogue|catalogue}/%{id}/%{getName}"}process(){this.loaded||(this.collective_recursive=this.isCollectiveRecursive(),this.limited_to_one=!this.canAmountBeAbove1(),this.loaded=!0)}toJson(){return w(this)}getCatalogue(){return this.catalogue}getGameSystem(){return this.getCatalogue().getGameSystem()}get[Symbol.toStringTag](){return globalThis.isEditor?"Object":"ObjectNoObserve"}isGroup(){return!1}isForce(){return!1}isCatalogue(){return!1}isLink(){return!1}isCategory(){return!1}isRoster(){return!1}isQuantifiable(){return!1}isEntry(){return!1}isIdUnique(){return!1}isRule(){return!1}isProfile(){return!1}isInfoGroup(){return!1}isUnit(){for(const e of this.categoryLinks||[])if(e.primary)return!0;return!1}getId(){return this.id}getType(){return this.subType??this.type}getTypeName(){return this.typeName}getCategoryEntryId(){return this.categoryEntryId}getHidden(){return this.hidden}getPage(){return this.page}getName(){return this.name??""}getDefaultAmount(){return this.defaultAmount}isCollective(){return this.collective}isCollapsible(){return this.collapsible}isCollectiveRecursive(){const e=[...this.selectionsIterator()];for(;e.length;){const t=e.pop();if(!t.isCollective()&&!t.isGroup())return!1;e.push(...t.selectionsIterator())}return!0}isEmptyNode(){for(const e of L)if(this[e]!==void 0)return!1;return!0}*forcesIterator(){}*associationsIterator(){this.associations&&(yield*this.associations)}*profilesIterator(){for(const e of y(this))e.profiles&&(yield*e.profiles),e.infoLinks&&(yield*e.infoLinks?.filter(t=>t.type==="profile").map(t=>t.target))}*rulesIterator(){for(const e of y(this))e.rules&&(yield*e.rules),e.infoLinks&&(yield*e.infoLinks?.filter(t=>t.type==="rule").map(t=>t.target))}*constraintsIterator(){this.constraints&&(yield*this.constraints)}*extraConstraintsIterator(){this.extra_constraints&&(yield*this.extra_constraints)}*modifierGroupsIterator(){this.modifierGroups&&(yield*this.modifierGroups)}*modifiersIterator(){this.modifiers&&(yield*this.modifiers)}*modifierGroupsIteratorRecursive(){yield this,this.isLink()&&(yield this.target);for(const e of this.modifierGroupsIterator())yield e,yield*p(e.modifierGroups)}*selectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*localSelectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*nodesIterator(){this.isLink()&&(yield*this.target.nodesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.isLink()&&(yield*this.target.entriesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks),this.childs&&(yield*this.childs)}*iterateSelectionEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateSelectionEntriesWithRoot(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*iterateAllRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*categoryLinksIterator(){this.categoryLinks&&(yield*this.categoryLinks)}*infoLinksIterator(){this.infoLinks&&(yield*this.infoLinks)}*infoGroupsIterator(){this.infoGroups&&(yield*this.infoGroups)}*infoRulesIterator(){this.rules&&(yield*this.rules)}*infoProfilesIterator(){this.profiles&&(yield*this.profiles)}forEachCond(e,t=0){if(e(this,0)===void 0)for(const r of this.selectionsIterator())r.forEachCond(e,t+1)}forEach(e){e(this);for(const t of this.selectionsIterator())t.forEach(e)}forEachNode(e){e(this);for(const t of this.nodesIterator())t.forEachNode(e)}forEachNodeCb(e){const t=[this],r=new Set;for(;t.length;){const i=t.pop();if(!r.has(i.id)){if(r.add(i.id),e(i),i.childs){t.push(...i.childs);continue}if(i.target){const n=i.target;n.selectionEntries&&t.push(...n.selectionEntries),n.selectionEntryGroups&&t.push(...n.selectionEntryGroups),n.entryLinks&&t.push(...n.entryLinks)}i.selectionEntries&&t.push(...i.selectionEntries),i.selectionEntryGroups&&t.push(...i.selectionEntryGroups),i.entryLinks&&t.push(...i.entryLinks)}}}forEachObject(e,t=h,r){let i=[this],n=[],a=0;for(;i.length;){for(;i.length;){const l=i.pop();for(const o in l){const c=l[o];if(t.has(o)&&d(c))if(Array.isArray(c)){if(c.length&&d(c[0]))for(let u=0;u<c.length;u++){const I=c[u];e(I,l)!==!1&&n.push(I)}}else e(c,l)!==!1&&n.push(c)}}if(i=n,n=[],a++,r&&a>=r)break}}forEachObjectWhitelist(e,t=h,r){return this.forEachObject(e,t,r)}findOption(e){for(const t of this.selectionsIterator())if(e(t))return t}findOptionRecursive(e){const t=[...this.selectionsIterator()];for(;t.length;){const r=t.pop();if(e(r))return r}}find_recursive(e,t=!1){let r=[this],i=[];for(;r.length;){for(;r.length;){const n=r.pop();for(const a in n){const l=n[a];if(h.has(a)&&d(l))if(Array.isArray(l)){if(l.length&&d(l[0]))for(let o=0;o<l.length;o++){const c=l[o],u=e(c);if(u)return c;u!==!1&&(i.push(c),c.target&&t&&i.push(c.target))}}else{const o=e(l);if(o)return l;o!==!1&&(i.push(l),l.target&&t&&i.push(l.target))}}}r=i,i=[]}}find(e,t=!1){let r=[this],i=[],n=!0;for(;r.length;){for(;r.length;){const a=r.pop();for(const l in a){const o=a[l];if(h.has(l)&&d(o))if(Array.isArray(o)){if(o.length&&d(o[0]))for(let c=0;c<o.length;c++){const u=o[c];if(e(u))return u;i.push(u),u.target&&t&&i.push(u.target)}}else{if(e(o))return o;i.push(o),o.target&&t&&i.push(o.target)}}}if(!n)return;n=!1,r=i,i=[]}}getCosts(){return this.costs||[]}getPrimaryCategory(){for(const e of this.categoryLinks||[])if(e.primary)return e.targetId;return this.getCategoryEntryId()??E}getPrimaryCategoryLink(){for(const e of this.categoryLinks||[])if(e.primary)return e}getPackedConstraint(e){const t=Object.assign({},e);t.name=this.getName(),t.parent=this;const r=e.shared||this instanceof C;t.childId=this.isLink()&&r?this.targetId:this.id,t.modifiers=[];for(const i of this.modifiersIterator())(i.field===e.id||i.field==="hidden"&&e.type==="min"&&!this.isCategory())&&t.modifiers.push(i);t.modifierGroups=[];for(const i of this.modifierGroupsIterator())e:for(const n of p([i]))for(const a of n.modifiers||[])if(a.field===e.id||a.field==="hidden"&&e.type==="min"&&!this.isCategory()){t.modifierGroups.push(i);break e}return t}getBoundConstraint(e){const t=this.getPackedConstraint(e);return t.scope="self",t}getChildBoundConstraints(e){const t=[];for(const r of this.selectionsIterator())if(!(e&&r.isGroup())){for(const i of r.constraintsIterator())(i.type==="min"||i.type==="exactly")&&i.scope==="parent"&&t.push(r.getBoundConstraint(i));r.isGroup()&&t.push(...r.getChildBoundConstraints())}return t}canAmountBeAbove1(){const e=b(this.constraintsIterator(),[...this.modifierGroupsIterator(),{modifiers:[...this.modifiersIterator()]}]);return!e.length||e.includes(-1)?!0:Math.min(...e)>1}hasOption(e){let t;return this.forEachCond(r=>(r.getName()===e&&(t=!0),t)),!!t}}class S extends f{isEntry(){return!0}isQuantifiable(){return!0}isIdUnique(){return!0}}class N extends f{getDefaultSelectionEntryId(){return this.defaultSelectionEntryId}isGroup(){return!0}isIdUnique(){return!0}}class m extends f{targetId;isLink(){return!0}isGroup(){return this.target?.isGroup()}isCategory(){return this.target?.isCategory()}isQuantifiable(){return this.target?.isQuantifiable()}isEntry(){return this.target?.isEntry()}isIdUnique(){return!1}isProfile(){return this.target?.isProfile()||!1}isRule(){return this.target?.isRule()||!1}isInfoGroup(){return this.target?.isInfoGroup()||!1}isUnit(){if(this.target.isUnit())return!0;for(const e of this.categoryLinks||[])if(e.primary)return!0;return!1}isCollapsible(){return this.collapsible||this.target.collapsible}getId(){return this.targetId}getType(){return this.target?.getType()}getPage(){return this.page||this.target?.page}getHidden(){return this.target.hidden||this.hidden}getDefaultSelectionEntryId(){return this.defaultSelectionEntryId||this.target?.getDefaultSelectionEntryId()}getCategoryEntryId(){return this.categoryEntryId??this.target?.categoryEntryId}get associationConstraints(){return this.target.associationConstraints}getAssociations(){return this.associations||this.target.associations}isCollective(){return super.isCollective()||this.target?.isCollective()}*extraConstraintsIterator(){yield*this.target.extraConstraintsIterator(),yield*super.extraConstraintsIterator()}*associationsIterator(){yield*this.target.associationsIterator(),yield*super.associationsIterator()}*rulesIterator(){yield*this.target.rulesIterator(),yield*super.rulesIterator()}*profilesIterator(){yield*this.target.profilesIterator(),yield*super.profilesIterator()}*constraintsIterator(){this.target&&(yield*this.target.constraintsIterator()),yield*super.constraintsIterator()}*modifierGroupsIterator(){yield*this.target.modifierGroupsIterator(),yield*super.modifierGroupsIterator()}*modifiersIterator(){yield*this.target.modifiersIterator(),yield*super.modifiersIterator()}*selectionsIterator(){yield*this.target.selectionsIterator(),yield*super.selectionsIterator()}*categoryLinksIterator(){yield*this.target.categoryLinksIterator(),yield*super.categoryLinksIterator()}*infoLinksIterator(){yield*this.target.infoLinksIterator(),yield*super.infoLinksIterator()}*infoGroupsIterator(){yield*this.target.infoGroupsIterator(),yield*super.infoGroupsIterator()}*infoRulesIterator(){yield*this.target.infoRulesIterator(),yield*super.infoRulesIterator()}*infoProfilesIterator(){yield*this.target.infoProfilesIterator(),yield*super.infoProfilesIterator()}getDefaultAmount(){return this.defaultAmount===""||this.defaultAmount===void 0?this.target.getDefaultAmount():this.defaultAmount}getName(){return this.target?.name??this.name??""}getPrimaryCategory(){for(const e of this.categoryLinks||[])if(e.primary)return e.targetId;for(const e of this.target?.categoryLinks||[])if(e.primary)return e.targetId;return this.getCategoryEntryId()??E}getPrimaryCategoryLink(){for(const e of this.categoryLinks||[])if(e.primary)return e;for(const e of this.target?.categoryLinks||[])if(e.primary)return e}getCosts(){const e={};if(this.target?.costs)for(const t of this.target.costs)e[t.typeId]=t;if(this.costs)for(const t of this.costs)e[t.typeId]=t;return Object.values(e)}}m.prototype.keyInfoCache={};class _ extends m{getTypeName(){return this.target?.typeName}getTypeId(){return this.target?.typeId}}class C extends m{primary;main_catalogue;get units(){return this.target.units}*selectionsIterator(){yield*this.target.units}isEmpty(){return this.target.isEmpty()}}const E="(No Category)",P="(Illegal Units)";class O extends f{units;main_catalogue;description;isCategory(){return!0}isEmpty(){return!this.units.length}isIdUnique(){return!this.isEmptyNode()}getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description||""}*selectionsIterator(){yield*this.units}}class j extends f{childForcesLabel;categories;forces;main_catalogue;isForce(){return!0}isEntry(){return!0}isIdUnique(){return!0}*infoLinksIterator(){if(this.isForce()){const e=this.main_catalogue;for(const t of e.imports)yield*t.infoLinksIterator();yield*e.infoLinksIterator()}yield*super.infoLinksIterator()}*infoRulesIterator(){if(this.isForce()){const e=this.main_catalogue;for(const t of e.imports)yield*t.infoRulesIterator();yield*e.infoRulesIterator()}yield*super.infoRulesIterator()}*selectionsIterator(){yield*this.categories,this.forces&&(yield*this.forces)}*rulesIterator(){for(const e of y(this))e.rules&&(yield*e.rules),e.infoLinks&&(yield*e.infoLinks?.filter(t=>t.type==="rule").map(t=>t.target));this.main_catalogue&&(yield*this.main_catalogue.rulesIterator())}generateForces(e){const t=[];for(const r of this.forceEntries||[]){const i=G(r);i.main_catalogue=this.main_catalogue;const n=[];for(const a of r.categoryLinks||[])a.targetId in e&&n.push(e[a.targetId]);i.categories=n,this.main_catalogue.index[i.id]=i,t.push(i)}return this.forces=t,t}isEmpty(){for(const e of this.categories)if(!e.isEmpty())return!1;return!0}*forcesIterator(){this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const e of this.forces)yield e,yield*e.forcesIteratorRecursive()}}const g=1/0;function b(s,e){const t=[];function r(i){t.push(i)}for(const i of s){const n=t.length;if(i.field!=="selections"||i.type!=="max")continue;if(i.value>1){r(i.value);continue}let a=i.value;for(const l of p(e))for(const o of l.modifiers||[])if(o.field===i.id){if(o.type==="increment"){if(l.repeats?.length||o.repeats?.length){r(g);continue}if(a+=o.value,a>1){r(a);continue}}if(o.type==="decrement"&&o.value<0){if(l.repeats?.length||o.repeats?.length){r(g);continue}if(a-=o.value,a>1){r(a);continue}}if(o.type==="set"&&o.value>1){if(o.value===-1){r(g);continue}r(o.value)}}n===t.length&&r(a)}return t}class U extends f{}class B extends f{isProfile(){return!0}getTypeName(){return this.typeName}getTypeId(){return this.typeId}isIdUnique(){return!0}}class D extends f{originalValue;getLabel(){return this.catalogue?this.catalogue.findOptionById(this.typeId)?.getName()??this.typeId:this.typeId}getTypeName(){return this.getLabel()}getName(){return`${this.getLabel()} = ${this.$text}`}}class F extends f{isInfoGroup(){return!0}isIdUnique(){return!0}}const q=new Set(["any","model","unit","upgrade","mount","crew","entry","roster","group","force","category"]);class v extends f{}class M extends v{}class W extends f{}class Q extends f{}class V extends f{}class J extends f{getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description||""}isRule(){return!0}isIdUnique(){return!0}}function*y(s){yield s;for(const e of s.infoGroups||[])yield*y(e);for(const e of s.infoLinks||[])e.type==="infoGroup"&&(yield*y(e.target))}function*p(s){if(s)for(const e of s)yield e,yield*p(e.modifierGroups)}const x=new Set([...h,"defaultAmount","id","import","importRootEntries","name","hidden","field","scope","value","percentValue","shared","includeChildSelections","includeChildForces","childId","type","targetId","primary","typeId","collective","$text","page","typeName","defaultSelectionEntryId","revision","battleScribeVersion","authorName","authorContact","authorUrl","library","gameSystemId","gameSystemRevision","xmlns","readme","description","comment","publicationDate","publisher","publisherId","publisherUrl","shortName","repeats","roundUp","defaultCostLimit","publicationId","affects","label","labelMembers","maxAssociationsPerMember","ids","min","max","of","info","flatten","collapsible","sortIndex","subType","arg","position","join","automatic","negative","message","childForcesLabel","affects","alias","noindex","costTypeId","profileTypeId","characteristicTypeId"]);function w(s,e){return JSON.stringify(s,function(r,i){if(!(Array.isArray(i)&&i.length===0)&&(x.has(r)||isFinite(Number(r))||e?.has(r)))return i})}function T(s,e,t=h){for(const r in s)if(t.has(r)){const i=s[r];if(Array.isArray(i)&&i.length&&d(i[0]))for(let n=0;n<i.length;n++){const a=i[n];e(a,s),T(a,e,t)}}}function $(s,e){const t=[];return s.self&&(s.entries||s.forces)&&t.push("self"),s.entries&&t.push("entries"),s.forces&&t.push("forces"),s.recursive&&t.push("recursive"),s.filterBy&&s.filterBy!=="any"&&t.push(e(s.filterBy)),s.affectsWhat&&s.affectsWhat!=="entries"&&t.push(e(s.affectsWhat)),t.join(".")}function H(s){const e=["profiles","constraints","costs","rules","categories"],t=[],r={self:!1,entries:!1,forces:!1,recursive:!1},i=(s||"").split(".");let n="entries";for(let a=0;a<i.length;a++){const l=i[a];if(e.includes(l)){n=i.slice(a).join(".");break}if(l in r){r[l]=!0;continue}t.push(l)}return!r.entries&&!r.forces&&(r.self=!0),{...r,filterBy:t.length?t.join("."):"any",affectsWhat:n}}export{f as B,v as C,S as E,j as F,N as G,P as I,m as L,W as M,B as P,J as R,E as U,Q as a,V as b,M as c,H as d,O as e,T as f,R as g,q as h,h as i,k as j,F as k,D as l,U as m,C as n,_ as o,$ as r};
//# sourceMappingURL=C4ErDbKS.js.map
