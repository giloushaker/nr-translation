import{d as O,r as f,I as T,J as A,o as H,x as d,y as m,z as s,K as S,L as I,M as C,A as c,N as M,O as z,P as J,_ as q}from"./CpzGuEEd.js";import{n as K,p as V,g as P,i as x,G as Q,c as j}from"./hOP14oPP.js";const Z={class:"container"},X={class:"input-section"},Y={class:"repo-grid"},ee=["onClick"],te={class:"repo-info"},ae={class:"repo-url"},se={key:0,class:"input-section"},oe={class:"repo-grid"},le=["onClick"],ne={class:"repo-info"},ie=["onClick"],re={class:"input-section"},ce={class:"input-group"},ue=["disabled"],de={class:"input-section"},me={class:"input-group"},pe=["disabled"],fe={key:1,class:"error"},he={key:2,class:"success"},ge=O({__name:"index",setup(ye){const h=f(""),w=f(),n=f(!1),u=f(""),g=f(null),y=T(),D=A(),r=new Q,b=f([{name:"Warhammer 40k 10th Edition",description:"Official Warhammer 40,000 10th Edition rules",url:"https://github.com/BSData/wh40k-10e",displayUrl:"BSData/wh40k-10e"},{name:"Warhammer 40k 9th Edition",description:"Warhammer 40,000 9th Edition rules",url:"https://github.com/BSData/wh40k",displayUrl:"BSData/wh40k"},{name:"Age of Sigmar",description:"Warhammer Age of Sigmar rules",url:"https://github.com/BSData/warhammer-age-of-sigmar",displayUrl:"BSData/warhammer-age-of-sigmar"},{name:"Kill Team",description:"Warhammer 40k Kill Team rules",url:"https://github.com/BSData/wh40k-killteam",displayUrl:"BSData/wh40k-killteam"},{name:"Blood Bowl",description:"Blood Bowl tabletop game rules",url:"https://github.com/BSData/bloodbowl",displayUrl:"BSData/bloodbowl"},{name:"Necromunda",description:"Necromunda skirmish game rules",url:"https://github.com/BSData/necromunda",displayUrl:"BSData/necromunda"}]),i=f([]),F=()=>{w.value?.click()},k=async t=>{for(const{path:a,content:l}of t)try{const o=await j(l,a);o.gameSystem?(await r.setSystem(o),g.value={name:o.gameSystem.name}):o.catalogue&&await r.setCatalogue(o)}catch(o){console.error(`Failed to process file ${a}:`,o)}if(!g.value)throw new Error("No game system found in files");globalThis.system=r,console.log("loaded",r.gameSystem?.gameSystem?.name??"Unknown System");const e=h.value?.match(/github\.com\/([^\/]+)\/([^\/]+)/);if(e){const a=`${e[1]}/${e[2]}`;await y.push(`/languages/${encodeURIComponent(a)}`)}else{const a=r.gameSystem?.gameSystem?.id;a?await y.push(`/languages/${encodeURIComponent(a)}`):await y.push("/")}},_=async()=>{u.value="",n.value=!0;try{const t=K(h.value);if(!t)throw new Error("Invalid GitHub URL format");const{githubOwner:e,githubName:a}=V(t),l=await P(e,a),o=[];for(const[p,v]of l){if(v.isDirectory||!x(p))continue;const W=await v.text();o.push({path:p,content:W})}await k(o)}catch(t){u.value=t.message||"Failed to load from GitHub"}finally{n.value=!1}},R=async t=>{u.value="",n.value=!0;try{const e=t.target,a=Array.from(e.files||[]);if(a.length===0)throw new Error("No files selected");const l=[];for(const o of a){if(!x(o.name))continue;const p=await o.text();l.push({path:o.name,content:p})}await k(l),await N(r)}catch(e){u.value=e.message||"Failed to load local files"}finally{n.value=!1}},U=async t=>{const e=t.displayUrl;await y.push(`/languages/${encodeURIComponent(e)}`)},L=async t=>{n.value=!0,u.value="";try{if(t.data.gameSystem&&(await r.setSystem(t.data.gameSystem),g.value={name:t.name}),t.data.catalogues)for(const e of t.data.catalogues)await r.setCatalogue(e);globalThis.system=r,await y.push(`/languages/${encodeURIComponent(t.id)}`)}catch(e){u.value=e.message||"Failed to load local system"}finally{n.value=!1}},E=t=>{const e=i.value.findIndex(a=>a.id===t);e!==-1&&(i.value.splice(e,1),B())},N=async t=>{if(!t.gameSystem)return;const e={gameSystem:t.gameSystem,catalogues:Object.values(t.catalogueFiles)},a=t.gameSystem.gameSystem.id,l=t.gameSystem.gameSystem.name,o=i.value.findIndex(v=>v.id===a),p={id:a,name:l,description:"Uploaded from local files",data:e};o!==-1?i.value[o]=p:i.value.push(p),B()},B=()=>{localStorage.setItem("nr-translation-local-systems",JSON.stringify(i.value))},G=()=>{try{const t=localStorage.getItem("nr-translation-local-systems");t&&(i.value=JSON.parse(t))}catch(t){console.error("Failed to load local systems:",t)}},$=async()=>{const t=D.query.system;if(!t)return;const e=i.value.find(l=>l.id===t);if(e){await L(e);return}const a=b.value.find(l=>l.url.includes(t)||l.displayUrl===t);if(a){await U(a);return}t.startsWith("http")&&(h.value=t,await _())};return H(()=>{G(),$()}),(t,e)=>(m(),d("div",Z,[e[8]||(e[8]=s("h1",null,"Load Game System",-1)),s("div",X,[e[2]||(e[2]=s("h2",null,"Quick Select",-1)),s("div",Y,[(m(!0),d(I,null,C(b.value,a=>(m(),d("div",{key:a.url,class:"repo-card",onClick:l=>U(a)},[e[1]||(e[1]=s("div",{class:"repo-icon"},"ðŸ“",-1)),s("div",te,[s("h3",null,c(a.name),1),s("p",null,c(a.description),1),s("span",ae,c(a.displayUrl),1)])],8,ee))),128))])]),i.value.length>0?(m(),d("div",se,[e[5]||(e[5]=s("h2",null,"Local Systems",-1)),s("div",oe,[(m(!0),d(I,null,C(i.value,a=>(m(),d("div",{key:a.id,class:"repo-card local",onClick:l=>L(a)},[e[4]||(e[4]=s("div",{class:"repo-icon"},"ðŸ’¾",-1)),s("div",ne,[s("h3",null,c(a.name),1),s("p",null,c(a.description||"Local system"),1),e[3]||(e[3]=s("span",{class:"repo-url"},"Local",-1))]),s("button",{onClick:M(l=>E(a.id),["stop"]),class:"remove-btn"},"Ã—",8,ie)],8,le))),128))])])):S("",!0),s("div",re,[e[6]||(e[6]=s("h2",null,"Load from GitHub Repository",-1)),s("div",ce,[z(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),type:"text",placeholder:"https://github.com/user/repo",class:"url-input"},null,512),[[J,h.value]]),s("button",{onClick:_,disabled:n.value},c(n.value?"Loading...":"Load from GitHub"),9,ue)])]),s("div",de,[e[7]||(e[7]=s("h2",null,"Load from Local Folder",-1)),s("div",me,[s("input",{type:"file",ref_key:"folderInput",ref:w,webkitdirectory:"",directory:"",multiple:"",onChange:R,class:"file-input"},null,544),s("button",{onClick:F,disabled:n.value},c(n.value?"Loading...":"Select Folder"),9,pe)])]),u.value?(m(),d("div",fe,c(u.value),1)):S("",!0),g.value?(m(),d("div",he," Loaded: "+c(g.value.name),1)):S("",!0)]))}}),we=q(ge,[["__scopeId","data-v-fbc0ebb9"]]);export{we as default};
//# sourceMappingURL=ioIgAaVi.js.map
