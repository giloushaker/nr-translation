var _r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function io(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Qr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Mn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Ki;function so(){return Ki||(Ki=1,function(n,e){(function(r){n.exports=r()})(function(){return function r(s,a,o){function f(g,_){if(!a[g]){if(!s[g]){var w=typeof Qr=="function"&&Qr;if(!_&&w)return w(g,!0);if(c)return c(g,!0);var C=new Error("Cannot find module '"+g+"'");throw C.code="MODULE_NOT_FOUND",C}var y=a[g]={exports:{}};s[g][0].call(y.exports,function(S){var b=s[g][1][S];return f(b||S)},y,y.exports,r,s,a,o)}return a[g].exports}for(var c=typeof Qr=="function"&&Qr,l=0;l<o.length;l++)f(o[l]);return f}({1:[function(r,s,a){var o=r("./utils"),f=r("./support"),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var g,_,w,C,y,S,b,E=[],k=0,A=l.length,L=A,M=o.getTypeOf(l)!=="string";k<l.length;)L=A-k,w=M?(g=l[k++],_=k<A?l[k++]:0,k<A?l[k++]:0):(g=l.charCodeAt(k++),_=k<A?l.charCodeAt(k++):0,k<A?l.charCodeAt(k++):0),C=g>>2,y=(3&g)<<4|_>>4,S=1<L?(15&_)<<2|w>>6:64,b=2<L?63&w:64,E.push(c.charAt(C)+c.charAt(y)+c.charAt(S)+c.charAt(b));return E.join("")},a.decode=function(l){var g,_,w,C,y,S,b=0,E=0,k="data:";if(l.substr(0,k.length)===k)throw new Error("Invalid base64 input, it looks like a data url.");var A,L=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===c.charAt(64)&&L--,l.charAt(l.length-2)===c.charAt(64)&&L--,L%1!=0)throw new Error("Invalid base64 input, bad content length.");for(A=f.uint8array?new Uint8Array(0|L):new Array(0|L);b<l.length;)g=c.indexOf(l.charAt(b++))<<2|(C=c.indexOf(l.charAt(b++)))>>4,_=(15&C)<<4|(y=c.indexOf(l.charAt(b++)))>>2,w=(3&y)<<6|(S=c.indexOf(l.charAt(b++))),A[E++]=g,y!==64&&(A[E++]=_),S!==64&&(A[E++]=w);return A}},{"./support":30,"./utils":32}],2:[function(r,s,a){var o=r("./external"),f=r("./stream/DataWorker"),c=r("./stream/Crc32Probe"),l=r("./stream/DataLengthProbe");function g(_,w,C,y,S){this.compressedSize=_,this.uncompressedSize=w,this.crc32=C,this.compression=y,this.compressedContent=S}g.prototype={getContentWorker:function(){var _=new f(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),w=this;return _.on("end",function(){if(this.streamInfo.data_length!==w.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),_},getCompressedWorker:function(){return new f(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},g.createWorkerFrom=function(_,w,C){return _.pipe(new c).pipe(new l("uncompressedSize")).pipe(w.compressWorker(C)).pipe(new l("compressedSize")).withStreamInfo("compression",w)},s.exports=g},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,s,a){var o=r("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},a.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,s,a){var o=r("./utils"),f=function(){for(var c,l=[],g=0;g<256;g++){c=g;for(var _=0;_<8;_++)c=1&c?3988292384^c>>>1:c>>>1;l[g]=c}return l}();s.exports=function(c,l){return c!==void 0&&c.length?o.getTypeOf(c)!=="string"?function(g,_,w,C){var y=f,S=C+w;g^=-1;for(var b=C;b<S;b++)g=g>>>8^y[255&(g^_[b])];return-1^g}(0|l,c,c.length,0):function(g,_,w,C){var y=f,S=C+w;g^=-1;for(var b=C;b<S;b++)g=g>>>8^y[255&(g^_.charCodeAt(b))];return-1^g}(0|l,c,c.length,0):0}},{"./utils":32}],5:[function(r,s,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(r,s,a){var o=null;o=typeof Promise<"u"?Promise:r("lie"),s.exports={Promise:o}},{lie:37}],7:[function(r,s,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",f=r("pako"),c=r("./utils"),l=r("./stream/GenericWorker"),g=o?"uint8array":"array";function _(w,C){l.call(this,"FlateWorker/"+w),this._pako=null,this._pakoAction=w,this._pakoOptions=C,this.meta={}}a.magic="\b\0",c.inherits(_,l),_.prototype.processChunk=function(w){this.meta=w.meta,this._pako===null&&this._createPako(),this._pako.push(c.transformTo(g,w.data),!1)},_.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},_.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},_.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var w=this;this._pako.onData=function(C){w.push({data:C,meta:w.meta})}},a.compressWorker=function(w){return new _("Deflate",w)},a.uncompressWorker=function(){return new _("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,s,a){function o(y,S){var b,E="";for(b=0;b<S;b++)E+=String.fromCharCode(255&y),y>>>=8;return E}function f(y,S,b,E,k,A){var L,M,j=y.file,te=y.compression,X=A!==g.utf8encode,ue=c.transformTo("string",A(j.name)),ee=c.transformTo("string",g.utf8encode(j.name)),he=j.comment,Ce=c.transformTo("string",A(he)),P=c.transformTo("string",g.utf8encode(he)),Q=ee.length!==j.name.length,m=P.length!==he.length,ie="",Te="",ae="",Pe=j.dir,ce=j.date,Ae={crc32:0,compressedSize:0,uncompressedSize:0};S&&!b||(Ae.crc32=y.crc32,Ae.compressedSize=y.compressedSize,Ae.uncompressedSize=y.uncompressedSize);var Y=0;S&&(Y|=8),X||!Q&&!m||(Y|=2048);var Z=0,Oe=0;Pe&&(Z|=16),k==="UNIX"?(Oe=798,Z|=function(ye,Ke){var Qe=ye;return ye||(Qe=Ke?16893:33204),(65535&Qe)<<16}(j.unixPermissions,Pe)):(Oe=20,Z|=function(ye){return 63&(ye||0)}(j.dosPermissions)),L=ce.getUTCHours(),L<<=6,L|=ce.getUTCMinutes(),L<<=5,L|=ce.getUTCSeconds()/2,M=ce.getUTCFullYear()-1980,M<<=4,M|=ce.getUTCMonth()+1,M<<=5,M|=ce.getUTCDate(),Q&&(Te=o(1,1)+o(_(ue),4)+ee,ie+="up"+o(Te.length,2)+Te),m&&(ae=o(1,1)+o(_(Ce),4)+P,ie+="uc"+o(ae.length,2)+ae);var ke="";return ke+=`
\0`,ke+=o(Y,2),ke+=te.magic,ke+=o(L,2),ke+=o(M,2),ke+=o(Ae.crc32,4),ke+=o(Ae.compressedSize,4),ke+=o(Ae.uncompressedSize,4),ke+=o(ue.length,2),ke+=o(ie.length,2),{fileRecord:w.LOCAL_FILE_HEADER+ke+ue+ie,dirRecord:w.CENTRAL_FILE_HEADER+o(Oe,2)+ke+o(Ce.length,2)+"\0\0\0\0"+o(Z,4)+o(E,4)+ue+ie+Ce}}var c=r("../utils"),l=r("../stream/GenericWorker"),g=r("../utf8"),_=r("../crc32"),w=r("../signature");function C(y,S,b,E){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=b,this.encodeFileName=E,this.streamFiles=y,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}c.inherits(C,l),C.prototype.push=function(y){var S=y.meta.percent||0,b=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(y):(this.bytesWritten+=y.data.length,l.prototype.push.call(this,{data:y.data,meta:{currentFile:this.currentFile,percent:b?(S+100*(b-E-1))/b:100}}))},C.prototype.openedSource=function(y){this.currentSourceOffset=this.bytesWritten,this.currentFile=y.file.name;var S=this.streamFiles&&!y.file.dir;if(S){var b=f(y,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},C.prototype.closedSource=function(y){this.accumulate=!1;var S=this.streamFiles&&!y.file.dir,b=f(y,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),S)this.push({data:function(E){return w.DATA_DESCRIPTOR+o(E.crc32,4)+o(E.compressedSize,4)+o(E.uncompressedSize,4)}(y),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},C.prototype.flush=function(){for(var y=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var b=this.bytesWritten-y,E=function(k,A,L,M,j){var te=c.transformTo("string",j(M));return w.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(k,2)+o(k,2)+o(A,4)+o(L,4)+o(te.length,2)+te}(this.dirRecords.length,b,y,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},C.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},C.prototype.registerPrevious=function(y){this._sources.push(y);var S=this;return y.on("data",function(b){S.processChunk(b)}),y.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),y.on("error",function(b){S.error(b)}),this},C.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},C.prototype.error=function(y){var S=this._sources;if(!l.prototype.error.call(this,y))return!1;for(var b=0;b<S.length;b++)try{S[b].error(y)}catch{}return!0},C.prototype.lock=function(){l.prototype.lock.call(this);for(var y=this._sources,S=0;S<y.length;S++)y[S].lock()},s.exports=C},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,s,a){var o=r("../compressions"),f=r("./ZipFileWorker");a.generateWorker=function(c,l,g){var _=new f(l.streamFiles,g,l.platform,l.encodeFileName),w=0;try{c.forEach(function(C,y){w++;var S=function(A,L){var M=A||L,j=o[M];if(!j)throw new Error(M+" is not a valid compression method !");return j}(y.options.compression,l.compression),b=y.options.compressionOptions||l.compressionOptions||{},E=y.dir,k=y.date;y._compressWorker(S,b).withStreamInfo("file",{name:C,dir:E,date:k,comment:y.comment||"",unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions}).pipe(_)}),_.entriesCount=w}catch(C){_.error(C)}return _}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,s,a){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var f=new o;for(var c in this)typeof this[c]!="function"&&(f[c]=this[c]);return f}}(o.prototype=r("./object")).loadAsync=r("./load"),o.support=r("./support"),o.defaults=r("./defaults"),o.version="3.10.1",o.loadAsync=function(f,c){return new o().loadAsync(f,c)},o.external=r("./external"),s.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,s,a){var o=r("./utils"),f=r("./external"),c=r("./utf8"),l=r("./zipEntries"),g=r("./stream/Crc32Probe"),_=r("./nodejsUtils");function w(C){return new f.Promise(function(y,S){var b=C.decompressed.getContentWorker().pipe(new g);b.on("error",function(E){S(E)}).on("end",function(){b.streamInfo.crc32!==C.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):y()}).resume()})}s.exports=function(C,y){var S=this;return y=o.extend(y||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:c.utf8decode}),_.isNode&&_.isStream(C)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",C,!0,y.optimizedBinaryString,y.base64).then(function(b){var E=new l(y);return E.load(b),E}).then(function(b){var E=[f.Promise.resolve(b)],k=b.files;if(y.checkCRC32)for(var A=0;A<k.length;A++)E.push(w(k[A]));return f.Promise.all(E)}).then(function(b){for(var E=b.shift(),k=E.files,A=0;A<k.length;A++){var L=k[A],M=L.fileNameStr,j=o.resolve(L.fileNameStr);S.file(j,L.decompressed,{binary:!0,optimizedBinaryString:!0,date:L.date,dir:L.dir,comment:L.fileCommentStr.length?L.fileCommentStr:null,unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions,createFolders:y.createFolders}),L.dir||(S.file(j).unsafeOriginalName=M)}return E.zipComment.length&&(S.comment=E.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,s,a){var o=r("../utils"),f=r("../stream/GenericWorker");function c(l,g){f.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(g)}o.inherits(c,f),c.prototype._bindStream=function(l){var g=this;(this._stream=l).pause(),l.on("data",function(_){g.push({data:_,meta:{percent:0}})}).on("error",function(_){g.isPaused?this.generatedError=_:g.error(_)}).on("end",function(){g.isPaused?g._upstreamEnded=!0:g.end()})},c.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},c.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=c},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,s,a){var o=r("readable-stream").Readable;function f(c,l,g){o.call(this,l),this._helper=c;var _=this;c.on("data",function(w,C){_.push(w)||_._helper.pause(),g&&g(C)}).on("error",function(w){_.emit("error",w)}).on("end",function(){_.push(null)})}r("../utils").inherits(f,o),f.prototype._read=function(){this._helper.resume()},s.exports=f},{"../utils":32,"readable-stream":16}],14:[function(r,s,a){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,f){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,f);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,f)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var f=new Buffer(o);return f.fill(0),f},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(r,s,a){function o(j,te,X){var ue,ee=c.getTypeOf(te),he=c.extend(X||{},_);he.date=he.date||new Date,he.compression!==null&&(he.compression=he.compression.toUpperCase()),typeof he.unixPermissions=="string"&&(he.unixPermissions=parseInt(he.unixPermissions,8)),he.unixPermissions&&16384&he.unixPermissions&&(he.dir=!0),he.dosPermissions&&16&he.dosPermissions&&(he.dir=!0),he.dir&&(j=k(j)),he.createFolders&&(ue=E(j))&&A.call(this,ue,!0);var Ce=ee==="string"&&he.binary===!1&&he.base64===!1;X&&X.binary!==void 0||(he.binary=!Ce),(te instanceof w&&te.uncompressedSize===0||he.dir||!te||te.length===0)&&(he.base64=!1,he.binary=!0,te="",he.compression="STORE",ee="string");var P=null;P=te instanceof w||te instanceof l?te:S.isNode&&S.isStream(te)?new b(j,te):c.prepareContent(j,te,he.binary,he.optimizedBinaryString,he.base64);var Q=new C(j,P,he);this.files[j]=Q}var f=r("./utf8"),c=r("./utils"),l=r("./stream/GenericWorker"),g=r("./stream/StreamHelper"),_=r("./defaults"),w=r("./compressedObject"),C=r("./zipObject"),y=r("./generate"),S=r("./nodejsUtils"),b=r("./nodejs/NodejsStreamInputAdapter"),E=function(j){j.slice(-1)==="/"&&(j=j.substring(0,j.length-1));var te=j.lastIndexOf("/");return 0<te?j.substring(0,te):""},k=function(j){return j.slice(-1)!=="/"&&(j+="/"),j},A=function(j,te){return te=te!==void 0?te:_.createFolders,j=k(j),this.files[j]||o.call(this,j,null,{dir:!0,createFolders:te}),this.files[j]};function L(j){return Object.prototype.toString.call(j)==="[object RegExp]"}var M={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(j){var te,X,ue;for(te in this.files)ue=this.files[te],(X=te.slice(this.root.length,te.length))&&te.slice(0,this.root.length)===this.root&&j(X,ue)},filter:function(j){var te=[];return this.forEach(function(X,ue){j(X,ue)&&te.push(ue)}),te},file:function(j,te,X){if(arguments.length!==1)return j=this.root+j,o.call(this,j,te,X),this;if(L(j)){var ue=j;return this.filter(function(he,Ce){return!Ce.dir&&ue.test(he)})}var ee=this.files[this.root+j];return ee&&!ee.dir?ee:null},folder:function(j){if(!j)return this;if(L(j))return this.filter(function(ee,he){return he.dir&&j.test(ee)});var te=this.root+j,X=A.call(this,te),ue=this.clone();return ue.root=X.name,ue},remove:function(j){j=this.root+j;var te=this.files[j];if(te||(j.slice(-1)!=="/"&&(j+="/"),te=this.files[j]),te&&!te.dir)delete this.files[j];else for(var X=this.filter(function(ee,he){return he.name.slice(0,j.length)===j}),ue=0;ue<X.length;ue++)delete this.files[X[ue].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(j){var te,X={};try{if((X=c.extend(j||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:f.utf8encode})).type=X.type.toLowerCase(),X.compression=X.compression.toUpperCase(),X.type==="binarystring"&&(X.type="string"),!X.type)throw new Error("No output type specified.");c.checkSupport(X.type),X.platform!=="darwin"&&X.platform!=="freebsd"&&X.platform!=="linux"&&X.platform!=="sunos"||(X.platform="UNIX"),X.platform==="win32"&&(X.platform="DOS");var ue=X.comment||this.comment||"";te=y.generateWorker(this,X,ue)}catch(ee){(te=new l("error")).error(ee)}return new g(te,X.type||"string",X.mimeType)},generateAsync:function(j,te){return this.generateInternalStream(j).accumulate(te)},generateNodeStream:function(j,te){return(j=j||{}).type||(j.type="nodebuffer"),this.generateInternalStream(j).toNodejsStream(te)}};s.exports=M},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,s,a){s.exports=r("stream")},{stream:void 0}],17:[function(r,s,a){var o=r("./DataReader");function f(c){o.call(this,c);for(var l=0;l<this.data.length;l++)c[l]=255&c[l]}r("../utils").inherits(f,o),f.prototype.byteAt=function(c){return this.data[this.zero+c]},f.prototype.lastIndexOfSignature=function(c){for(var l=c.charCodeAt(0),g=c.charCodeAt(1),_=c.charCodeAt(2),w=c.charCodeAt(3),C=this.length-4;0<=C;--C)if(this.data[C]===l&&this.data[C+1]===g&&this.data[C+2]===_&&this.data[C+3]===w)return C-this.zero;return-1},f.prototype.readAndCheckSignature=function(c){var l=c.charCodeAt(0),g=c.charCodeAt(1),_=c.charCodeAt(2),w=c.charCodeAt(3),C=this.readData(4);return l===C[0]&&g===C[1]&&_===C[2]&&w===C[3]},f.prototype.readData=function(c){if(this.checkOffset(c),c===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=f},{"../utils":32,"./DataReader":18}],18:[function(r,s,a){var o=r("../utils");function f(c){this.data=c,this.length=c.length,this.index=0,this.zero=0}f.prototype={checkOffset:function(c){this.checkIndex(this.index+c)},checkIndex:function(c){if(this.length<this.zero+c||c<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+c+"). Corrupted zip ?")},setIndex:function(c){this.checkIndex(c),this.index=c},skip:function(c){this.setIndex(this.index+c)},byteAt:function(){},readInt:function(c){var l,g=0;for(this.checkOffset(c),l=this.index+c-1;l>=this.index;l--)g=(g<<8)+this.byteAt(l);return this.index+=c,g},readString:function(c){return o.transformTo("string",this.readData(c))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var c=this.readInt(4);return new Date(Date.UTC(1980+(c>>25&127),(c>>21&15)-1,c>>16&31,c>>11&31,c>>5&63,(31&c)<<1))}},s.exports=f},{"../utils":32}],19:[function(r,s,a){var o=r("./Uint8ArrayReader");function f(c){o.call(this,c)}r("../utils").inherits(f,o),f.prototype.readData=function(c){this.checkOffset(c);var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=f},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,s,a){var o=r("./DataReader");function f(c){o.call(this,c)}r("../utils").inherits(f,o),f.prototype.byteAt=function(c){return this.data.charCodeAt(this.zero+c)},f.prototype.lastIndexOfSignature=function(c){return this.data.lastIndexOf(c)-this.zero},f.prototype.readAndCheckSignature=function(c){return c===this.readData(4)},f.prototype.readData=function(c){this.checkOffset(c);var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=f},{"../utils":32,"./DataReader":18}],21:[function(r,s,a){var o=r("./ArrayReader");function f(c){o.call(this,c)}r("../utils").inherits(f,o),f.prototype.readData=function(c){if(this.checkOffset(c),c===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=f},{"../utils":32,"./ArrayReader":17}],22:[function(r,s,a){var o=r("../utils"),f=r("../support"),c=r("./ArrayReader"),l=r("./StringReader"),g=r("./NodeBufferReader"),_=r("./Uint8ArrayReader");s.exports=function(w){var C=o.getTypeOf(w);return o.checkSupport(C),C!=="string"||f.uint8array?C==="nodebuffer"?new g(w):f.uint8array?new _(o.transformTo("uint8array",w)):new c(o.transformTo("array",w)):new l(w)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,s,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,s,a){var o=r("./GenericWorker"),f=r("../utils");function c(l){o.call(this,"ConvertWorker to "+l),this.destType=l}f.inherits(c,o),c.prototype.processChunk=function(l){this.push({data:f.transformTo(this.destType,l.data),meta:l.meta})},s.exports=c},{"../utils":32,"./GenericWorker":28}],25:[function(r,s,a){var o=r("./GenericWorker"),f=r("../crc32");function c(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(c,o),c.prototype.processChunk=function(l){this.streamInfo.crc32=f(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=c},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,s,a){var o=r("../utils"),f=r("./GenericWorker");function c(l){f.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}o.inherits(c,f),c.prototype.processChunk=function(l){if(l){var g=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=g+l.data.length}f.prototype.processChunk.call(this,l)},s.exports=c},{"../utils":32,"./GenericWorker":28}],27:[function(r,s,a){var o=r("../utils"),f=r("./GenericWorker");function c(l){f.call(this,"DataWorker");var g=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(_){g.dataIsReady=!0,g.data=_,g.max=_&&_.length||0,g.type=o.getTypeOf(_),g.isPaused||g._tickAndRepeat()},function(_){g.error(_)})}o.inherits(c,f),c.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},c.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},c.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},c.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,g=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,g);break;case"uint8array":l=this.data.subarray(this.index,g);break;case"array":case"nodebuffer":l=this.data.slice(this.index,g)}return this.index=g,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=c},{"../utils":32,"./GenericWorker":28}],28:[function(r,s,a){function o(f){this.name=f||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(f){this.emit("data",f)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(f){this.emit("error",f)}return!0},error:function(f){return!this.isFinished&&(this.isPaused?this.generatedError=f:(this.isFinished=!0,this.emit("error",f),this.previous&&this.previous.error(f),this.cleanUp()),!0)},on:function(f,c){return this._listeners[f].push(c),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(f,c){if(this._listeners[f])for(var l=0;l<this._listeners[f].length;l++)this._listeners[f][l].call(this,c)},pipe:function(f){return f.registerPrevious(this)},registerPrevious:function(f){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=f.streamInfo,this.mergeStreamInfo(),this.previous=f;var c=this;return f.on("data",function(l){c.processChunk(l)}),f.on("end",function(){c.end()}),f.on("error",function(l){c.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var f=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),f=!0),this.previous&&this.previous.resume(),!f},flush:function(){},processChunk:function(f){this.push(f)},withStreamInfo:function(f,c){return this.extraStreamInfo[f]=c,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var f in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,f)&&(this.streamInfo[f]=this.extraStreamInfo[f])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var f="Worker "+this.name;return this.previous?this.previous+" -> "+f:f}},s.exports=o},{}],29:[function(r,s,a){var o=r("../utils"),f=r("./ConvertWorker"),c=r("./GenericWorker"),l=r("../base64"),g=r("../support"),_=r("../external"),w=null;if(g.nodestream)try{w=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function C(S,b){return new _.Promise(function(E,k){var A=[],L=S._internalType,M=S._outputType,j=S._mimeType;S.on("data",function(te,X){A.push(te),b&&b(X)}).on("error",function(te){A=[],k(te)}).on("end",function(){try{var te=function(X,ue,ee){switch(X){case"blob":return o.newBlob(o.transformTo("arraybuffer",ue),ee);case"base64":return l.encode(ue);default:return o.transformTo(X,ue)}}(M,function(X,ue){var ee,he=0,Ce=null,P=0;for(ee=0;ee<ue.length;ee++)P+=ue[ee].length;switch(X){case"string":return ue.join("");case"array":return Array.prototype.concat.apply([],ue);case"uint8array":for(Ce=new Uint8Array(P),ee=0;ee<ue.length;ee++)Ce.set(ue[ee],he),he+=ue[ee].length;return Ce;case"nodebuffer":return Buffer.concat(ue);default:throw new Error("concat : unsupported type '"+X+"'")}}(L,A),j);E(te)}catch(X){k(X)}A=[]}).resume()})}function y(S,b,E){var k=b;switch(b){case"blob":case"arraybuffer":k="uint8array";break;case"base64":k="string"}try{this._internalType=k,this._outputType=b,this._mimeType=E,o.checkSupport(k),this._worker=S.pipe(new f(k)),S.lock()}catch(A){this._worker=new c("error"),this._worker.error(A)}}y.prototype={accumulate:function(S){return C(this,S)},on:function(S,b){var E=this;return S==="data"?this._worker.on(S,function(k){b.call(E,k.data,k.meta)}):this._worker.on(S,function(){o.delay(b,arguments,E)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new w(this,{objectMode:this._outputType!=="nodebuffer"},S)}},s.exports=y},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,s,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var o=new ArrayBuffer(0);try{a.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);f.append(o),a.blob=f.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!r("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(r,s,a){for(var o=r("./utils"),f=r("./support"),c=r("./nodejsUtils"),l=r("./stream/GenericWorker"),g=new Array(256),_=0;_<256;_++)g[_]=252<=_?6:248<=_?5:240<=_?4:224<=_?3:192<=_?2:1;g[254]=g[254]=1;function w(){l.call(this,"utf-8 decode"),this.leftOver=null}function C(){l.call(this,"utf-8 encode")}a.utf8encode=function(y){return f.nodebuffer?c.newBufferFrom(y,"utf-8"):function(S){var b,E,k,A,L,M=S.length,j=0;for(A=0;A<M;A++)(64512&(E=S.charCodeAt(A)))==55296&&A+1<M&&(64512&(k=S.charCodeAt(A+1)))==56320&&(E=65536+(E-55296<<10)+(k-56320),A++),j+=E<128?1:E<2048?2:E<65536?3:4;for(b=f.uint8array?new Uint8Array(j):new Array(j),A=L=0;L<j;A++)(64512&(E=S.charCodeAt(A)))==55296&&A+1<M&&(64512&(k=S.charCodeAt(A+1)))==56320&&(E=65536+(E-55296<<10)+(k-56320),A++),E<128?b[L++]=E:(E<2048?b[L++]=192|E>>>6:(E<65536?b[L++]=224|E>>>12:(b[L++]=240|E>>>18,b[L++]=128|E>>>12&63),b[L++]=128|E>>>6&63),b[L++]=128|63&E);return b}(y)},a.utf8decode=function(y){return f.nodebuffer?o.transformTo("nodebuffer",y).toString("utf-8"):function(S){var b,E,k,A,L=S.length,M=new Array(2*L);for(b=E=0;b<L;)if((k=S[b++])<128)M[E++]=k;else if(4<(A=g[k]))M[E++]=65533,b+=A-1;else{for(k&=A===2?31:A===3?15:7;1<A&&b<L;)k=k<<6|63&S[b++],A--;1<A?M[E++]=65533:k<65536?M[E++]=k:(k-=65536,M[E++]=55296|k>>10&1023,M[E++]=56320|1023&k)}return M.length!==E&&(M.subarray?M=M.subarray(0,E):M.length=E),o.applyFromCharCode(M)}(y=o.transformTo(f.uint8array?"uint8array":"array",y))},o.inherits(w,l),w.prototype.processChunk=function(y){var S=o.transformTo(f.uint8array?"uint8array":"array",y.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var b=S;(S=new Uint8Array(b.length+this.leftOver.length)).set(this.leftOver,0),S.set(b,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var E=function(A,L){var M;for((L=L||A.length)>A.length&&(L=A.length),M=L-1;0<=M&&(192&A[M])==128;)M--;return M<0||M===0?L:M+g[A[M]]>L?M:L}(S),k=S;E!==S.length&&(f.uint8array?(k=S.subarray(0,E),this.leftOver=S.subarray(E,S.length)):(k=S.slice(0,E),this.leftOver=S.slice(E,S.length))),this.push({data:a.utf8decode(k),meta:y.meta})},w.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=w,o.inherits(C,l),C.prototype.processChunk=function(y){this.push({data:a.utf8encode(y.data),meta:y.meta})},a.Utf8EncodeWorker=C},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,s,a){var o=r("./support"),f=r("./base64"),c=r("./nodejsUtils"),l=r("./external");function g(b){return b}function _(b,E){for(var k=0;k<b.length;++k)E[k]=255&b.charCodeAt(k);return E}r("setimmediate"),a.newBlob=function(b,E){a.checkSupport("blob");try{return new Blob([b],{type:E})}catch{try{var k=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return k.append(b),k.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var w={stringifyByChunk:function(b,E,k){var A=[],L=0,M=b.length;if(M<=k)return String.fromCharCode.apply(null,b);for(;L<M;)E==="array"||E==="nodebuffer"?A.push(String.fromCharCode.apply(null,b.slice(L,Math.min(L+k,M)))):A.push(String.fromCharCode.apply(null,b.subarray(L,Math.min(L+k,M)))),L+=k;return A.join("")},stringifyByChar:function(b){for(var E="",k=0;k<b.length;k++)E+=String.fromCharCode(b[k]);return E},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,c.allocBuffer(1)).length===1}catch{return!1}}()}};function C(b){var E=65536,k=a.getTypeOf(b),A=!0;if(k==="uint8array"?A=w.applyCanBeUsed.uint8array:k==="nodebuffer"&&(A=w.applyCanBeUsed.nodebuffer),A)for(;1<E;)try{return w.stringifyByChunk(b,k,E)}catch{E=Math.floor(E/2)}return w.stringifyByChar(b)}function y(b,E){for(var k=0;k<b.length;k++)E[k]=b[k];return E}a.applyFromCharCode=C;var S={};S.string={string:g,array:function(b){return _(b,new Array(b.length))},arraybuffer:function(b){return S.string.uint8array(b).buffer},uint8array:function(b){return _(b,new Uint8Array(b.length))},nodebuffer:function(b){return _(b,c.allocBuffer(b.length))}},S.array={string:C,array:g,arraybuffer:function(b){return new Uint8Array(b).buffer},uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return c.newBufferFrom(b)}},S.arraybuffer={string:function(b){return C(new Uint8Array(b))},array:function(b){return y(new Uint8Array(b),new Array(b.byteLength))},arraybuffer:g,uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return c.newBufferFrom(new Uint8Array(b))}},S.uint8array={string:C,array:function(b){return y(b,new Array(b.length))},arraybuffer:function(b){return b.buffer},uint8array:g,nodebuffer:function(b){return c.newBufferFrom(b)}},S.nodebuffer={string:C,array:function(b){return y(b,new Array(b.length))},arraybuffer:function(b){return S.nodebuffer.uint8array(b).buffer},uint8array:function(b){return y(b,new Uint8Array(b.length))},nodebuffer:g},a.transformTo=function(b,E){if(E=E||"",!b)return E;a.checkSupport(b);var k=a.getTypeOf(E);return S[k][b](E)},a.resolve=function(b){for(var E=b.split("/"),k=[],A=0;A<E.length;A++){var L=E[A];L==="."||L===""&&A!==0&&A!==E.length-1||(L===".."?k.pop():k.push(L))}return k.join("/")},a.getTypeOf=function(b){return typeof b=="string"?"string":Object.prototype.toString.call(b)==="[object Array]"?"array":o.nodebuffer&&c.isBuffer(b)?"nodebuffer":o.uint8array&&b instanceof Uint8Array?"uint8array":o.arraybuffer&&b instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(b){if(!o[b.toLowerCase()])throw new Error(b+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(b){var E,k,A="";for(k=0;k<(b||"").length;k++)A+="\\x"+((E=b.charCodeAt(k))<16?"0":"")+E.toString(16).toUpperCase();return A},a.delay=function(b,E,k){setImmediate(function(){b.apply(k||null,E||[])})},a.inherits=function(b,E){function k(){}k.prototype=E.prototype,b.prototype=new k},a.extend=function(){var b,E,k={};for(b=0;b<arguments.length;b++)for(E in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],E)&&k[E]===void 0&&(k[E]=arguments[b][E]);return k},a.prepareContent=function(b,E,k,A,L){return l.Promise.resolve(E).then(function(M){return o.blob&&(M instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(M))!==-1)&&typeof FileReader<"u"?new l.Promise(function(j,te){var X=new FileReader;X.onload=function(ue){j(ue.target.result)},X.onerror=function(ue){te(ue.target.error)},X.readAsArrayBuffer(M)}):M}).then(function(M){var j=a.getTypeOf(M);return j?(j==="arraybuffer"?M=a.transformTo("uint8array",M):j==="string"&&(L?M=f.decode(M):k&&A!==!0&&(M=function(te){return _(te,o.uint8array?new Uint8Array(te.length):new Array(te.length))}(M))),M):l.Promise.reject(new Error("Can't read the data of '"+b+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,s,a){var o=r("./reader/readerFor"),f=r("./utils"),c=r("./signature"),l=r("./zipEntry"),g=r("./support");function _(w){this.files=[],this.loadOptions=w}_.prototype={checkSignature:function(w){if(!this.reader.readAndCheckSignature(w)){this.reader.index-=4;var C=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(C)+", expected "+f.pretty(w)+")")}},isSignature:function(w,C){var y=this.reader.index;this.reader.setIndex(w);var S=this.reader.readString(4)===C;return this.reader.setIndex(y),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var w=this.reader.readData(this.zipCommentLength),C=g.uint8array?"uint8array":"array",y=f.transformTo(C,w);this.zipComment=this.loadOptions.decodeFileName(y)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var w,C,y,S=this.zip64EndOfCentralSize-44;0<S;)w=this.reader.readInt(2),C=this.reader.readInt(4),y=this.reader.readData(C),this.zip64ExtensibleData[w]={id:w,length:C,value:y}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var w,C;for(w=0;w<this.files.length;w++)C=this.files[w],this.reader.setIndex(C.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),C.readLocalPart(this.reader),C.handleUTF8(),C.processAttributes()},readCentralDir:function(){var w;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(c.CENTRAL_FILE_HEADER);)(w=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(w);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var w=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(w<0)throw this.isSignature(0,c.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(w);var C=w;if(this.checkSignature(c.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,(w=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(w),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,c.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var y=this.centralDirOffset+this.centralDirSize;this.zip64&&(y+=20,y+=12+this.zip64EndOfCentralSize);var S=C-y;if(0<S)this.isSignature(C,c.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(w){this.reader=o(w)},load:function(w){this.prepareReader(w),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=_},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,s,a){var o=r("./reader/readerFor"),f=r("./utils"),c=r("./compressedObject"),l=r("./crc32"),g=r("./utf8"),_=r("./compressions"),w=r("./support");function C(y,S){this.options=y,this.loadOptions=S}C.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(y){var S,b;if(y.skip(22),this.fileNameLength=y.readInt(2),b=y.readInt(2),this.fileName=y.readData(this.fileNameLength),y.skip(b),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=function(E){for(var k in _)if(Object.prototype.hasOwnProperty.call(_,k)&&_[k].magic===E)return _[k];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new c(this.compressedSize,this.uncompressedSize,this.crc32,S,y.readData(this.compressedSize))},readCentralPart:function(y){this.versionMadeBy=y.readInt(2),y.skip(2),this.bitFlag=y.readInt(2),this.compressionMethod=y.readString(2),this.date=y.readDate(),this.crc32=y.readInt(4),this.compressedSize=y.readInt(4),this.uncompressedSize=y.readInt(4);var S=y.readInt(2);if(this.extraFieldsLength=y.readInt(2),this.fileCommentLength=y.readInt(2),this.diskNumberStart=y.readInt(2),this.internalFileAttributes=y.readInt(2),this.externalFileAttributes=y.readInt(4),this.localHeaderOffset=y.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");y.skip(S),this.readExtraFields(y),this.parseZIP64ExtraField(y),this.fileComment=y.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var y=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),y==0&&(this.dosPermissions=63&this.externalFileAttributes),y==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var y=o(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=y.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=y.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=y.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=y.readInt(4))}},readExtraFields:function(y){var S,b,E,k=y.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});y.index+4<k;)S=y.readInt(2),b=y.readInt(2),E=y.readData(b),this.extraFields[S]={id:S,length:b,value:E};y.setIndex(k)},handleUTF8:function(){var y=w.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=g.utf8decode(this.fileName),this.fileCommentStr=g.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var b=f.transformTo(y,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(b)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var k=f.transformTo(y,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(k)}}},findExtraFieldUnicodePath:function(){var y=this.extraFields[28789];if(y){var S=o(y.value);return S.readInt(1)!==1||l(this.fileName)!==S.readInt(4)?null:g.utf8decode(S.readData(y.length-5))}return null},findExtraFieldUnicodeComment:function(){var y=this.extraFields[25461];if(y){var S=o(y.value);return S.readInt(1)!==1||l(this.fileComment)!==S.readInt(4)?null:g.utf8decode(S.readData(y.length-5))}return null}},s.exports=C},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,s,a){function o(S,b,E){this.name=S,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=b,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var f=r("./stream/StreamHelper"),c=r("./stream/DataWorker"),l=r("./utf8"),g=r("./compressedObject"),_=r("./stream/GenericWorker");o.prototype={internalStream:function(S){var b=null,E="string";try{if(!S)throw new Error("No output type specified.");var k=(E=S.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),b=this._decompressWorker();var A=!this._dataBinary;A&&!k&&(b=b.pipe(new l.Utf8EncodeWorker)),!A&&k&&(b=b.pipe(new l.Utf8DecodeWorker))}catch(L){(b=new _("error")).error(L)}return new f(b,E,"")},async:function(S,b){return this.internalStream(S).accumulate(b)},nodeStream:function(S,b){return this.internalStream(S||"nodebuffer").toNodejsStream(b)},_compressWorker:function(S,b){if(this._data instanceof g&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new l.Utf8EncodeWorker)),g.createWorkerFrom(E,S,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof _?this._data:new c(this._data)}};for(var w=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],C=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},y=0;y<w.length;y++)o.prototype[w[y]]=C;s.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,s,a){(function(o){var f,c,l=o.MutationObserver||o.WebKitMutationObserver;if(l){var g=0,_=new l(S),w=o.document.createTextNode("");_.observe(w,{characterData:!0}),f=function(){w.data=g=++g%2}}else if(o.setImmediate||o.MessageChannel===void 0)f="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var b=o.document.createElement("script");b.onreadystatechange=function(){S(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},o.document.documentElement.appendChild(b)}:function(){setTimeout(S,0)};else{var C=new o.MessageChannel;C.port1.onmessage=S,f=function(){C.port2.postMessage(0)}}var y=[];function S(){var b,E;c=!0;for(var k=y.length;k;){for(E=y,y=[],b=-1;++b<k;)E[b]();k=y.length}c=!1}s.exports=function(b){y.push(b)!==1||c||f()}}).call(this,typeof _r<"u"?_r:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,s,a){var o=r("immediate");function f(){}var c={},l=["REJECTED"],g=["FULFILLED"],_=["PENDING"];function w(k){if(typeof k!="function")throw new TypeError("resolver must be a function");this.state=_,this.queue=[],this.outcome=void 0,k!==f&&b(this,k)}function C(k,A,L){this.promise=k,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}function y(k,A,L){o(function(){var M;try{M=A(L)}catch(j){return c.reject(k,j)}M===k?c.reject(k,new TypeError("Cannot resolve promise with itself")):c.resolve(k,M)})}function S(k){var A=k&&k.then;if(k&&(typeof k=="object"||typeof k=="function")&&typeof A=="function")return function(){A.apply(k,arguments)}}function b(k,A){var L=!1;function M(X){L||(L=!0,c.reject(k,X))}function j(X){L||(L=!0,c.resolve(k,X))}var te=E(function(){A(j,M)});te.status==="error"&&M(te.value)}function E(k,A){var L={};try{L.value=k(A),L.status="success"}catch(M){L.status="error",L.value=M}return L}(s.exports=w).prototype.finally=function(k){if(typeof k!="function")return this;var A=this.constructor;return this.then(function(L){return A.resolve(k()).then(function(){return L})},function(L){return A.resolve(k()).then(function(){throw L})})},w.prototype.catch=function(k){return this.then(null,k)},w.prototype.then=function(k,A){if(typeof k!="function"&&this.state===g||typeof A!="function"&&this.state===l)return this;var L=new this.constructor(f);return this.state!==_?y(L,this.state===g?k:A,this.outcome):this.queue.push(new C(L,k,A)),L},C.prototype.callFulfilled=function(k){c.resolve(this.promise,k)},C.prototype.otherCallFulfilled=function(k){y(this.promise,this.onFulfilled,k)},C.prototype.callRejected=function(k){c.reject(this.promise,k)},C.prototype.otherCallRejected=function(k){y(this.promise,this.onRejected,k)},c.resolve=function(k,A){var L=E(S,A);if(L.status==="error")return c.reject(k,L.value);var M=L.value;if(M)b(k,M);else{k.state=g,k.outcome=A;for(var j=-1,te=k.queue.length;++j<te;)k.queue[j].callFulfilled(A)}return k},c.reject=function(k,A){k.state=l,k.outcome=A;for(var L=-1,M=k.queue.length;++L<M;)k.queue[L].callRejected(A);return k},w.resolve=function(k){return k instanceof this?k:c.resolve(new this(f),k)},w.reject=function(k){var A=new this(f);return c.reject(A,k)},w.all=function(k){var A=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=k.length,M=!1;if(!L)return this.resolve([]);for(var j=new Array(L),te=0,X=-1,ue=new this(f);++X<L;)ee(k[X],X);return ue;function ee(he,Ce){A.resolve(he).then(function(P){j[Ce]=P,++te!==L||M||(M=!0,c.resolve(ue,j))},function(P){M||(M=!0,c.reject(ue,P))})}},w.race=function(k){var A=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=k.length,M=!1;if(!L)return this.resolve([]);for(var j=-1,te=new this(f);++j<L;)X=k[j],A.resolve(X).then(function(ue){M||(M=!0,c.resolve(te,ue))},function(ue){M||(M=!0,c.reject(te,ue))});var X;return te}},{immediate:36}],38:[function(r,s,a){var o={};(0,r("./lib/utils/common").assign)(o,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),s.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,s,a){var o=r("./zlib/deflate"),f=r("./utils/common"),c=r("./utils/strings"),l=r("./zlib/messages"),g=r("./zlib/zstream"),_=Object.prototype.toString,w=0,C=-1,y=0,S=8;function b(k){if(!(this instanceof b))return new b(k);this.options=f.assign({level:C,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:y,to:""},k||{});var A=this.options;A.raw&&0<A.windowBits?A.windowBits=-A.windowBits:A.gzip&&0<A.windowBits&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var L=o.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(L!==w)throw new Error(l[L]);if(A.header&&o.deflateSetHeader(this.strm,A.header),A.dictionary){var M;if(M=typeof A.dictionary=="string"?c.string2buf(A.dictionary):_.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(L=o.deflateSetDictionary(this.strm,M))!==w)throw new Error(l[L]);this._dict_set=!0}}function E(k,A){var L=new b(A);if(L.push(k,!0),L.err)throw L.msg||l[L.err];return L.result}b.prototype.push=function(k,A){var L,M,j=this.strm,te=this.options.chunkSize;if(this.ended)return!1;M=A===~~A?A:A===!0?4:0,typeof k=="string"?j.input=c.string2buf(k):_.call(k)==="[object ArrayBuffer]"?j.input=new Uint8Array(k):j.input=k,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new f.Buf8(te),j.next_out=0,j.avail_out=te),(L=o.deflate(j,M))!==1&&L!==w)return this.onEnd(L),!(this.ended=!0);j.avail_out!==0&&(j.avail_in!==0||M!==4&&M!==2)||(this.options.to==="string"?this.onData(c.buf2binstring(f.shrinkBuf(j.output,j.next_out))):this.onData(f.shrinkBuf(j.output,j.next_out)))}while((0<j.avail_in||j.avail_out===0)&&L!==1);return M===4?(L=o.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===w):M!==2||(this.onEnd(w),!(j.avail_out=0))},b.prototype.onData=function(k){this.chunks.push(k)},b.prototype.onEnd=function(k){k===w&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg},a.Deflate=b,a.deflate=E,a.deflateRaw=function(k,A){return(A=A||{}).raw=!0,E(k,A)},a.gzip=function(k,A){return(A=A||{}).gzip=!0,E(k,A)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,s,a){var o=r("./zlib/inflate"),f=r("./utils/common"),c=r("./utils/strings"),l=r("./zlib/constants"),g=r("./zlib/messages"),_=r("./zlib/zstream"),w=r("./zlib/gzheader"),C=Object.prototype.toString;function y(b){if(!(this instanceof y))return new y(b);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},b||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||b&&b.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&(15&E.windowBits)==0&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _,this.strm.avail_out=0;var k=o.inflateInit2(this.strm,E.windowBits);if(k!==l.Z_OK)throw new Error(g[k]);this.header=new w,o.inflateGetHeader(this.strm,this.header)}function S(b,E){var k=new y(E);if(k.push(b,!0),k.err)throw k.msg||g[k.err];return k.result}y.prototype.push=function(b,E){var k,A,L,M,j,te,X=this.strm,ue=this.options.chunkSize,ee=this.options.dictionary,he=!1;if(this.ended)return!1;A=E===~~E?E:E===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof b=="string"?X.input=c.binstring2buf(b):C.call(b)==="[object ArrayBuffer]"?X.input=new Uint8Array(b):X.input=b,X.next_in=0,X.avail_in=X.input.length;do{if(X.avail_out===0&&(X.output=new f.Buf8(ue),X.next_out=0,X.avail_out=ue),(k=o.inflate(X,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&ee&&(te=typeof ee=="string"?c.string2buf(ee):C.call(ee)==="[object ArrayBuffer]"?new Uint8Array(ee):ee,k=o.inflateSetDictionary(this.strm,te)),k===l.Z_BUF_ERROR&&he===!0&&(k=l.Z_OK,he=!1),k!==l.Z_STREAM_END&&k!==l.Z_OK)return this.onEnd(k),!(this.ended=!0);X.next_out&&(X.avail_out!==0&&k!==l.Z_STREAM_END&&(X.avail_in!==0||A!==l.Z_FINISH&&A!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(L=c.utf8border(X.output,X.next_out),M=X.next_out-L,j=c.buf2string(X.output,L),X.next_out=M,X.avail_out=ue-M,M&&f.arraySet(X.output,X.output,L,M,0),this.onData(j)):this.onData(f.shrinkBuf(X.output,X.next_out)))),X.avail_in===0&&X.avail_out===0&&(he=!0)}while((0<X.avail_in||X.avail_out===0)&&k!==l.Z_STREAM_END);return k===l.Z_STREAM_END&&(A=l.Z_FINISH),A===l.Z_FINISH?(k=o.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===l.Z_OK):A!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(X.avail_out=0))},y.prototype.onData=function(b){this.chunks.push(b)},y.prototype.onEnd=function(b){b===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Inflate=y,a.inflate=S,a.inflateRaw=function(b,E){return(E=E||{}).raw=!0,S(b,E)},a.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,s,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var g=Array.prototype.slice.call(arguments,1);g.length;){var _=g.shift();if(_){if(typeof _!="object")throw new TypeError(_+"must be non-object");for(var w in _)_.hasOwnProperty(w)&&(l[w]=_[w])}}return l},a.shrinkBuf=function(l,g){return l.length===g?l:l.subarray?l.subarray(0,g):(l.length=g,l)};var f={arraySet:function(l,g,_,w,C){if(g.subarray&&l.subarray)l.set(g.subarray(_,_+w),C);else for(var y=0;y<w;y++)l[C+y]=g[_+y]},flattenChunks:function(l){var g,_,w,C,y,S;for(g=w=0,_=l.length;g<_;g++)w+=l[g].length;for(S=new Uint8Array(w),g=C=0,_=l.length;g<_;g++)y=l[g],S.set(y,C),C+=y.length;return S}},c={arraySet:function(l,g,_,w,C){for(var y=0;y<w;y++)l[C+y]=g[_+y]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,f)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,c))},a.setTyped(o)},{}],42:[function(r,s,a){var o=r("./common"),f=!0,c=!0;try{String.fromCharCode.apply(null,[0])}catch{f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{c=!1}for(var l=new o.Buf8(256),g=0;g<256;g++)l[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;function _(w,C){if(C<65537&&(w.subarray&&c||!w.subarray&&f))return String.fromCharCode.apply(null,o.shrinkBuf(w,C));for(var y="",S=0;S<C;S++)y+=String.fromCharCode(w[S]);return y}l[254]=l[254]=1,a.string2buf=function(w){var C,y,S,b,E,k=w.length,A=0;for(b=0;b<k;b++)(64512&(y=w.charCodeAt(b)))==55296&&b+1<k&&(64512&(S=w.charCodeAt(b+1)))==56320&&(y=65536+(y-55296<<10)+(S-56320),b++),A+=y<128?1:y<2048?2:y<65536?3:4;for(C=new o.Buf8(A),b=E=0;E<A;b++)(64512&(y=w.charCodeAt(b)))==55296&&b+1<k&&(64512&(S=w.charCodeAt(b+1)))==56320&&(y=65536+(y-55296<<10)+(S-56320),b++),y<128?C[E++]=y:(y<2048?C[E++]=192|y>>>6:(y<65536?C[E++]=224|y>>>12:(C[E++]=240|y>>>18,C[E++]=128|y>>>12&63),C[E++]=128|y>>>6&63),C[E++]=128|63&y);return C},a.buf2binstring=function(w){return _(w,w.length)},a.binstring2buf=function(w){for(var C=new o.Buf8(w.length),y=0,S=C.length;y<S;y++)C[y]=w.charCodeAt(y);return C},a.buf2string=function(w,C){var y,S,b,E,k=C||w.length,A=new Array(2*k);for(y=S=0;y<k;)if((b=w[y++])<128)A[S++]=b;else if(4<(E=l[b]))A[S++]=65533,y+=E-1;else{for(b&=E===2?31:E===3?15:7;1<E&&y<k;)b=b<<6|63&w[y++],E--;1<E?A[S++]=65533:b<65536?A[S++]=b:(b-=65536,A[S++]=55296|b>>10&1023,A[S++]=56320|1023&b)}return _(A,S)},a.utf8border=function(w,C){var y;for((C=C||w.length)>w.length&&(C=w.length),y=C-1;0<=y&&(192&w[y])==128;)y--;return y<0||y===0?C:y+l[w[y]]>C?y:C}},{"./common":41}],43:[function(r,s,a){s.exports=function(o,f,c,l){for(var g=65535&o|0,_=o>>>16&65535|0,w=0;c!==0;){for(c-=w=2e3<c?2e3:c;_=_+(g=g+f[l++]|0)|0,--w;);g%=65521,_%=65521}return g|_<<16|0}},{}],44:[function(r,s,a){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,s,a){var o=function(){for(var f,c=[],l=0;l<256;l++){f=l;for(var g=0;g<8;g++)f=1&f?3988292384^f>>>1:f>>>1;c[l]=f}return c}();s.exports=function(f,c,l,g){var _=o,w=g+l;f^=-1;for(var C=g;C<w;C++)f=f>>>8^_[255&(f^c[C])];return-1^f}},{}],46:[function(r,s,a){var o,f=r("../utils/common"),c=r("./trees"),l=r("./adler32"),g=r("./crc32"),_=r("./messages"),w=0,C=4,y=0,S=-2,b=-1,E=4,k=2,A=8,L=9,M=286,j=30,te=19,X=2*M+1,ue=15,ee=3,he=258,Ce=he+ee+1,P=42,Q=113,m=1,ie=2,Te=3,ae=4;function Pe(h,re){return h.msg=_[re],re}function ce(h){return(h<<1)-(4<h?9:0)}function Ae(h){for(var re=h.length;0<=--re;)h[re]=0}function Y(h){var re=h.state,J=re.pending;J>h.avail_out&&(J=h.avail_out),J!==0&&(f.arraySet(h.output,re.pending_buf,re.pending_out,J,h.next_out),h.next_out+=J,re.pending_out+=J,h.total_out+=J,h.avail_out-=J,re.pending-=J,re.pending===0&&(re.pending_out=0))}function Z(h,re){c._tr_flush_block(h,0<=h.block_start?h.block_start:-1,h.strstart-h.block_start,re),h.block_start=h.strstart,Y(h.strm)}function Oe(h,re){h.pending_buf[h.pending++]=re}function ke(h,re){h.pending_buf[h.pending++]=re>>>8&255,h.pending_buf[h.pending++]=255&re}function ye(h,re){var J,O,I=h.max_chain_length,G=h.strstart,oe=h.prev_length,se=h.nice_match,q=h.strstart>h.w_size-Ce?h.strstart-(h.w_size-Ce):0,le=h.window,Ee=h.w_mask,pe=h.prev,Se=h.strstart+he,Ge=le[G+oe-1],ze=le[G+oe];h.prev_length>=h.good_match&&(I>>=2),se>h.lookahead&&(se=h.lookahead);do if(le[(J=re)+oe]===ze&&le[J+oe-1]===Ge&&le[J]===le[G]&&le[++J]===le[G+1]){G+=2,J++;do;while(le[++G]===le[++J]&&le[++G]===le[++J]&&le[++G]===le[++J]&&le[++G]===le[++J]&&le[++G]===le[++J]&&le[++G]===le[++J]&&le[++G]===le[++J]&&le[++G]===le[++J]&&G<Se);if(O=he-(Se-G),G=Se-he,oe<O){if(h.match_start=re,se<=(oe=O))break;Ge=le[G+oe-1],ze=le[G+oe]}}while((re=pe[re&Ee])>q&&--I!=0);return oe<=h.lookahead?oe:h.lookahead}function Ke(h){var re,J,O,I,G,oe,se,q,le,Ee,pe=h.w_size;do{if(I=h.window_size-h.lookahead-h.strstart,h.strstart>=pe+(pe-Ce)){for(f.arraySet(h.window,h.window,pe,pe,0),h.match_start-=pe,h.strstart-=pe,h.block_start-=pe,re=J=h.hash_size;O=h.head[--re],h.head[re]=pe<=O?O-pe:0,--J;);for(re=J=pe;O=h.prev[--re],h.prev[re]=pe<=O?O-pe:0,--J;);I+=pe}if(h.strm.avail_in===0)break;if(oe=h.strm,se=h.window,q=h.strstart+h.lookahead,le=I,Ee=void 0,Ee=oe.avail_in,le<Ee&&(Ee=le),J=Ee===0?0:(oe.avail_in-=Ee,f.arraySet(se,oe.input,oe.next_in,Ee,q),oe.state.wrap===1?oe.adler=l(oe.adler,se,Ee,q):oe.state.wrap===2&&(oe.adler=g(oe.adler,se,Ee,q)),oe.next_in+=Ee,oe.total_in+=Ee,Ee),h.lookahead+=J,h.lookahead+h.insert>=ee)for(G=h.strstart-h.insert,h.ins_h=h.window[G],h.ins_h=(h.ins_h<<h.hash_shift^h.window[G+1])&h.hash_mask;h.insert&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[G+ee-1])&h.hash_mask,h.prev[G&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=G,G++,h.insert--,!(h.lookahead+h.insert<ee)););}while(h.lookahead<Ce&&h.strm.avail_in!==0)}function Qe(h,re){for(var J,O;;){if(h.lookahead<Ce){if(Ke(h),h.lookahead<Ce&&re===w)return m;if(h.lookahead===0)break}if(J=0,h.lookahead>=ee&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+ee-1])&h.hash_mask,J=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),J!==0&&h.strstart-J<=h.w_size-Ce&&(h.match_length=ye(h,J)),h.match_length>=ee)if(O=c._tr_tally(h,h.strstart-h.match_start,h.match_length-ee),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=ee){for(h.match_length--;h.strstart++,h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+ee-1])&h.hash_mask,J=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart,--h.match_length!=0;);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+1])&h.hash_mask;else O=c._tr_tally(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(O&&(Z(h,!1),h.strm.avail_out===0))return m}return h.insert=h.strstart<ee-1?h.strstart:ee-1,re===C?(Z(h,!0),h.strm.avail_out===0?Te:ae):h.last_lit&&(Z(h,!1),h.strm.avail_out===0)?m:ie}function Ue(h,re){for(var J,O,I;;){if(h.lookahead<Ce){if(Ke(h),h.lookahead<Ce&&re===w)return m;if(h.lookahead===0)break}if(J=0,h.lookahead>=ee&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+ee-1])&h.hash_mask,J=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=ee-1,J!==0&&h.prev_length<h.max_lazy_match&&h.strstart-J<=h.w_size-Ce&&(h.match_length=ye(h,J),h.match_length<=5&&(h.strategy===1||h.match_length===ee&&4096<h.strstart-h.match_start)&&(h.match_length=ee-1)),h.prev_length>=ee&&h.match_length<=h.prev_length){for(I=h.strstart+h.lookahead-ee,O=c._tr_tally(h,h.strstart-1-h.prev_match,h.prev_length-ee),h.lookahead-=h.prev_length-1,h.prev_length-=2;++h.strstart<=I&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+ee-1])&h.hash_mask,J=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),--h.prev_length!=0;);if(h.match_available=0,h.match_length=ee-1,h.strstart++,O&&(Z(h,!1),h.strm.avail_out===0))return m}else if(h.match_available){if((O=c._tr_tally(h,0,h.window[h.strstart-1]))&&Z(h,!1),h.strstart++,h.lookahead--,h.strm.avail_out===0)return m}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(O=c._tr_tally(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<ee-1?h.strstart:ee-1,re===C?(Z(h,!0),h.strm.avail_out===0?Te:ae):h.last_lit&&(Z(h,!1),h.strm.avail_out===0)?m:ie}function me(h,re,J,O,I){this.good_length=h,this.max_lazy=re,this.nice_length=J,this.max_chain=O,this.func=I}function He(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*X),this.dyn_dtree=new f.Buf16(2*(2*j+1)),this.bl_tree=new f.Buf16(2*(2*te+1)),Ae(this.dyn_ltree),Ae(this.dyn_dtree),Ae(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16(ue+1),this.heap=new f.Buf16(2*M+1),Ae(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*M+1),Ae(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function De(h){var re;return h&&h.state?(h.total_in=h.total_out=0,h.data_type=k,(re=h.state).pending=0,re.pending_out=0,re.wrap<0&&(re.wrap=-re.wrap),re.status=re.wrap?P:Q,h.adler=re.wrap===2?0:1,re.last_flush=w,c._tr_init(re),y):Pe(h,S)}function Re(h){var re=De(h);return re===y&&function(J){J.window_size=2*J.w_size,Ae(J.head),J.max_lazy_match=o[J.level].max_lazy,J.good_match=o[J.level].good_length,J.nice_match=o[J.level].nice_length,J.max_chain_length=o[J.level].max_chain,J.strstart=0,J.block_start=0,J.lookahead=0,J.insert=0,J.match_length=J.prev_length=ee-1,J.match_available=0,J.ins_h=0}(h.state),re}function nt(h,re,J,O,I,G){if(!h)return S;var oe=1;if(re===b&&(re=6),O<0?(oe=0,O=-O):15<O&&(oe=2,O-=16),I<1||L<I||J!==A||O<8||15<O||re<0||9<re||G<0||E<G)return Pe(h,S);O===8&&(O=9);var se=new He;return(h.state=se).strm=h,se.wrap=oe,se.gzhead=null,se.w_bits=O,se.w_size=1<<se.w_bits,se.w_mask=se.w_size-1,se.hash_bits=I+7,se.hash_size=1<<se.hash_bits,se.hash_mask=se.hash_size-1,se.hash_shift=~~((se.hash_bits+ee-1)/ee),se.window=new f.Buf8(2*se.w_size),se.head=new f.Buf16(se.hash_size),se.prev=new f.Buf16(se.w_size),se.lit_bufsize=1<<I+6,se.pending_buf_size=4*se.lit_bufsize,se.pending_buf=new f.Buf8(se.pending_buf_size),se.d_buf=1*se.lit_bufsize,se.l_buf=3*se.lit_bufsize,se.level=re,se.strategy=G,se.method=J,Re(h)}o=[new me(0,0,0,0,function(h,re){var J=65535;for(J>h.pending_buf_size-5&&(J=h.pending_buf_size-5);;){if(h.lookahead<=1){if(Ke(h),h.lookahead===0&&re===w)return m;if(h.lookahead===0)break}h.strstart+=h.lookahead,h.lookahead=0;var O=h.block_start+J;if((h.strstart===0||h.strstart>=O)&&(h.lookahead=h.strstart-O,h.strstart=O,Z(h,!1),h.strm.avail_out===0)||h.strstart-h.block_start>=h.w_size-Ce&&(Z(h,!1),h.strm.avail_out===0))return m}return h.insert=0,re===C?(Z(h,!0),h.strm.avail_out===0?Te:ae):(h.strstart>h.block_start&&(Z(h,!1),h.strm.avail_out),m)}),new me(4,4,8,4,Qe),new me(4,5,16,8,Qe),new me(4,6,32,32,Qe),new me(4,4,16,16,Ue),new me(8,16,32,32,Ue),new me(8,16,128,128,Ue),new me(8,32,128,256,Ue),new me(32,128,258,1024,Ue),new me(32,258,258,4096,Ue)],a.deflateInit=function(h,re){return nt(h,re,A,15,8,0)},a.deflateInit2=nt,a.deflateReset=Re,a.deflateResetKeep=De,a.deflateSetHeader=function(h,re){return h&&h.state?h.state.wrap!==2?S:(h.state.gzhead=re,y):S},a.deflate=function(h,re){var J,O,I,G;if(!h||!h.state||5<re||re<0)return h?Pe(h,S):S;if(O=h.state,!h.output||!h.input&&h.avail_in!==0||O.status===666&&re!==C)return Pe(h,h.avail_out===0?-5:S);if(O.strm=h,J=O.last_flush,O.last_flush=re,O.status===P)if(O.wrap===2)h.adler=0,Oe(O,31),Oe(O,139),Oe(O,8),O.gzhead?(Oe(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),Oe(O,255&O.gzhead.time),Oe(O,O.gzhead.time>>8&255),Oe(O,O.gzhead.time>>16&255),Oe(O,O.gzhead.time>>24&255),Oe(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),Oe(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(Oe(O,255&O.gzhead.extra.length),Oe(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(h.adler=g(h.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(Oe(O,0),Oe(O,0),Oe(O,0),Oe(O,0),Oe(O,0),Oe(O,O.level===9?2:2<=O.strategy||O.level<2?4:0),Oe(O,3),O.status=Q);else{var oe=A+(O.w_bits-8<<4)<<8;oe|=(2<=O.strategy||O.level<2?0:O.level<6?1:O.level===6?2:3)<<6,O.strstart!==0&&(oe|=32),oe+=31-oe%31,O.status=Q,ke(O,oe),O.strstart!==0&&(ke(O,h.adler>>>16),ke(O,65535&h.adler)),h.adler=1}if(O.status===69)if(O.gzhead.extra){for(I=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>I&&(h.adler=g(h.adler,O.pending_buf,O.pending-I,I)),Y(h),I=O.pending,O.pending!==O.pending_buf_size));)Oe(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>I&&(h.adler=g(h.adler,O.pending_buf,O.pending-I,I)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(O.status===73)if(O.gzhead.name){I=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>I&&(h.adler=g(h.adler,O.pending_buf,O.pending-I,I)),Y(h),I=O.pending,O.pending===O.pending_buf_size)){G=1;break}G=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,Oe(O,G)}while(G!==0);O.gzhead.hcrc&&O.pending>I&&(h.adler=g(h.adler,O.pending_buf,O.pending-I,I)),G===0&&(O.gzindex=0,O.status=91)}else O.status=91;if(O.status===91)if(O.gzhead.comment){I=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>I&&(h.adler=g(h.adler,O.pending_buf,O.pending-I,I)),Y(h),I=O.pending,O.pending===O.pending_buf_size)){G=1;break}G=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,Oe(O,G)}while(G!==0);O.gzhead.hcrc&&O.pending>I&&(h.adler=g(h.adler,O.pending_buf,O.pending-I,I)),G===0&&(O.status=103)}else O.status=103;if(O.status===103&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&Y(h),O.pending+2<=O.pending_buf_size&&(Oe(O,255&h.adler),Oe(O,h.adler>>8&255),h.adler=0,O.status=Q)):O.status=Q),O.pending!==0){if(Y(h),h.avail_out===0)return O.last_flush=-1,y}else if(h.avail_in===0&&ce(re)<=ce(J)&&re!==C)return Pe(h,-5);if(O.status===666&&h.avail_in!==0)return Pe(h,-5);if(h.avail_in!==0||O.lookahead!==0||re!==w&&O.status!==666){var se=O.strategy===2?function(q,le){for(var Ee;;){if(q.lookahead===0&&(Ke(q),q.lookahead===0)){if(le===w)return m;break}if(q.match_length=0,Ee=c._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,Ee&&(Z(q,!1),q.strm.avail_out===0))return m}return q.insert=0,le===C?(Z(q,!0),q.strm.avail_out===0?Te:ae):q.last_lit&&(Z(q,!1),q.strm.avail_out===0)?m:ie}(O,re):O.strategy===3?function(q,le){for(var Ee,pe,Se,Ge,ze=q.window;;){if(q.lookahead<=he){if(Ke(q),q.lookahead<=he&&le===w)return m;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=ee&&0<q.strstart&&(pe=ze[Se=q.strstart-1])===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]){Ge=q.strstart+he;do;while(pe===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]&&pe===ze[++Se]&&Se<Ge);q.match_length=he-(Ge-Se),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=ee?(Ee=c._tr_tally(q,1,q.match_length-ee),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(Ee=c._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),Ee&&(Z(q,!1),q.strm.avail_out===0))return m}return q.insert=0,le===C?(Z(q,!0),q.strm.avail_out===0?Te:ae):q.last_lit&&(Z(q,!1),q.strm.avail_out===0)?m:ie}(O,re):o[O.level].func(O,re);if(se!==Te&&se!==ae||(O.status=666),se===m||se===Te)return h.avail_out===0&&(O.last_flush=-1),y;if(se===ie&&(re===1?c._tr_align(O):re!==5&&(c._tr_stored_block(O,0,0,!1),re===3&&(Ae(O.head),O.lookahead===0&&(O.strstart=0,O.block_start=0,O.insert=0))),Y(h),h.avail_out===0))return O.last_flush=-1,y}return re!==C?y:O.wrap<=0?1:(O.wrap===2?(Oe(O,255&h.adler),Oe(O,h.adler>>8&255),Oe(O,h.adler>>16&255),Oe(O,h.adler>>24&255),Oe(O,255&h.total_in),Oe(O,h.total_in>>8&255),Oe(O,h.total_in>>16&255),Oe(O,h.total_in>>24&255)):(ke(O,h.adler>>>16),ke(O,65535&h.adler)),Y(h),0<O.wrap&&(O.wrap=-O.wrap),O.pending!==0?y:1)},a.deflateEnd=function(h){var re;return h&&h.state?(re=h.state.status)!==P&&re!==69&&re!==73&&re!==91&&re!==103&&re!==Q&&re!==666?Pe(h,S):(h.state=null,re===Q?Pe(h,-3):y):S},a.deflateSetDictionary=function(h,re){var J,O,I,G,oe,se,q,le,Ee=re.length;if(!h||!h.state||(G=(J=h.state).wrap)===2||G===1&&J.status!==P||J.lookahead)return S;for(G===1&&(h.adler=l(h.adler,re,Ee,0)),J.wrap=0,Ee>=J.w_size&&(G===0&&(Ae(J.head),J.strstart=0,J.block_start=0,J.insert=0),le=new f.Buf8(J.w_size),f.arraySet(le,re,Ee-J.w_size,J.w_size,0),re=le,Ee=J.w_size),oe=h.avail_in,se=h.next_in,q=h.input,h.avail_in=Ee,h.next_in=0,h.input=re,Ke(J);J.lookahead>=ee;){for(O=J.strstart,I=J.lookahead-(ee-1);J.ins_h=(J.ins_h<<J.hash_shift^J.window[O+ee-1])&J.hash_mask,J.prev[O&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=O,O++,--I;);J.strstart=O,J.lookahead=ee-1,Ke(J)}return J.strstart+=J.lookahead,J.block_start=J.strstart,J.insert=J.lookahead,J.lookahead=0,J.match_length=J.prev_length=ee-1,J.match_available=0,h.next_in=se,h.input=q,h.avail_in=oe,J.wrap=G,y},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,s,a){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,s,a){s.exports=function(o,f){var c,l,g,_,w,C,y,S,b,E,k,A,L,M,j,te,X,ue,ee,he,Ce,P,Q,m,ie;c=o.state,l=o.next_in,m=o.input,g=l+(o.avail_in-5),_=o.next_out,ie=o.output,w=_-(f-o.avail_out),C=_+(o.avail_out-257),y=c.dmax,S=c.wsize,b=c.whave,E=c.wnext,k=c.window,A=c.hold,L=c.bits,M=c.lencode,j=c.distcode,te=(1<<c.lenbits)-1,X=(1<<c.distbits)-1;e:do{L<15&&(A+=m[l++]<<L,L+=8,A+=m[l++]<<L,L+=8),ue=M[A&te];t:for(;;){if(A>>>=ee=ue>>>24,L-=ee,(ee=ue>>>16&255)===0)ie[_++]=65535&ue;else{if(!(16&ee)){if((64&ee)==0){ue=M[(65535&ue)+(A&(1<<ee)-1)];continue t}if(32&ee){c.mode=12;break e}o.msg="invalid literal/length code",c.mode=30;break e}he=65535&ue,(ee&=15)&&(L<ee&&(A+=m[l++]<<L,L+=8),he+=A&(1<<ee)-1,A>>>=ee,L-=ee),L<15&&(A+=m[l++]<<L,L+=8,A+=m[l++]<<L,L+=8),ue=j[A&X];r:for(;;){if(A>>>=ee=ue>>>24,L-=ee,!(16&(ee=ue>>>16&255))){if((64&ee)==0){ue=j[(65535&ue)+(A&(1<<ee)-1)];continue r}o.msg="invalid distance code",c.mode=30;break e}if(Ce=65535&ue,L<(ee&=15)&&(A+=m[l++]<<L,(L+=8)<ee&&(A+=m[l++]<<L,L+=8)),y<(Ce+=A&(1<<ee)-1)){o.msg="invalid distance too far back",c.mode=30;break e}if(A>>>=ee,L-=ee,(ee=_-w)<Ce){if(b<(ee=Ce-ee)&&c.sane){o.msg="invalid distance too far back",c.mode=30;break e}if(Q=k,(P=0)===E){if(P+=S-ee,ee<he){for(he-=ee;ie[_++]=k[P++],--ee;);P=_-Ce,Q=ie}}else if(E<ee){if(P+=S+E-ee,(ee-=E)<he){for(he-=ee;ie[_++]=k[P++],--ee;);if(P=0,E<he){for(he-=ee=E;ie[_++]=k[P++],--ee;);P=_-Ce,Q=ie}}}else if(P+=E-ee,ee<he){for(he-=ee;ie[_++]=k[P++],--ee;);P=_-Ce,Q=ie}for(;2<he;)ie[_++]=Q[P++],ie[_++]=Q[P++],ie[_++]=Q[P++],he-=3;he&&(ie[_++]=Q[P++],1<he&&(ie[_++]=Q[P++]))}else{for(P=_-Ce;ie[_++]=ie[P++],ie[_++]=ie[P++],ie[_++]=ie[P++],2<(he-=3););he&&(ie[_++]=ie[P++],1<he&&(ie[_++]=ie[P++]))}break}}break}}while(l<g&&_<C);l-=he=L>>3,A&=(1<<(L-=he<<3))-1,o.next_in=l,o.next_out=_,o.avail_in=l<g?g-l+5:5-(l-g),o.avail_out=_<C?C-_+257:257-(_-C),c.hold=A,c.bits=L}},{}],49:[function(r,s,a){var o=r("../utils/common"),f=r("./adler32"),c=r("./crc32"),l=r("./inffast"),g=r("./inftrees"),_=1,w=2,C=0,y=-2,S=1,b=852,E=592;function k(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function L(P){var Q;return P&&P.state?(Q=P.state,P.total_in=P.total_out=Q.total=0,P.msg="",Q.wrap&&(P.adler=1&Q.wrap),Q.mode=S,Q.last=0,Q.havedict=0,Q.dmax=32768,Q.head=null,Q.hold=0,Q.bits=0,Q.lencode=Q.lendyn=new o.Buf32(b),Q.distcode=Q.distdyn=new o.Buf32(E),Q.sane=1,Q.back=-1,C):y}function M(P){var Q;return P&&P.state?((Q=P.state).wsize=0,Q.whave=0,Q.wnext=0,L(P)):y}function j(P,Q){var m,ie;return P&&P.state?(ie=P.state,Q<0?(m=0,Q=-Q):(m=1+(Q>>4),Q<48&&(Q&=15)),Q&&(Q<8||15<Q)?y:(ie.window!==null&&ie.wbits!==Q&&(ie.window=null),ie.wrap=m,ie.wbits=Q,M(P))):y}function te(P,Q){var m,ie;return P?(ie=new A,(P.state=ie).window=null,(m=j(P,Q))!==C&&(P.state=null),m):y}var X,ue,ee=!0;function he(P){if(ee){var Q;for(X=new o.Buf32(512),ue=new o.Buf32(32),Q=0;Q<144;)P.lens[Q++]=8;for(;Q<256;)P.lens[Q++]=9;for(;Q<280;)P.lens[Q++]=7;for(;Q<288;)P.lens[Q++]=8;for(g(_,P.lens,0,288,X,0,P.work,{bits:9}),Q=0;Q<32;)P.lens[Q++]=5;g(w,P.lens,0,32,ue,0,P.work,{bits:5}),ee=!1}P.lencode=X,P.lenbits=9,P.distcode=ue,P.distbits=5}function Ce(P,Q,m,ie){var Te,ae=P.state;return ae.window===null&&(ae.wsize=1<<ae.wbits,ae.wnext=0,ae.whave=0,ae.window=new o.Buf8(ae.wsize)),ie>=ae.wsize?(o.arraySet(ae.window,Q,m-ae.wsize,ae.wsize,0),ae.wnext=0,ae.whave=ae.wsize):(ie<(Te=ae.wsize-ae.wnext)&&(Te=ie),o.arraySet(ae.window,Q,m-ie,Te,ae.wnext),(ie-=Te)?(o.arraySet(ae.window,Q,m-ie,ie,0),ae.wnext=ie,ae.whave=ae.wsize):(ae.wnext+=Te,ae.wnext===ae.wsize&&(ae.wnext=0),ae.whave<ae.wsize&&(ae.whave+=Te))),0}a.inflateReset=M,a.inflateReset2=j,a.inflateResetKeep=L,a.inflateInit=function(P){return te(P,15)},a.inflateInit2=te,a.inflate=function(P,Q){var m,ie,Te,ae,Pe,ce,Ae,Y,Z,Oe,ke,ye,Ke,Qe,Ue,me,He,De,Re,nt,h,re,J,O,I=0,G=new o.Buf8(4),oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return y;(m=P.state).mode===12&&(m.mode=13),Pe=P.next_out,Te=P.output,Ae=P.avail_out,ae=P.next_in,ie=P.input,ce=P.avail_in,Y=m.hold,Z=m.bits,Oe=ce,ke=Ae,re=C;e:for(;;)switch(m.mode){case S:if(m.wrap===0){m.mode=13;break}for(;Z<16;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(2&m.wrap&&Y===35615){G[m.check=0]=255&Y,G[1]=Y>>>8&255,m.check=c(m.check,G,2,0),Z=Y=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&Y)<<8)+(Y>>8))%31){P.msg="incorrect header check",m.mode=30;break}if((15&Y)!=8){P.msg="unknown compression method",m.mode=30;break}if(Z-=4,h=8+(15&(Y>>>=4)),m.wbits===0)m.wbits=h;else if(h>m.wbits){P.msg="invalid window size",m.mode=30;break}m.dmax=1<<h,P.adler=m.check=1,m.mode=512&Y?10:12,Z=Y=0;break;case 2:for(;Z<16;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(m.flags=Y,(255&m.flags)!=8){P.msg="unknown compression method",m.mode=30;break}if(57344&m.flags){P.msg="unknown header flags set",m.mode=30;break}m.head&&(m.head.text=Y>>8&1),512&m.flags&&(G[0]=255&Y,G[1]=Y>>>8&255,m.check=c(m.check,G,2,0)),Z=Y=0,m.mode=3;case 3:for(;Z<32;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}m.head&&(m.head.time=Y),512&m.flags&&(G[0]=255&Y,G[1]=Y>>>8&255,G[2]=Y>>>16&255,G[3]=Y>>>24&255,m.check=c(m.check,G,4,0)),Z=Y=0,m.mode=4;case 4:for(;Z<16;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}m.head&&(m.head.xflags=255&Y,m.head.os=Y>>8),512&m.flags&&(G[0]=255&Y,G[1]=Y>>>8&255,m.check=c(m.check,G,2,0)),Z=Y=0,m.mode=5;case 5:if(1024&m.flags){for(;Z<16;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}m.length=Y,m.head&&(m.head.extra_len=Y),512&m.flags&&(G[0]=255&Y,G[1]=Y>>>8&255,m.check=c(m.check,G,2,0)),Z=Y=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&(ce<(ye=m.length)&&(ye=ce),ye&&(m.head&&(h=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Array(m.head.extra_len)),o.arraySet(m.head.extra,ie,ae,ye,h)),512&m.flags&&(m.check=c(m.check,ie,ye,ae)),ce-=ye,ae+=ye,m.length-=ye),m.length))break e;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(ce===0)break e;for(ye=0;h=ie[ae+ye++],m.head&&h&&m.length<65536&&(m.head.name+=String.fromCharCode(h)),h&&ye<ce;);if(512&m.flags&&(m.check=c(m.check,ie,ye,ae)),ce-=ye,ae+=ye,h)break e}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(ce===0)break e;for(ye=0;h=ie[ae+ye++],m.head&&h&&m.length<65536&&(m.head.comment+=String.fromCharCode(h)),h&&ye<ce;);if(512&m.flags&&(m.check=c(m.check,ie,ye,ae)),ce-=ye,ae+=ye,h)break e}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;Z<16;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(Y!==(65535&m.check)){P.msg="header crc mismatch",m.mode=30;break}Z=Y=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),P.adler=m.check=0,m.mode=12;break;case 10:for(;Z<32;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}P.adler=m.check=k(Y),Z=Y=0,m.mode=11;case 11:if(m.havedict===0)return P.next_out=Pe,P.avail_out=Ae,P.next_in=ae,P.avail_in=ce,m.hold=Y,m.bits=Z,2;P.adler=m.check=1,m.mode=12;case 12:if(Q===5||Q===6)break e;case 13:if(m.last){Y>>>=7&Z,Z-=7&Z,m.mode=27;break}for(;Z<3;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}switch(m.last=1&Y,Z-=1,3&(Y>>>=1)){case 0:m.mode=14;break;case 1:if(he(m),m.mode=20,Q!==6)break;Y>>>=2,Z-=2;break e;case 2:m.mode=17;break;case 3:P.msg="invalid block type",m.mode=30}Y>>>=2,Z-=2;break;case 14:for(Y>>>=7&Z,Z-=7&Z;Z<32;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if((65535&Y)!=(Y>>>16^65535)){P.msg="invalid stored block lengths",m.mode=30;break}if(m.length=65535&Y,Z=Y=0,m.mode=15,Q===6)break e;case 15:m.mode=16;case 16:if(ye=m.length){if(ce<ye&&(ye=ce),Ae<ye&&(ye=Ae),ye===0)break e;o.arraySet(Te,ie,ae,ye,Pe),ce-=ye,ae+=ye,Ae-=ye,Pe+=ye,m.length-=ye;break}m.mode=12;break;case 17:for(;Z<14;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(m.nlen=257+(31&Y),Y>>>=5,Z-=5,m.ndist=1+(31&Y),Y>>>=5,Z-=5,m.ncode=4+(15&Y),Y>>>=4,Z-=4,286<m.nlen||30<m.ndist){P.msg="too many length or distance symbols",m.mode=30;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;Z<3;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}m.lens[oe[m.have++]]=7&Y,Y>>>=3,Z-=3}for(;m.have<19;)m.lens[oe[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,J={bits:m.lenbits},re=g(0,m.lens,0,19,m.lencode,0,m.work,J),m.lenbits=J.bits,re){P.msg="invalid code lengths set",m.mode=30;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;me=(I=m.lencode[Y&(1<<m.lenbits)-1])>>>16&255,He=65535&I,!((Ue=I>>>24)<=Z);){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(He<16)Y>>>=Ue,Z-=Ue,m.lens[m.have++]=He;else{if(He===16){for(O=Ue+2;Z<O;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(Y>>>=Ue,Z-=Ue,m.have===0){P.msg="invalid bit length repeat",m.mode=30;break}h=m.lens[m.have-1],ye=3+(3&Y),Y>>>=2,Z-=2}else if(He===17){for(O=Ue+3;Z<O;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}Z-=Ue,h=0,ye=3+(7&(Y>>>=Ue)),Y>>>=3,Z-=3}else{for(O=Ue+7;Z<O;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}Z-=Ue,h=0,ye=11+(127&(Y>>>=Ue)),Y>>>=7,Z-=7}if(m.have+ye>m.nlen+m.ndist){P.msg="invalid bit length repeat",m.mode=30;break}for(;ye--;)m.lens[m.have++]=h}}if(m.mode===30)break;if(m.lens[256]===0){P.msg="invalid code -- missing end-of-block",m.mode=30;break}if(m.lenbits=9,J={bits:m.lenbits},re=g(_,m.lens,0,m.nlen,m.lencode,0,m.work,J),m.lenbits=J.bits,re){P.msg="invalid literal/lengths set",m.mode=30;break}if(m.distbits=6,m.distcode=m.distdyn,J={bits:m.distbits},re=g(w,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,J),m.distbits=J.bits,re){P.msg="invalid distances set",m.mode=30;break}if(m.mode=20,Q===6)break e;case 20:m.mode=21;case 21:if(6<=ce&&258<=Ae){P.next_out=Pe,P.avail_out=Ae,P.next_in=ae,P.avail_in=ce,m.hold=Y,m.bits=Z,l(P,ke),Pe=P.next_out,Te=P.output,Ae=P.avail_out,ae=P.next_in,ie=P.input,ce=P.avail_in,Y=m.hold,Z=m.bits,m.mode===12&&(m.back=-1);break}for(m.back=0;me=(I=m.lencode[Y&(1<<m.lenbits)-1])>>>16&255,He=65535&I,!((Ue=I>>>24)<=Z);){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(me&&(240&me)==0){for(De=Ue,Re=me,nt=He;me=(I=m.lencode[nt+((Y&(1<<De+Re)-1)>>De)])>>>16&255,He=65535&I,!(De+(Ue=I>>>24)<=Z);){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}Y>>>=De,Z-=De,m.back+=De}if(Y>>>=Ue,Z-=Ue,m.back+=Ue,m.length=He,me===0){m.mode=26;break}if(32&me){m.back=-1,m.mode=12;break}if(64&me){P.msg="invalid literal/length code",m.mode=30;break}m.extra=15&me,m.mode=22;case 22:if(m.extra){for(O=m.extra;Z<O;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}m.length+=Y&(1<<m.extra)-1,Y>>>=m.extra,Z-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;me=(I=m.distcode[Y&(1<<m.distbits)-1])>>>16&255,He=65535&I,!((Ue=I>>>24)<=Z);){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if((240&me)==0){for(De=Ue,Re=me,nt=He;me=(I=m.distcode[nt+((Y&(1<<De+Re)-1)>>De)])>>>16&255,He=65535&I,!(De+(Ue=I>>>24)<=Z);){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}Y>>>=De,Z-=De,m.back+=De}if(Y>>>=Ue,Z-=Ue,m.back+=Ue,64&me){P.msg="invalid distance code",m.mode=30;break}m.offset=He,m.extra=15&me,m.mode=24;case 24:if(m.extra){for(O=m.extra;Z<O;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}m.offset+=Y&(1<<m.extra)-1,Y>>>=m.extra,Z-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){P.msg="invalid distance too far back",m.mode=30;break}m.mode=25;case 25:if(Ae===0)break e;if(ye=ke-Ae,m.offset>ye){if((ye=m.offset-ye)>m.whave&&m.sane){P.msg="invalid distance too far back",m.mode=30;break}Ke=ye>m.wnext?(ye-=m.wnext,m.wsize-ye):m.wnext-ye,ye>m.length&&(ye=m.length),Qe=m.window}else Qe=Te,Ke=Pe-m.offset,ye=m.length;for(Ae<ye&&(ye=Ae),Ae-=ye,m.length-=ye;Te[Pe++]=Qe[Ke++],--ye;);m.length===0&&(m.mode=21);break;case 26:if(Ae===0)break e;Te[Pe++]=m.length,Ae--,m.mode=21;break;case 27:if(m.wrap){for(;Z<32;){if(ce===0)break e;ce--,Y|=ie[ae++]<<Z,Z+=8}if(ke-=Ae,P.total_out+=ke,m.total+=ke,ke&&(P.adler=m.check=m.flags?c(m.check,Te,ke,Pe-ke):f(m.check,Te,ke,Pe-ke)),ke=Ae,(m.flags?Y:k(Y))!==m.check){P.msg="incorrect data check",m.mode=30;break}Z=Y=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;Z<32;){if(ce===0)break e;ce--,Y+=ie[ae++]<<Z,Z+=8}if(Y!==(4294967295&m.total)){P.msg="incorrect length check",m.mode=30;break}Z=Y=0}m.mode=29;case 29:re=1;break e;case 30:re=-3;break e;case 31:return-4;case 32:default:return y}return P.next_out=Pe,P.avail_out=Ae,P.next_in=ae,P.avail_in=ce,m.hold=Y,m.bits=Z,(m.wsize||ke!==P.avail_out&&m.mode<30&&(m.mode<27||Q!==4))&&Ce(P,P.output,P.next_out,ke-P.avail_out)?(m.mode=31,-4):(Oe-=P.avail_in,ke-=P.avail_out,P.total_in+=Oe,P.total_out+=ke,m.total+=ke,m.wrap&&ke&&(P.adler=m.check=m.flags?c(m.check,Te,ke,P.next_out-ke):f(m.check,Te,ke,P.next_out-ke)),P.data_type=m.bits+(m.last?64:0)+(m.mode===12?128:0)+(m.mode===20||m.mode===15?256:0),(Oe==0&&ke===0||Q===4)&&re===C&&(re=-5),re)},a.inflateEnd=function(P){if(!P||!P.state)return y;var Q=P.state;return Q.window&&(Q.window=null),P.state=null,C},a.inflateGetHeader=function(P,Q){var m;return P&&P.state?(2&(m=P.state).wrap)==0?y:((m.head=Q).done=!1,C):y},a.inflateSetDictionary=function(P,Q){var m,ie=Q.length;return P&&P.state?(m=P.state).wrap!==0&&m.mode!==11?y:m.mode===11&&f(1,Q,ie,0)!==m.check?-3:Ce(P,Q,ie,ie)?(m.mode=31,-4):(m.havedict=1,C):y},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,s,a){var o=r("../utils/common"),f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(_,w,C,y,S,b,E,k){var A,L,M,j,te,X,ue,ee,he,Ce=k.bits,P=0,Q=0,m=0,ie=0,Te=0,ae=0,Pe=0,ce=0,Ae=0,Y=0,Z=null,Oe=0,ke=new o.Buf16(16),ye=new o.Buf16(16),Ke=null,Qe=0;for(P=0;P<=15;P++)ke[P]=0;for(Q=0;Q<y;Q++)ke[w[C+Q]]++;for(Te=Ce,ie=15;1<=ie&&ke[ie]===0;ie--);if(ie<Te&&(Te=ie),ie===0)return S[b++]=20971520,S[b++]=20971520,k.bits=1,0;for(m=1;m<ie&&ke[m]===0;m++);for(Te<m&&(Te=m),P=ce=1;P<=15;P++)if(ce<<=1,(ce-=ke[P])<0)return-1;if(0<ce&&(_===0||ie!==1))return-1;for(ye[1]=0,P=1;P<15;P++)ye[P+1]=ye[P]+ke[P];for(Q=0;Q<y;Q++)w[C+Q]!==0&&(E[ye[w[C+Q]]++]=Q);if(X=_===0?(Z=Ke=E,19):_===1?(Z=f,Oe-=257,Ke=c,Qe-=257,256):(Z=l,Ke=g,-1),P=m,te=b,Pe=Q=Y=0,M=-1,j=(Ae=1<<(ae=Te))-1,_===1&&852<Ae||_===2&&592<Ae)return 1;for(;;){for(ue=P-Pe,he=E[Q]<X?(ee=0,E[Q]):E[Q]>X?(ee=Ke[Qe+E[Q]],Z[Oe+E[Q]]):(ee=96,0),A=1<<P-Pe,m=L=1<<ae;S[te+(Y>>Pe)+(L-=A)]=ue<<24|ee<<16|he|0,L!==0;);for(A=1<<P-1;Y&A;)A>>=1;if(A!==0?(Y&=A-1,Y+=A):Y=0,Q++,--ke[P]==0){if(P===ie)break;P=w[C+E[Q]]}if(Te<P&&(Y&j)!==M){for(Pe===0&&(Pe=Te),te+=m,ce=1<<(ae=P-Pe);ae+Pe<ie&&!((ce-=ke[ae+Pe])<=0);)ae++,ce<<=1;if(Ae+=1<<ae,_===1&&852<Ae||_===2&&592<Ae)return 1;S[M=Y&j]=Te<<24|ae<<16|te-b|0}}return Y!==0&&(S[te+Y]=P-Pe<<24|64<<16|0),k.bits=Te,0}},{"../utils/common":41}],51:[function(r,s,a){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,s,a){var o=r("../utils/common"),f=0,c=1;function l(I){for(var G=I.length;0<=--G;)I[G]=0}var g=0,_=29,w=256,C=w+1+_,y=30,S=19,b=2*C+1,E=15,k=16,A=7,L=256,M=16,j=17,te=18,X=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ue=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],he=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ce=new Array(2*(C+2));l(Ce);var P=new Array(2*y);l(P);var Q=new Array(512);l(Q);var m=new Array(256);l(m);var ie=new Array(_);l(ie);var Te,ae,Pe,ce=new Array(y);function Ae(I,G,oe,se,q){this.static_tree=I,this.extra_bits=G,this.extra_base=oe,this.elems=se,this.max_length=q,this.has_stree=I&&I.length}function Y(I,G){this.dyn_tree=I,this.max_code=0,this.stat_desc=G}function Z(I){return I<256?Q[I]:Q[256+(I>>>7)]}function Oe(I,G){I.pending_buf[I.pending++]=255&G,I.pending_buf[I.pending++]=G>>>8&255}function ke(I,G,oe){I.bi_valid>k-oe?(I.bi_buf|=G<<I.bi_valid&65535,Oe(I,I.bi_buf),I.bi_buf=G>>k-I.bi_valid,I.bi_valid+=oe-k):(I.bi_buf|=G<<I.bi_valid&65535,I.bi_valid+=oe)}function ye(I,G,oe){ke(I,oe[2*G],oe[2*G+1])}function Ke(I,G){for(var oe=0;oe|=1&I,I>>>=1,oe<<=1,0<--G;);return oe>>>1}function Qe(I,G,oe){var se,q,le=new Array(E+1),Ee=0;for(se=1;se<=E;se++)le[se]=Ee=Ee+oe[se-1]<<1;for(q=0;q<=G;q++){var pe=I[2*q+1];pe!==0&&(I[2*q]=Ke(le[pe]++,pe))}}function Ue(I){var G;for(G=0;G<C;G++)I.dyn_ltree[2*G]=0;for(G=0;G<y;G++)I.dyn_dtree[2*G]=0;for(G=0;G<S;G++)I.bl_tree[2*G]=0;I.dyn_ltree[2*L]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function me(I){8<I.bi_valid?Oe(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function He(I,G,oe,se){var q=2*G,le=2*oe;return I[q]<I[le]||I[q]===I[le]&&se[G]<=se[oe]}function De(I,G,oe){for(var se=I.heap[oe],q=oe<<1;q<=I.heap_len&&(q<I.heap_len&&He(G,I.heap[q+1],I.heap[q],I.depth)&&q++,!He(G,se,I.heap[q],I.depth));)I.heap[oe]=I.heap[q],oe=q,q<<=1;I.heap[oe]=se}function Re(I,G,oe){var se,q,le,Ee,pe=0;if(I.last_lit!==0)for(;se=I.pending_buf[I.d_buf+2*pe]<<8|I.pending_buf[I.d_buf+2*pe+1],q=I.pending_buf[I.l_buf+pe],pe++,se===0?ye(I,q,G):(ye(I,(le=m[q])+w+1,G),(Ee=X[le])!==0&&ke(I,q-=ie[le],Ee),ye(I,le=Z(--se),oe),(Ee=ue[le])!==0&&ke(I,se-=ce[le],Ee)),pe<I.last_lit;);ye(I,L,G)}function nt(I,G){var oe,se,q,le=G.dyn_tree,Ee=G.stat_desc.static_tree,pe=G.stat_desc.has_stree,Se=G.stat_desc.elems,Ge=-1;for(I.heap_len=0,I.heap_max=b,oe=0;oe<Se;oe++)le[2*oe]!==0?(I.heap[++I.heap_len]=Ge=oe,I.depth[oe]=0):le[2*oe+1]=0;for(;I.heap_len<2;)le[2*(q=I.heap[++I.heap_len]=Ge<2?++Ge:0)]=1,I.depth[q]=0,I.opt_len--,pe&&(I.static_len-=Ee[2*q+1]);for(G.max_code=Ge,oe=I.heap_len>>1;1<=oe;oe--)De(I,le,oe);for(q=Se;oe=I.heap[1],I.heap[1]=I.heap[I.heap_len--],De(I,le,1),se=I.heap[1],I.heap[--I.heap_max]=oe,I.heap[--I.heap_max]=se,le[2*q]=le[2*oe]+le[2*se],I.depth[q]=(I.depth[oe]>=I.depth[se]?I.depth[oe]:I.depth[se])+1,le[2*oe+1]=le[2*se+1]=q,I.heap[1]=q++,De(I,le,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(ze,et){var wt,ut,dt,qe,It,gt,xe=et.dyn_tree,St=et.max_code,kt=et.stat_desc.static_tree,Yt=et.stat_desc.has_stree,we=et.stat_desc.extra_bits,Xt=et.stat_desc.extra_base,Ct=et.stat_desc.max_length,Ot=0;for(qe=0;qe<=E;qe++)ze.bl_count[qe]=0;for(xe[2*ze.heap[ze.heap_max]+1]=0,wt=ze.heap_max+1;wt<b;wt++)Ct<(qe=xe[2*xe[2*(ut=ze.heap[wt])+1]+1]+1)&&(qe=Ct,Ot++),xe[2*ut+1]=qe,St<ut||(ze.bl_count[qe]++,It=0,Xt<=ut&&(It=we[ut-Xt]),gt=xe[2*ut],ze.opt_len+=gt*(qe+It),Yt&&(ze.static_len+=gt*(kt[2*ut+1]+It)));if(Ot!==0){do{for(qe=Ct-1;ze.bl_count[qe]===0;)qe--;ze.bl_count[qe]--,ze.bl_count[qe+1]+=2,ze.bl_count[Ct]--,Ot-=2}while(0<Ot);for(qe=Ct;qe!==0;qe--)for(ut=ze.bl_count[qe];ut!==0;)St<(dt=ze.heap[--wt])||(xe[2*dt+1]!==qe&&(ze.opt_len+=(qe-xe[2*dt+1])*xe[2*dt],xe[2*dt+1]=qe),ut--)}}(I,G),Qe(le,Ge,I.bl_count)}function h(I,G,oe){var se,q,le=-1,Ee=G[1],pe=0,Se=7,Ge=4;for(Ee===0&&(Se=138,Ge=3),G[2*(oe+1)+1]=65535,se=0;se<=oe;se++)q=Ee,Ee=G[2*(se+1)+1],++pe<Se&&q===Ee||(pe<Ge?I.bl_tree[2*q]+=pe:q!==0?(q!==le&&I.bl_tree[2*q]++,I.bl_tree[2*M]++):pe<=10?I.bl_tree[2*j]++:I.bl_tree[2*te]++,le=q,Ge=(pe=0)===Ee?(Se=138,3):q===Ee?(Se=6,3):(Se=7,4))}function re(I,G,oe){var se,q,le=-1,Ee=G[1],pe=0,Se=7,Ge=4;for(Ee===0&&(Se=138,Ge=3),se=0;se<=oe;se++)if(q=Ee,Ee=G[2*(se+1)+1],!(++pe<Se&&q===Ee)){if(pe<Ge)for(;ye(I,q,I.bl_tree),--pe!=0;);else q!==0?(q!==le&&(ye(I,q,I.bl_tree),pe--),ye(I,M,I.bl_tree),ke(I,pe-3,2)):pe<=10?(ye(I,j,I.bl_tree),ke(I,pe-3,3)):(ye(I,te,I.bl_tree),ke(I,pe-11,7));le=q,Ge=(pe=0)===Ee?(Se=138,3):q===Ee?(Se=6,3):(Se=7,4)}}l(ce);var J=!1;function O(I,G,oe,se){ke(I,(g<<1)+(se?1:0),3),function(q,le,Ee,pe){me(q),Oe(q,Ee),Oe(q,~Ee),o.arraySet(q.pending_buf,q.window,le,Ee,q.pending),q.pending+=Ee}(I,G,oe)}a._tr_init=function(I){J||(function(){var G,oe,se,q,le,Ee=new Array(E+1);for(q=se=0;q<_-1;q++)for(ie[q]=se,G=0;G<1<<X[q];G++)m[se++]=q;for(m[se-1]=q,q=le=0;q<16;q++)for(ce[q]=le,G=0;G<1<<ue[q];G++)Q[le++]=q;for(le>>=7;q<y;q++)for(ce[q]=le<<7,G=0;G<1<<ue[q]-7;G++)Q[256+le++]=q;for(oe=0;oe<=E;oe++)Ee[oe]=0;for(G=0;G<=143;)Ce[2*G+1]=8,G++,Ee[8]++;for(;G<=255;)Ce[2*G+1]=9,G++,Ee[9]++;for(;G<=279;)Ce[2*G+1]=7,G++,Ee[7]++;for(;G<=287;)Ce[2*G+1]=8,G++,Ee[8]++;for(Qe(Ce,C+1,Ee),G=0;G<y;G++)P[2*G+1]=5,P[2*G]=Ke(G,5);Te=new Ae(Ce,X,w+1,C,E),ae=new Ae(P,ue,0,y,E),Pe=new Ae(new Array(0),ee,0,S,A)}(),J=!0),I.l_desc=new Y(I.dyn_ltree,Te),I.d_desc=new Y(I.dyn_dtree,ae),I.bl_desc=new Y(I.bl_tree,Pe),I.bi_buf=0,I.bi_valid=0,Ue(I)},a._tr_stored_block=O,a._tr_flush_block=function(I,G,oe,se){var q,le,Ee=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(pe){var Se,Ge=4093624447;for(Se=0;Se<=31;Se++,Ge>>>=1)if(1&Ge&&pe.dyn_ltree[2*Se]!==0)return f;if(pe.dyn_ltree[18]!==0||pe.dyn_ltree[20]!==0||pe.dyn_ltree[26]!==0)return c;for(Se=32;Se<w;Se++)if(pe.dyn_ltree[2*Se]!==0)return c;return f}(I)),nt(I,I.l_desc),nt(I,I.d_desc),Ee=function(pe){var Se;for(h(pe,pe.dyn_ltree,pe.l_desc.max_code),h(pe,pe.dyn_dtree,pe.d_desc.max_code),nt(pe,pe.bl_desc),Se=S-1;3<=Se&&pe.bl_tree[2*he[Se]+1]===0;Se--);return pe.opt_len+=3*(Se+1)+5+5+4,Se}(I),q=I.opt_len+3+7>>>3,(le=I.static_len+3+7>>>3)<=q&&(q=le)):q=le=oe+5,oe+4<=q&&G!==-1?O(I,G,oe,se):I.strategy===4||le===q?(ke(I,2+(se?1:0),3),Re(I,Ce,P)):(ke(I,4+(se?1:0),3),function(pe,Se,Ge,ze){var et;for(ke(pe,Se-257,5),ke(pe,Ge-1,5),ke(pe,ze-4,4),et=0;et<ze;et++)ke(pe,pe.bl_tree[2*he[et]+1],3);re(pe,pe.dyn_ltree,Se-1),re(pe,pe.dyn_dtree,Ge-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,Ee+1),Re(I,I.dyn_ltree,I.dyn_dtree)),Ue(I),se&&me(I)},a._tr_tally=function(I,G,oe){return I.pending_buf[I.d_buf+2*I.last_lit]=G>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&G,I.pending_buf[I.l_buf+I.last_lit]=255&oe,I.last_lit++,G===0?I.dyn_ltree[2*oe]++:(I.matches++,G--,I.dyn_ltree[2*(m[oe]+w+1)]++,I.dyn_dtree[2*Z(G)]++),I.last_lit===I.lit_bufsize-1},a._tr_align=function(I){ke(I,2,3),ye(I,L,Ce),function(G){G.bi_valid===16?(Oe(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):8<=G.bi_valid&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(r,s,a){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,s,a){(function(o){(function(f,c){if(!f.setImmediate){var l,g,_,w,C=1,y={},S=!1,b=f.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(f);E=E&&E.setTimeout?E:f,l={}.toString.call(f.process)==="[object process]"?function(M){process.nextTick(function(){A(M)})}:function(){if(f.postMessage&&!f.importScripts){var M=!0,j=f.onmessage;return f.onmessage=function(){M=!1},f.postMessage("","*"),f.onmessage=j,M}}()?(w="setImmediate$"+Math.random()+"$",f.addEventListener?f.addEventListener("message",L,!1):f.attachEvent("onmessage",L),function(M){f.postMessage(w+M,"*")}):f.MessageChannel?((_=new MessageChannel).port1.onmessage=function(M){A(M.data)},function(M){_.port2.postMessage(M)}):b&&"onreadystatechange"in b.createElement("script")?(g=b.documentElement,function(M){var j=b.createElement("script");j.onreadystatechange=function(){A(M),j.onreadystatechange=null,g.removeChild(j),j=null},g.appendChild(j)}):function(M){setTimeout(A,0,M)},E.setImmediate=function(M){typeof M!="function"&&(M=new Function(""+M));for(var j=new Array(arguments.length-1),te=0;te<j.length;te++)j[te]=arguments[te+1];var X={callback:M,args:j};return y[C]=X,l(C),C++},E.clearImmediate=k}function k(M){delete y[M]}function A(M){if(S)setTimeout(A,0,M);else{var j=y[M];if(j){S=!0;try{(function(te){var X=te.callback,ue=te.args;switch(ue.length){case 0:X();break;case 1:X(ue[0]);break;case 2:X(ue[0],ue[1]);break;case 3:X(ue[0],ue[1],ue[2]);break;default:X.apply(c,ue)}})(j)}finally{k(M),S=!1}}}}function L(M){M.source===f&&typeof M.data=="string"&&M.data.indexOf(w)===0&&A(+M.data.slice(w.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof _r<"u"?_r:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(Mn)),Mn.exports}so();function en(n){return Math.floor(Math.random()*Math.floor(n))}function Di(n){return n.toLowerCase().replace(/\s/g,"_")}function oo(n,e=198209835){let r,s,a=e===void 0?2166136261:e;for(r=0,s=n.length;r<s;r++)a^=n.charCodeAt(r),a+=(a<<1)+(a<<4)+(a<<7)+(a<<8)+(a<<24);return a>>>0}function ao(n){return n.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function uo(n,e=r=>r.toString()){const r={};for(let s=0;s<n.length;s++){const a=n[s],o=e(a),f=r[o];f?f.push(a):r[o]=[a]}return r}function qi(n,e,r){function s(o,f){if(yt(o))for(const c of Object.keys(o)){const l=o[c];if(yt(l)){if(f.push(c),Array.isArray(l))for(const g of l)r&&!r(g,c)||(e(g,c,o,f),s(g,f));else{if(r&&!r(l,c))continue;e(l,c,o,f),s(l,f)}f.pop()}else e(l,c,o,f)}}s(n,[])}function co(n,e){return[...n].sort((r,s)=>(e(r)??"").toString().localeCompare((e(s)??"").toString(),void 0,{numeric:!0}))}const lo=co;function fo(n,e){return n.sort((r,s)=>(e(r)??"").toString().localeCompare((e(s)??"").toString(),void 0,{numeric:!0}))}function Rt(n){return Object.create(n)}function ho(n,e,r){const s=n[e];s?s.includes(r)||s.push(r):n[e]=[r]}function vr(n,e,r){const s=n[e];s?s.push(r):n[e]=[r]}function sr(n,e,r){const s=n[e];s?s.indexOf(r)===-1&&s.push(r):n[e]=[r]}function Kn(n,e,r){const s=n[e];if(s){const a=s.indexOf(r);a>=0&&s.splice(a,1);return}}function yt(n){return n&&typeof n=="object"}function Wi(n){return!Object.getPrototypeOf(Object.getPrototypeOf(n))}function li(n,e){return n.startsWith(e)?n.substring(e.length):n}function po(n){const r=`^(?=.*${ao(n).split(" ").map(a=>`(?=.*${a})`).join("")}).*$`;return new RegExp(r,"i")}function go(){return[en(65535),en(65535),en(65535),en(65535)].map(n=>n.toString(16).padStart(4,"0")).join("-")}function mo(n,e){let r=n;for(;r&&!Object.is(r,r.parent);){if(e(r))return r;r=r.parent}}function yo(n,e){for(const r of n)if(e===r)return!0;return!1}const hs=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",vo=hs+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",bo="["+hs+"]["+vo+"]*",_o=new RegExp("^"+bo+"$");function ps(n,e){const r=[];let s=e.exec(n);for(;s;){const a=[];a.startIndex=e.lastIndex-s[0].length;const o=s.length;for(let f=0;f<o;f++)a.push(s[f]);r.push(a),s=e.exec(n)}return r}const fi=function(n){const e=_o.exec(n);return!(e===null||typeof e>"u")};function wo(n){return typeof n<"u"}const ko={allowBooleanAttributes:!1,unpairedTags:[]};function Eo(n,e){e=Object.assign({},ko,e);const r=[];let s=!1,a=!1;n[0]==="\uFEFF"&&(n=n.substr(1));for(let o=0;o<n.length;o++)if(n[o]==="<"&&n[o+1]==="?"){if(o+=2,o=Vi(n,o),o.err)return o}else if(n[o]==="<"){let f=o;if(o++,n[o]==="!"){o=Hi(n,o);continue}else{let c=!1;n[o]==="/"&&(c=!0,o++);let l="";for(;o<n.length&&n[o]!==">"&&n[o]!==" "&&n[o]!=="	"&&n[o]!==`
`&&n[o]!=="\r";o++)l+=n[o];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),o--),!No(l)){let w;return l.trim().length===0?w="Invalid space after '<'.":w="Tag '"+l+"' is an invalid name.",Je("InvalidTag",w,lt(n,o))}const g=So(n,o);if(g===!1)return Je("InvalidAttr","Attributes for '"+l+"' have open quote.",lt(n,o));let _=g.value;if(o=g.index,_[_.length-1]==="/"){const w=o-_.length;_=_.substring(0,_.length-1);const C=Yi(_,e);if(C===!0)s=!0;else return Je(C.err.code,C.err.msg,lt(n,w+C.err.line))}else if(c)if(g.tagClosed){if(_.trim().length>0)return Je("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",lt(n,f));if(r.length===0)return Je("InvalidTag","Closing tag '"+l+"' has not been opened.",lt(n,f));{const w=r.pop();if(l!==w.tagName){let C=lt(n,w.tagStartPos);return Je("InvalidTag","Expected closing tag '"+w.tagName+"' (opened in line "+C.line+", col "+C.col+") instead of closing tag '"+l+"'.",lt(n,f))}r.length==0&&(a=!0)}}else return Je("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",lt(n,o));else{const w=Yi(_,e);if(w!==!0)return Je(w.err.code,w.err.msg,lt(n,o-_.length+w.err.line));if(a===!0)return Je("InvalidXml","Multiple possible root nodes found.",lt(n,o));e.unpairedTags.indexOf(l)!==-1||r.push({tagName:l,tagStartPos:f}),s=!0}for(o++;o<n.length;o++)if(n[o]==="<")if(n[o+1]==="!"){o++,o=Hi(n,o);continue}else if(n[o+1]==="?"){if(o=Vi(n,++o),o.err)return o}else break;else if(n[o]==="&"){const w=Ao(n,o);if(w==-1)return Je("InvalidChar","char '&' is not expected.",lt(n,o));o=w}else if(a===!0&&!Zi(n[o]))return Je("InvalidXml","Extra text at the end",lt(n,o));n[o]==="<"&&o--}}else{if(Zi(n[o]))continue;return Je("InvalidChar","char '"+n[o]+"' is not expected.",lt(n,o))}if(s){if(r.length==1)return Je("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",lt(n,r[0].tagStartPos));if(r.length>0)return Je("InvalidXml","Invalid '"+JSON.stringify(r.map(o=>o.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Je("InvalidXml","Start tag expected.",1);return!0}function Zi(n){return n===" "||n==="	"||n===`
`||n==="\r"}function Vi(n,e){const r=e;for(;e<n.length;e++)if(n[e]=="?"||n[e]==" "){const s=n.substr(r,e-r);if(e>5&&s==="xml")return Je("InvalidXml","XML declaration allowed only at the start of the document.",lt(n,e));if(n[e]=="?"&&n[e+1]==">"){e++;break}else continue}return e}function Hi(n,e){if(n.length>e+5&&n[e+1]==="-"&&n[e+2]==="-"){for(e+=3;e<n.length;e++)if(n[e]==="-"&&n[e+1]==="-"&&n[e+2]===">"){e+=2;break}}else if(n.length>e+8&&n[e+1]==="D"&&n[e+2]==="O"&&n[e+3]==="C"&&n[e+4]==="T"&&n[e+5]==="Y"&&n[e+6]==="P"&&n[e+7]==="E"){let r=1;for(e+=8;e<n.length;e++)if(n[e]==="<")r++;else if(n[e]===">"&&(r--,r===0))break}else if(n.length>e+9&&n[e+1]==="["&&n[e+2]==="C"&&n[e+3]==="D"&&n[e+4]==="A"&&n[e+5]==="T"&&n[e+6]==="A"&&n[e+7]==="["){for(e+=8;e<n.length;e++)if(n[e]==="]"&&n[e+1]==="]"&&n[e+2]===">"){e+=2;break}}return e}const xo='"',Io="'";function So(n,e){let r="",s="",a=!1;for(;e<n.length;e++){if(n[e]===xo||n[e]===Io)s===""?s=n[e]:s!==n[e]||(s="");else if(n[e]===">"&&s===""){a=!0;break}r+=n[e]}return s!==""?!1:{value:r,index:e,tagClosed:a}}const Co=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Yi(n,e){const r=ps(n,Co),s={};for(let a=0;a<r.length;a++){if(r[a][1].length===0)return Je("InvalidAttr","Attribute '"+r[a][2]+"' has no space in starting.",br(r[a]));if(r[a][3]!==void 0&&r[a][4]===void 0)return Je("InvalidAttr","Attribute '"+r[a][2]+"' is without value.",br(r[a]));if(r[a][3]===void 0&&!e.allowBooleanAttributes)return Je("InvalidAttr","boolean attribute '"+r[a][2]+"' is not allowed.",br(r[a]));const o=r[a][2];if(!To(o))return Je("InvalidAttr","Attribute '"+o+"' is an invalid name.",br(r[a]));if(!s.hasOwnProperty(o))s[o]=1;else return Je("InvalidAttr","Attribute '"+o+"' is repeated.",br(r[a]))}return!0}function Oo(n,e){let r=/\d/;for(n[e]==="x"&&(e++,r=/[\da-fA-F]/);e<n.length;e++){if(n[e]===";")return e;if(!n[e].match(r))break}return-1}function Ao(n,e){if(e++,n[e]===";")return-1;if(n[e]==="#")return e++,Oo(n,e);let r=0;for(;e<n.length;e++,r++)if(!(n[e].match(/\w/)&&r<20)){if(n[e]===";")break;return-1}return e}function Je(n,e,r){return{err:{code:n,msg:e,line:r.line||r,col:r.col}}}function To(n){return fi(n)}function No(n){return fi(n)}function lt(n,e){const r=n.substring(0,e).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function br(n){return n.startIndex+n[1].length}const Po={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(n,e){return e},attributeValueProcessor:function(n,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(n,e,r){return n},captureMetaData:!1},Lo=function(n){return Object.assign({},Po,n)};let un;typeof Symbol!="function"?un="@@xmlMetadata":un=Symbol("XML Node Metadata");class Dt{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,r){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:r})}addChild(e,r){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),r!==void 0&&(this.child[this.child.length-1][un]={startIndex:r})}static getMetaDataSymbol(){return un}}function Bo(n,e){const r={};if(n[e+3]==="O"&&n[e+4]==="C"&&n[e+5]==="T"&&n[e+6]==="Y"&&n[e+7]==="P"&&n[e+8]==="E"){e=e+9;let s=1,a=!1,o=!1,f="";for(;e<n.length;e++)if(n[e]==="<"&&!o){if(a&&qt(n,"!ENTITY",e)){e+=7;let c,l;[c,l,e]=Ro(n,e+1),l.indexOf("&")===-1&&(r[c]={regx:RegExp(`&${c};`,"g"),val:l})}else if(a&&qt(n,"!ELEMENT",e)){e+=8;const{index:c}=Fo(n,e+1);e=c}else if(a&&qt(n,"!ATTLIST",e))e+=8;else if(a&&qt(n,"!NOTATION",e)){e+=9;const{index:c}=zo(n,e+1);e=c}else if(qt(n,"!--",e))o=!0;else throw new Error("Invalid DOCTYPE");s++,f=""}else if(n[e]===">"){if(o?n[e-1]==="-"&&n[e-2]==="-"&&(o=!1,s--):s--,s===0)break}else n[e]==="["?a=!0:f+=n[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:e}}const Ft=(n,e)=>{for(;e<n.length&&/\s/.test(n[e]);)e++;return e};function Ro(n,e){e=Ft(n,e);let r="";for(;e<n.length&&!/\s/.test(n[e])&&n[e]!=='"'&&n[e]!=="'";)r+=n[e],e++;if(di(r),e=Ft(n,e),n.substring(e,e+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(n[e]==="%")throw new Error("Parameter entities are not supported");let s="";return[e,s]=nn(n,e,"entity"),e--,[r,s,e]}function zo(n,e){e=Ft(n,e);let r="";for(;e<n.length&&!/\s/.test(n[e]);)r+=n[e],e++;di(r),e=Ft(n,e);const s=n.substring(e,e+6).toUpperCase();if(s!=="SYSTEM"&&s!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${s}"`);e+=s.length,e=Ft(n,e);let a=null,o=null;if(s==="PUBLIC")[e,a]=nn(n,e,"publicIdentifier"),e=Ft(n,e),(n[e]==='"'||n[e]==="'")&&([e,o]=nn(n,e,"systemIdentifier"));else if(s==="SYSTEM"&&([e,o]=nn(n,e,"systemIdentifier"),!o))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:r,publicIdentifier:a,systemIdentifier:o,index:--e}}function nn(n,e,r){let s="";const a=n[e];if(a!=='"'&&a!=="'")throw new Error(`Expected quoted string, found "${a}"`);for(e++;e<n.length&&n[e]!==a;)s+=n[e],e++;if(n[e]!==a)throw new Error(`Unterminated ${r} value`);return e++,[e,s]}function Fo(n,e){e=Ft(n,e);let r="";for(;e<n.length&&!/\s/.test(n[e]);)r+=n[e],e++;if(!di(r))throw new Error(`Invalid element name: "${r}"`);e=Ft(n,e);let s="";if(n[e]==="E"&&qt(n,"MPTY",e))e+=4;else if(n[e]==="A"&&qt(n,"NY",e))e+=2;else if(n[e]==="("){for(e++;e<n.length&&n[e]!==")";)s+=n[e],e++;if(n[e]!==")")throw new Error("Unterminated content model")}else throw new Error(`Invalid Element Expression, found "${n[e]}"`);return{elementName:r,contentModel:s.trim(),index:e}}function qt(n,e,r){for(let s=0;s<e.length;s++)if(e[s]!==n[r+s+1])return!1;return!0}function di(n){if(fi(n))return n;throw new Error(`Invalid entity name ${n}`)}const jo=/^[-+]?0x[a-fA-F0-9]+$/,Uo=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,$o={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Go(n,e={}){if(e=Object.assign({},$o,e),!n||typeof n!="string")return n;let r=n.trim();if(e.skipLike!==void 0&&e.skipLike.test(r))return n;if(n==="0")return 0;if(e.hex&&jo.test(r))return qo(r,16);if(r.search(/.+[eE].+/)!==-1)return Ko(n,r,e);{const s=Uo.exec(r);if(s){const a=s[1]||"",o=s[2];let f=Do(s[3]);const c=a?n[o.length+1]===".":n[o.length]===".";if(!e.leadingZeros&&(o.length>1||o.length===1&&!c))return n;{const l=Number(r),g=String(l);if(l===0)return l;if(g.search(/[eE]/)!==-1)return e.eNotation?l:n;if(r.indexOf(".")!==-1)return g==="0"||g===f||g===`${a}${f}`?l:n;let _=o?f:r;return o?_===g||a+_===g?l:n:_===g||_===a+g?l:n}}else return n}}const Mo=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function Ko(n,e,r){if(!r.eNotation)return n;const s=e.match(Mo);if(s){let a=s[1]||"";const o=s[3].indexOf("e")===-1?"E":"e",f=s[2],c=a?n[f.length+1]===o:n[f.length]===o;return f.length>1&&c?n:f.length===1&&(s[3].startsWith(`.${o}`)||s[3][0]===o)?Number(e):r.leadingZeros&&!c?(e=(s[1]||"")+s[3],Number(e)):n}else return n}function Do(n){return n&&n.indexOf(".")!==-1&&(n=n.replace(/0+$/,""),n==="."?n="0":n[0]==="."?n="0"+n:n[n.length-1]==="."&&(n=n.substring(0,n.length-1))),n}function qo(n,e){if(parseInt)return parseInt(n,e);if(Number.parseInt)return Number.parseInt(n,e);if(window&&window.parseInt)return window.parseInt(n,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function Wo(n){return typeof n=="function"?n:Array.isArray(n)?e=>{for(const r of n)if(typeof r=="string"&&e===r||r instanceof RegExp&&r.test(e))return!0}:()=>!1}class Zo{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,s)=>String.fromCodePoint(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,s)=>String.fromCodePoint(Number.parseInt(s,16))}},this.addExternalEntities=Vo,this.parseXml=Qo,this.parseTextData=Ho,this.resolveNameSpace=Yo,this.buildAttributesMap=Jo,this.isItStopNode=na,this.replaceEntitiesValue=ta,this.readStopNodeData=sa,this.saveTextToParentTag=ra,this.addChild=ea,this.ignoreAttributesFn=Wo(this.options.ignoreAttributes)}}function Vo(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const s=e[r];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:n[s]}}}function Ho(n,e,r,s,a,o,f){if(n!==void 0&&(this.options.trimValues&&!s&&(n=n.trim()),n.length>0)){f||(n=this.replaceEntitiesValue(n));const c=this.options.tagValueProcessor(e,n,r,a,o);return c==null?n:typeof c!=typeof n||c!==n?c:this.options.trimValues?ni(n,this.options.parseTagValue,this.options.numberParseOptions):n.trim()===n?ni(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function Yo(n){if(this.options.removeNSPrefix){const e=n.split(":"),r=n.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(n=r+e[1])}return n}const Xo=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Jo(n,e,r){if(this.options.ignoreAttributes!==!0&&typeof n=="string"){const s=ps(n,Xo),a=s.length,o={};for(let f=0;f<a;f++){const c=this.resolveNameSpace(s[f][1]);if(this.ignoreAttributesFn(c,e))continue;let l=s[f][4],g=this.options.attributeNamePrefix+c;if(c.length)if(this.options.transformAttributeName&&(g=this.options.transformAttributeName(g)),g==="__proto__"&&(g="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const _=this.options.attributeValueProcessor(c,l,e);_==null?o[g]=l:typeof _!=typeof l||_!==l?o[g]=_:o[g]=ni(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(o[g]=!0)}if(!Object.keys(o).length)return;if(this.options.attributesGroupName){const f={};return f[this.options.attributesGroupName]=o,f}return o}}const Qo=function(n){n=n.replace(/\r\n?/g,`
`);const e=new Dt("!xml");let r=e,s="",a="";for(let o=0;o<n.length;o++)if(n[o]==="<")if(n[o+1]==="/"){const c=Zt(n,">",o,"Closing Tag is not closed.");let l=n.substring(o+2,c).trim();if(this.options.removeNSPrefix){const w=l.indexOf(":");w!==-1&&(l=l.substr(w+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),r&&(s=this.saveTextToParentTag(s,r,a));const g=a.substring(a.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${l}>`);let _=0;g&&this.options.unpairedTags.indexOf(g)!==-1?(_=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):_=a.lastIndexOf("."),a=a.substring(0,_),r=this.tagsNodeStack.pop(),s="",o=c}else if(n[o+1]==="?"){let c=ri(n,o,!1,"?>");if(!c)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,r,a),!(this.options.ignoreDeclaration&&c.tagName==="?xml"||this.options.ignorePiTags)){const l=new Dt(c.tagName);l.add(this.options.textNodeName,""),c.tagName!==c.tagExp&&c.attrExpPresent&&(l[":@"]=this.buildAttributesMap(c.tagExp,a,c.tagName)),this.addChild(r,l,a,o)}o=c.closeIndex+1}else if(n.substr(o+1,3)==="!--"){const c=Zt(n,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){const l=n.substring(o+4,c-2);s=this.saveTextToParentTag(s,r,a),r.add(this.options.commentPropName,[{[this.options.textNodeName]:l}])}o=c}else if(n.substr(o+1,2)==="!D"){const c=Bo(n,o);this.docTypeEntities=c.entities,o=c.i}else if(n.substr(o+1,2)==="!["){const c=Zt(n,"]]>",o,"CDATA is not closed.")-2,l=n.substring(o+9,c);s=this.saveTextToParentTag(s,r,a);let g=this.parseTextData(l,r.tagname,a,!0,!1,!0,!0);g==null&&(g=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:l}]):r.add(this.options.textNodeName,g),o=c+2}else{let c=ri(n,o,this.options.removeNSPrefix),l=c.tagName;const g=c.rawTagName;let _=c.tagExp,w=c.attrExpPresent,C=c.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),r&&s&&r.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,r,a,!1));const y=r;y&&this.options.unpairedTags.indexOf(y.tagname)!==-1&&(r=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),l!==e.tagname&&(a+=a?"."+l:l);const S=o;if(this.isItStopNode(this.options.stopNodes,a,l)){let b="";if(_.length>0&&_.lastIndexOf("/")===_.length-1)l[l.length-1]==="/"?(l=l.substr(0,l.length-1),a=a.substr(0,a.length-1),_=l):_=_.substr(0,_.length-1),o=c.closeIndex;else if(this.options.unpairedTags.indexOf(l)!==-1)o=c.closeIndex;else{const k=this.readStopNodeData(n,g,C+1);if(!k)throw new Error(`Unexpected end of ${g}`);o=k.i,b=k.tagContent}const E=new Dt(l);l!==_&&w&&(E[":@"]=this.buildAttributesMap(_,a,l)),b&&(b=this.parseTextData(b,l,a,!0,w,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),E.add(this.options.textNodeName,b),this.addChild(r,E,a,S)}else{if(_.length>0&&_.lastIndexOf("/")===_.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),a=a.substr(0,a.length-1),_=l):_=_.substr(0,_.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const b=new Dt(l);l!==_&&w&&(b[":@"]=this.buildAttributesMap(_,a,l)),this.addChild(r,b,a,S),a=a.substr(0,a.lastIndexOf("."))}else{const b=new Dt(l);this.tagsNodeStack.push(r),l!==_&&w&&(b[":@"]=this.buildAttributesMap(_,a,l)),this.addChild(r,b,a,S),r=b}s="",o=C}}else s+=n[o];return e.child};function ea(n,e,r,s){this.options.captureMetaData||(s=void 0);const a=this.options.updateTag(e.tagname,r,e[":@"]);a===!1||(typeof a=="string"&&(e.tagname=a),n.addChild(e,s))}const ta=function(n){if(this.options.processEntities){for(let e in this.docTypeEntities){const r=this.docTypeEntities[e];n=n.replace(r.regx,r.val)}for(let e in this.lastEntities){const r=this.lastEntities[e];n=n.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const r=this.htmlEntities[e];n=n.replace(r.regex,r.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function ra(n,e,r,s){return n&&(s===void 0&&(s=e.child.length===0),n=this.parseTextData(n,e.tagname,r,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),n!==void 0&&n!==""&&e.add(this.options.textNodeName,n),n=""),n}function na(n,e,r){const s="*."+r;for(const a in n){const o=n[a];if(s===o||e===o)return!0}return!1}function ia(n,e,r=">"){let s,a="";for(let o=e;o<n.length;o++){let f=n[o];if(s)f===s&&(s="");else if(f==='"'||f==="'")s=f;else if(f===r[0])if(r[1]){if(n[o+1]===r[1])return{data:a,index:o}}else return{data:a,index:o};else f==="	"&&(f=" ");a+=f}}function Zt(n,e,r,s){const a=n.indexOf(e,r);if(a===-1)throw new Error(s);return a+e.length-1}function ri(n,e,r,s=">"){const a=ia(n,e+1,s);if(!a)return;let o=a.data;const f=a.index,c=o.search(/\s/);let l=o,g=!0;c!==-1&&(l=o.substring(0,c),o=o.substring(c+1).trimStart());const _=l;if(r){const w=l.indexOf(":");w!==-1&&(l=l.substr(w+1),g=l!==a.data.substr(w+1))}return{tagName:l,tagExp:o,closeIndex:f,attrExpPresent:g,rawTagName:_}}function sa(n,e,r){const s=r;let a=1;for(;r<n.length;r++)if(n[r]==="<")if(n[r+1]==="/"){const o=Zt(n,">",r,`${e} is not closed`);if(n.substring(r+2,o).trim()===e&&(a--,a===0))return{tagContent:n.substring(s,r),i:o};r=o}else if(n[r+1]==="?")r=Zt(n,"?>",r+1,"StopNode is not closed.");else if(n.substr(r+1,3)==="!--")r=Zt(n,"-->",r+3,"StopNode is not closed.");else if(n.substr(r+1,2)==="![")r=Zt(n,"]]>",r,"StopNode is not closed.")-2;else{const o=ri(n,r,">");o&&((o&&o.tagName)===e&&o.tagExp[o.tagExp.length-1]!=="/"&&a++,r=o.closeIndex)}}function ni(n,e,r){if(e&&typeof n=="string"){const s=n.trim();return s==="true"?!0:s==="false"?!1:Go(n,r)}else return wo(n)?n:""}const Dn=Dt.getMetaDataSymbol();function oa(n,e){return gs(n,e)}function gs(n,e,r){let s;const a={};for(let o=0;o<n.length;o++){const f=n[o],c=aa(f);let l="";if(r===void 0?l=c:l=r+"."+c,c===e.textNodeName)s===void 0?s=f[c]:s+=""+f[c];else{if(c===void 0)continue;if(f[c]){let g=gs(f[c],e,l);const _=ca(g,e);f[Dn]!==void 0&&(g[Dn]=f[Dn]),f[":@"]?ua(g,f[":@"],l,e):Object.keys(g).length===1&&g[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?g=g[e.textNodeName]:Object.keys(g).length===0&&(e.alwaysCreateTextNode?g[e.textNodeName]="":g=""),a[c]!==void 0&&a.hasOwnProperty(c)?(Array.isArray(a[c])||(a[c]=[a[c]]),a[c].push(g)):e.isArray(c,l,_)?a[c]=[g]:a[c]=g}}}return typeof s=="string"?s.length>0&&(a[e.textNodeName]=s):s!==void 0&&(a[e.textNodeName]=s),a}function aa(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const s=e[r];if(s!==":@")return s}}function ua(n,e,r,s){if(e){const a=Object.keys(e),o=a.length;for(let f=0;f<o;f++){const c=a[f];s.isArray(c,r+"."+c,!0,!0)?n[c]=[e[c]]:n[c]=e[c]}}}function ca(n,e){const{textNodeName:r}=e,s=Object.keys(n).length;return!!(s===0||s===1&&(n[r]||typeof n[r]=="boolean"||n[r]===0))}class la{constructor(e){this.externalEntities={},this.options=Lo(e)}parse(e,r){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const o=Eo(e,r);if(o!==!0)throw Error(`${o.err.msg}:${o.err.line}:${o.err.col}`)}const s=new Zo(this.options);s.addExternalEntities(this.externalEntities);const a=s.parseXml(e);return this.options.preserveOrder||a===void 0?a:oa(a,this.options)}addEntity(e,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=r}static getMetaDataSymbol(){return Dt.getMetaDataSymbol()}}function ms(n){return n.arrayBuffer?n.arrayBuffer():new Promise((e,r)=>{const s=new FileReader;s.addEventListener("loadend",()=>{e(s.result)}),s.addEventListener("error",r),s.readAsArrayBuffer(n)})}async function fa(n){const e=await ms(n);return new Uint8Array(e)}function ys(n){return typeof Blob<"u"&&n instanceof Blob}function Ir(n){return typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}const da=typeof process<"u"&&process.versions&&typeof process.versions.node<"u"&&typeof process.versions.electron>"u";function ha(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength}class Xi{constructor(e){this.typedArray=e instanceof ArrayBuffer||Ir(e)?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}async getLength(){return this.typedArray.byteLength}async read(e,r){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+e,r)}}class Ji{constructor(e){this.blob=e}async getLength(){return this.blob.size}async read(e,r){const s=this.blob.slice(e,e+r),a=await ms(s);return new Uint8Array(a)}async sliceAsBlob(e,r,s=""){return this.blob.slice(e,e+r,s)}}function pa(n,e){var r=Uint8Array;if(n[0]==3&&n[1]==0)return e||new r(0);var s=ma,a=vs,o=ga,f=bs,c=e==null;c&&(e=new r(n.length>>>2<<3));for(var l=0,g=0,_=0,w=0,C=0,y=0,S=0,b=0,E=0,k,A;l==0;){if(l=s(n,E,1),g=s(n,E+1,2),E+=3,g==0){(E&7)!=0&&(E+=8-(E&7));var L=(E>>>3)+4,M=n[L-4]|n[L-3]<<8;c&&(e=qn(e,b+M)),e.set(new r(n.buffer,n.byteOffset+L,M),b),E=L+M<<3,b+=M;continue}if(c&&(e=qn(e,b+(1<<17))),g==1&&(k=Ne.flmap,A=Ne.fdmap,y=511,S=31),g==2){_=a(n,E,5)+257,w=a(n,E+5,5)+1,C=a(n,E+10,4)+4,E+=14;for(var j=0;j<38;j+=2)Ne.itree[j]=0,Ne.itree[j+1]=0;for(var te=1,j=0;j<C;j++){var X=a(n,E+j*3,3);Ne.itree[(Ne.ordr[j]<<1)+1]=X,X>te&&(te=X)}E+=3*C,kr(Ne.itree,te),Er(Ne.itree,te,Ne.imap),k=Ne.lmap,A=Ne.dmap,E=o(Ne.imap,(1<<te)-1,_+w,n,E,Ne.ttree);var ue=Qi(Ne.ttree,0,_,Ne.ltree);y=(1<<ue)-1;var ee=Qi(Ne.ttree,_,w,Ne.dtree);S=(1<<ee)-1,kr(Ne.ltree,ue),Er(Ne.ltree,ue,k),kr(Ne.dtree,ee),Er(Ne.dtree,ee,A)}for(;;){var he=k[f(n,E)&y];E+=he&15;var Ce=he>>>4;if(!(Ce>>>8))e[b++]=Ce;else{if(Ce==256)break;var P=b+Ce-254;if(Ce>264){var Q=Ne.ldef[Ce-257];P=b+(Q>>>3)+a(n,E,Q&7),E+=Q&7}var m=A[f(n,E)&S];E+=m&15;var ie=m>>>4,Te=Ne.ddef[ie],ae=(Te>>>4)+s(n,E,Te&15);for(E+=Te&15,c&&(e=qn(e,b+(1<<17)));b<P;)e[b]=e[b++-ae],e[b]=e[b++-ae],e[b]=e[b++-ae],e[b]=e[b++-ae];b=P}}}return e.length==b?e:e.slice(0,b)}function qn(n,e){var r=n.length;if(e<=r)return n;var s=new Uint8Array(Math.max(r<<1,e));return s.set(n,0),s}function ga(n,e,r,s,a,o){for(var f=vs,c=bs,l=0;l<r;){var g=n[c(s,a)&e];a+=g&15;var _=g>>>4;if(_<=15)o[l]=_,l++;else{var w=0,C=0;_==16?(C=3+f(s,a,2),a+=2,w=o[l-1]):_==17?(C=3+f(s,a,3),a+=3):_==18&&(C=11+f(s,a,7),a+=7);for(var y=l+C;l<y;)o[l]=w,l++}}return a}function Qi(n,e,r,s){for(var a=0,o=0,f=s.length>>>1;o<r;){var c=n[o+e];s[o<<1]=0,s[(o<<1)+1]=c,c>a&&(a=c),o++}for(;o<f;)s[o<<1]=0,s[(o<<1)+1]=0,o++;return a}function kr(n,e){for(var r=n.length,s,a,o,f,c,l=Ne.bl_count,f=0;f<=e;f++)l[f]=0;for(f=1;f<r;f+=2)l[n[f]]++;var g=Ne.next_code;for(s=0,l[0]=0,a=1;a<=e;a++)s=s+l[a-1]<<1,g[a]=s;for(o=0;o<r;o+=2)c=n[o+1],c!=0&&(n[o]=g[c],g[c]++)}function Er(n,e,r){for(var s=n.length,a=Ne.rev15,o=0;o<s;o+=2)if(n[o+1]!=0)for(var f=o>>1,c=n[o+1],l=f<<4|c,g=e-c,_=n[o]<<g,w=_+(1<<g);_!=w;){var C=a[_]>>>15-e;r[C]=l,_++}}function es(n,e){for(var r=Ne.rev15,s=15-e,a=0;a<n.length;a+=2){var o=n[a]<<e-n[a+1];n[a]=r[o]>>>s}}function vs(n,e,r){return(n[e>>>3]|n[(e>>>3)+1]<<8)>>>(e&7)&(1<<r)-1}function ma(n,e,r){return(n[e>>>3]|n[(e>>>3)+1]<<8|n[(e>>>3)+2]<<16)>>>(e&7)&(1<<r)-1}function bs(n,e){return(n[e>>>3]|n[(e>>>3)+1]<<8|n[(e>>>3)+2]<<16)>>>(e&7)}const Ne=function(){var n=Uint16Array,e=Uint32Array;return{next_code:new n(16),bl_count:new n(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new n(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new n(512),fltree:[],fdmap:new n(32),fdtree:[],lmap:new n(32768),ltree:[],ttree:[],dmap:new n(32768),dtree:[],imap:new n(512),itree:[],rev15:new n(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new n(65536),prev:new n(32768)}}();(function(){for(var n=32768,e=0;e<n;e++){var r=e;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,Ne.rev15[e]=(r>>>16|r<<16)>>>17}function s(a,o,f){for(;o--!=0;)a.push(0,f)}for(var e=0;e<32;e++)Ne.ldef[e]=Ne.of0[e]<<3|Ne.exb[e],Ne.ddef[e]=Ne.df0[e]<<4|Ne.dxb[e];s(Ne.fltree,144,8),s(Ne.fltree,112,9),s(Ne.fltree,24,7),s(Ne.fltree,8,8),kr(Ne.fltree,9),Er(Ne.fltree,9,Ne.flmap),es(Ne.fltree,9),s(Ne.fdtree,32,5),kr(Ne.fdtree,5),Er(Ne.fdtree,5,Ne.fdmap),es(Ne.fdtree,5),s(Ne.itree,19,0),s(Ne.ltree,286,0),s(Ne.dtree,30,0),s(Ne.ttree,320,0)})();(function(){for(var n=new Uint32Array(256),e=0;e<256;e++){for(var r=e,s=0;s<8;s++)r&1?r=3988292384^r>>>1:r=r>>>1;n[e]=r}return n})();function ya(n,e){return pa(n,e)}const ts={numWorkers:1,workerURL:"",useWorkers:!1};let va=0;const sn=[];function Wn(n){return new Promise((e,r)=>{const s=new Worker(n);s.onmessage=a=>{a.data==="start"?(s.onerror=void 0,s.onmessage=void 0,e(s)):r(new Error(`unexpected message: ${a.data}`))},s.onerror=r})}function ba(n,e){return n.require?n.require(e):{}}(function(){if(da){const{Worker:n}=ba(module,"worker_threads");return{async createWorker(e){return new n(e)},addEventListener(e,r){e.on("message",s=>{r({target:e,data:s})})},async terminate(e){await e.terminate()}}}else return{async createWorker(n){try{return await Wn(n)}catch{console.warn("could not load worker:",n)}let e;try{const r=await fetch(n,{mode:"cors"});if(!r.ok)throw new Error(`could not load: ${n}`);e=await r.text(),n=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));const s=await Wn(n);return ts.workerURL=n,s}catch{console.warn("could not load worker via fetch:",n)}if(e!==void 0)try{n=`data:application/javascript;base64,${btoa(e)}`;const r=await Wn(n);return ts.workerURL=n,r}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(n,e){n.addEventListener("message",e)},async terminate(n){n.terminate()}}})();function _a(n,e,r,s){const a=new Uint8Array(e);ya(n,a),s(r?new Blob([a],{type:r}):a.buffer)}async function wa(){if(sn.length!==0)for(;sn.length;){const{src:n,uncompressedSize:e,type:r,resolve:s}=sn.shift();let a=n;ys(n)&&(a=await fa(n)),_a(a,e,r,s)}}function _s(n,e,r){return new Promise((s,a)=>{sn.push({src:n,uncompressedSize:e,type:r,resolve:s,reject:a,id:va++}),wa()})}function ka(n,e){const r=n&31,s=(n>>5&15)-1,a=(n>>9&127)+1980,o=0,f=(e&31)*2,c=e>>5&63,l=e>>11&31;return new Date(a,s,r,l,c,f,o)}class Ea{constructor(e,r){this._reader=e,this._rawEntry=r,this.name=r.name,this.nameBytes=r.nameBytes,this.size=r.uncompressedSize,this.compressedSize=r.compressedSize,this.comment=r.comment,this.commentBytes=r.commentBytes,this.compressionMethod=r.compressionMethod,this.lastModDate=ka(r.lastModFileDate,r.lastModFileTime),this.isDirectory=r.uncompressedSize===0&&r.name.endsWith("/"),this.encrypted=!!(r.generalPurposeBitFlag&1),this.externalFileAttributes=r.externalFileAttributes,this.versionMadeBy=r.versionMadeBy}async blob(e="application/octet-stream"){return await Ba(this._reader,this._rawEntry,e)}async arrayBuffer(){return await La(this._reader,this._rawEntry)}async text(){const e=await this.arrayBuffer();return xr(new Uint8Array(e))}async json(){const e=await this.text();return JSON.parse(e)}}const Zn=22,xa=65535,Ia=101010256,Sa=101075792;async function ur(n,e,r){return await n.read(e,r)}async function ii(n,e,r,s){return n.sliceAsBlob?await n.sliceAsBlob(e,r,s):await n.read(e,r)}const Ca={unsigned(){return 0}};function it(n,e){return n[e]+n[e+1]*256}function ft(n,e){return n[e]+n[e+1]*256+n[e+2]*65536+n[e+3]*16777216}function Vt(n,e){return ft(n,e)+ft(n,e+4)*4294967296}const Oa=new TextDecoder;function xr(n,e){return Ir(n.buffer)&&(n=new Uint8Array(n)),Oa.decode(n)}async function Aa(n,e){const r=Math.min(Zn+xa,e),s=e-r,a=await ur(n,s,r);for(let o=r-Zn;o>=0;--o){if(ft(a,o)!==Ia)continue;const f=new Uint8Array(a.buffer,a.byteOffset+o,a.byteLength-o),c=it(f,4);if(c!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${c}`);const l=it(f,10),g=ft(f,12),_=ft(f,16),w=it(f,20),C=f.length-Zn;if(w!==C)throw new Error(`invalid comment length. expected: ${C}, actual: ${w}`);const y=new Uint8Array(f.buffer,f.byteOffset+22,w),S=xr(y);return l===65535||_===4294967295?await Na(n,s+o,S,y):await ws(n,_,g,l,S,y)}throw new Error("could not find end of central directory. maybe not zip file")}const Ta=117853008;async function Na(n,e,r,s){const a=e-20,o=await ur(n,a,20);if(ft(o,0)!==Ta)throw new Error("invalid zip64 end of central directory locator signature");const f=Vt(o,8),c=await ur(n,f,56);if(ft(c,0)!==Sa)throw new Error("invalid zip64 end of central directory record signature");const l=Vt(c,32),g=Vt(c,40),_=Vt(c,48);return ws(n,_,g,l,r,s)}const Pa=33639248;async function ws(n,e,r,s,a,o){let f=0;const c=await ur(n,e,r),l=[];for(let _=0;_<s;++_){const w=c.subarray(f,f+46),C=ft(w,0);if(C!==Pa)throw new Error(`invalid central directory file header signature: 0x${C.toString(16)}`);const y={versionMadeBy:it(w,4),versionNeededToExtract:it(w,6),generalPurposeBitFlag:it(w,8),compressionMethod:it(w,10),lastModFileTime:it(w,12),lastModFileDate:it(w,14),crc32:ft(w,16),compressedSize:ft(w,20),uncompressedSize:ft(w,24),fileNameLength:it(w,28),extraFieldLength:it(w,30),fileCommentLength:it(w,32),internalFileAttributes:it(w,36),externalFileAttributes:ft(w,38),relativeOffsetOfLocalHeader:ft(w,42)};if(y.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");f+=46;const S=c.subarray(f,f+y.fileNameLength+y.extraFieldLength+y.fileCommentLength);y.nameBytes=S.slice(0,y.fileNameLength),y.name=xr(y.nameBytes);const b=y.fileNameLength+y.extraFieldLength,E=S.slice(y.fileNameLength,b);y.extraFields=[];let k=0;for(;k<E.length-3;){const L=it(E,k+0),M=it(E,k+2),j=k+4,te=j+M;if(te>E.length)throw new Error("extra field length exceeds extra field buffer size");y.extraFields.push({id:L,data:E.slice(j,te)}),k=te}if(y.commentBytes=S.slice(b,b+y.fileCommentLength),y.comment=xr(y.commentBytes),f+=S.length,y.uncompressedSize===4294967295||y.compressedSize===4294967295||y.relativeOffsetOfLocalHeader===4294967295){const L=y.extraFields.find(te=>te.id===1);if(!L)throw new Error("expected zip64 extended information extra field");const M=L.data;let j=0;if(y.uncompressedSize===4294967295){if(j+8>M.length)throw new Error("zip64 extended information extra field does not include uncompressed size");y.uncompressedSize=Vt(M,j),j+=8}if(y.compressedSize===4294967295){if(j+8>M.length)throw new Error("zip64 extended information extra field does not include compressed size");y.compressedSize=Vt(M,j),j+=8}if(y.relativeOffsetOfLocalHeader===4294967295){if(j+8>M.length)throw new Error("zip64 extended information extra field does not include relative header offset");y.relativeOffsetOfLocalHeader=Vt(M,j),j+=8}}const A=y.extraFields.find(L=>L.id===28789&&L.data.length>=6&&L.data[0]===1&&ft(L.data,1),Ca.unsigned(y.nameBytes));if(A&&(y.fileName=xr(A.data.slice(5))),y.compressionMethod===0){let L=y.uncompressedSize;if((y.generalPurposeBitFlag&1)!==0&&(L+=12),y.compressedSize!==L)throw new Error(`compressed size mismatch for stored file: ${y.compressedSize} != ${L}`)}l.push(y)}return{zip:{comment:a,commentBytes:o},entries:l.map(_=>new Ea(n,_))}}async function ks(n,e){if(e.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");const r=await ur(n,e.relativeOffsetOfLocalHeader,30),s=await n.getLength(),a=ft(r,0);if(a!==67324752)throw new Error(`invalid local file header signature: 0x${a.toString(16)}`);const o=it(r,26),f=it(r,28),c=e.relativeOffsetOfLocalHeader+r.length+o+f;let l;if(e.compressionMethod===0)l=!1;else if(e.compressionMethod===8)l=!0;else throw new Error(`unsupported compression method: ${e.compressionMethod}`);const g=c,_=g+e.compressedSize;if(e.compressedSize!==0&&_>s)throw new Error(`file data overflows file bounds: ${g} +  ${e.compressedSize}  > ${s}`);return{decompress:l,fileDataStart:g}}async function La(n,e){const{decompress:r,fileDataStart:s}=await ks(n,e);if(!r){const f=await ur(n,s,e.compressedSize);return ha(f)?f.buffer:f.slice().buffer}const a=await ii(n,s,e.compressedSize);return await _s(a,e.uncompressedSize)}async function Ba(n,e,r){const{decompress:s,fileDataStart:a}=await ks(n,e);if(!s){const c=await ii(n,a,e.compressedSize,r);return ys(c)?c:new Blob([Ir(c.buffer)?new Uint8Array(c):c],{type:r})}const o=await ii(n,a,e.compressedSize);return await _s(o,e.uncompressedSize,r)}async function Ra(n){let e;if(typeof Blob<"u"&&n instanceof Blob)e=new Ji(n);else if(n instanceof ArrayBuffer||n&&n.buffer&&n.buffer instanceof ArrayBuffer)e=new Xi(n);else if(Ir(n)||Ir(n.buffer))e=new Xi(n);else if(typeof n=="string"){const s=await fetch(n);if(!s.ok)throw new Error(`failed http request ${n}, status: ${s.status}: ${s.statusText}`);const a=await s.blob();e=new Ji(a)}else if(typeof n.getLength=="function"&&typeof n.read=="function")e=n;else throw new Error("unsupported source type");const r=await e.getLength();if(r>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await Aa(e,r)}async function Es(n){const{zip:e,entries:r}=await Ra(n);return{zip:e,entries:Object.fromEntries(r.map(s=>[s.name,s]))}}function Ou(n){const e=/^(?:(http(?:s?)?:\/\/)?github.com\/)?([^\/]+)\/([^\/]+)\/?.*$/,r=n.match(e);if(!r)return null;const[,s="https://",a,o]=r;return!a||!o?null:`https://github.com/${a}/${o}`}function Au(n){const e=/^(?:https?:\/\/)?(?:www\.)?github\.com\/([^/]+)\/([^/]+)(?:\/)?$/,r=n.match(e);if(!r)throw new Error("Invalid GitHub URL format: "+n);const[,s,a]=r;return{githubUrl:n,githubRepo:`${s}/${a}`,githubOwner:s,githubName:a}}async function Tu(n,e,r="HEAD"){const s=`https://api.github.com/repos/${n}/${e}/zipball/${r}`,a=`https://api.github.com/repos/${n}/${e}/zipball/${r}`;let o;try{o=await $fetch(`https://www.newrecruit.eu/api/proxy?url=${encodeURIComponent(s)}`)}catch{o=await $fetch(`https://www.newrecruit.eu/api/proxy?url=${encodeURIComponent(a)}`)}const f=await Es(o),c=Object.entries(f.entries),l=c[0][0];return c.map(([_,w])=>[li(_,l),w])}const Sr={catalogueLinks:{type:"catalogueLink"},publications:{type:"publication"},costs:{type:"cost"},costTypes:{allowedChildrens:["modifiers"],type:"costType"},costLimits:{type:"costLimit"},profileTypes:{allowedChildrens:["characteristicTypes","attributeTypes"],type:"profileType"},characteristicTypes:{type:"characteristicType"},characteristics:{type:"characteristic"},attributeTypes:{type:"attributeType"},attributes:{type:"attribute"},categoryEntries:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"],type:"categoryEntry"},categoryLinks:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups"],type:"categoryLink"},categories:{type:"category"},forceEntries:{allowedChildrens:["forceEntries","categoryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","costs"],type:"forceEntry"},forces:{type:"force"},selections:{type:"selection"},entryLinks:{allowedChildrens:"type",type:"entryLink"},selectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntryGroup"},sharedSelectionEntryGroups:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntryGroup"},selectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntry"},sharedSelectionEntries:{allowedChildrens:["selectionEntries","selectionEntryGroups","entryLinks","profiles","rules","infoGroups","infoLinks","associations","constraints","modifiers","modifierGroups","categoryLinks","costs"],type:"selectionEntry"},associations:{type:"association"},sharedRules:{allowedChildrens:["modifiers","modifierGroups"],type:"rule"},rules:{allowedChildrens:["modifiers","modifierGroups"],type:"rule"},profiles:{allowedChildrens:["modifiers","modifierGroups","characteristics","attributes"],type:"profile"},sharedProfiles:{allowedChildrens:["modifiers","modifierGroups","characteristics","attributes"],type:"profile"},infoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"],type:"infoGroup"},sharedInfoGroups:{allowedChildrens:["profiles","rules","infoGroups","infoLinks","modifiers","modifierGroups"],type:"infoGroup"},infoLinks:{allowedChildrens:"type",type:"infoLink"},modifiers:{allowedChildrens:["conditions","conditionGroups","localConditionGroups","repeats"],type:"modifier"},modifierGroups:{allowedChildrens:["modifiers","modifierGroups","conditions","conditionGroups","localConditionGroups","repeats"],type:"modifierGroup"},repeats:{allowedChildrens:[],type:"repeat"},conditions:{allowedChildrens:[],type:"condition"},constraints:{allowedChildrens:[],type:"constraint"},conditionGroups:{allowedChildrens:["conditions","conditionGroups","localConditionGroups"],type:"conditionGroup"},localConditionGroups:{allowedChildrens:["conditions","conditionGroups"],type:"localConditionGroup"},catalogue:{allowedChildrens:["catalogueLinks","publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]},gameSystem:{allowedChildrens:["publications","costTypes","profileTypes","categoryEntries","forceEntries","sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","selectionEntries","entryLinks","infoLinks","infoGroups","rules"]}},za=["modifiers","modifierGroups","constraints","entryLinks","categoryLinks","selectionEntries","selectionEntryGroups","infoLinks","infoGroups","rules","profiles"],vt=new Set([...Object.keys(Sr).filter(n=>n.endsWith("s"))]);function rs(n){if(n.isCatalogue&&n.isCatalogue())return n;if(n.gameSystem)return n.gameSystem;if(n.catalogue)return n.catalogue;throw Error("getDataObject data argument is not a valid system or catalogue")}class Ve{id;type;subType;shared;import;collective;comment;publicationId;typeName;typeId;categoryEntryId;name;hidden;value;page;defaultAmount;profiles;rules;infoLinks;infoGroups;publications;costs;selectionEntries;selectionEntryGroups;entryLinks;profileTypes;categoryEntries;categoryLinks;forceEntries;sharedSelectionEntryGroups;sharedSelectionEntries;sharedProfiles;sharedRules;sharedInfoGroups;target;modifiers;modifierGroups;constraints;conditions;conditionGroups;localConditionGroups;catalogue;extra_constraints;childs;loaded;collective_recursive;limited_to_one;associations;associationConstraints;flatten;collapsible;sortIndex;alias;noindex;constructor(e){return Object.setPrototypeOf(e,Object.getPrototypeOf(this))}get url(){return"%{main_catalogue|catalogue}/%{id}/%{getName}"}process(){this.loaded||(this.collective_recursive=this.isCollectiveRecursive(),this.limited_to_one=!this.canAmountBeAbove1(),this.loaded=!0)}toJson(){return Ma(this)}getCatalogue(){return this.catalogue}getGameSystem(){return this.getCatalogue().getGameSystem()}get[Symbol.toStringTag](){return globalThis.isEditor?"Object":"ObjectNoObserve"}isGroup(){return!1}isForce(){return!1}isCatalogue(){return!1}isLink(){return!1}isCategory(){return!1}isRoster(){return!1}isQuantifiable(){return!1}isEntry(){return!1}isIdUnique(){return!1}isRule(){return!1}isProfile(){return!1}isInfoGroup(){return!1}isUnit(){for(const e of this.categoryLinks||[])if(e.primary)return!0;return!1}getId(){return this.id}getType(){return this.subType??this.type}getTypeName(){return this.typeName}getCategoryEntryId(){return this.categoryEntryId}getHidden(){return this.hidden}getPage(){return this.page}getName(){return this.name??""}getDefaultAmount(){return this.defaultAmount}isCollective(){return this.collective}isCollapsible(){return this.collapsible}isCollectiveRecursive(){const e=[...this.selectionsIterator()];for(;e.length;){const r=e.pop();if(!r.isCollective()&&!r.isGroup())return!1;e.push(...r.selectionsIterator())}return!0}isEmptyNode(){for(const e of za)if(this[e]!==void 0)return!1;return!0}*forcesIterator(){}*associationsIterator(){this.associations&&(yield*this.associations)}*profilesIterator(){for(const e of Ar(this))e.profiles&&(yield*e.profiles),e.infoLinks&&(yield*e.infoLinks?.filter(r=>r.type==="profile").map(r=>r.target))}*rulesIterator(){for(const e of Ar(this))e.rules&&(yield*e.rules),e.infoLinks&&(yield*e.infoLinks?.filter(r=>r.type==="rule").map(r=>r.target))}*constraintsIterator(){this.constraints&&(yield*this.constraints)}*extraConstraintsIterator(){this.extra_constraints&&(yield*this.extra_constraints)}*modifierGroupsIterator(){this.modifierGroups&&(yield*this.modifierGroups)}*modifiersIterator(){this.modifiers&&(yield*this.modifiers)}*modifierGroupsIteratorRecursive(){yield this,this.isLink()&&(yield this.target);for(const e of this.modifierGroupsIterator())yield e,yield*cn(e.modifierGroups)}*selectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*localSelectionsIterator(){this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*nodesIterator(){this.isLink()&&(yield*this.target.nodesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.isLink()&&(yield*this.target.entriesIterator()),this.selectionEntries&&(yield*this.selectionEntries),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks),this.childs&&(yield*this.childs)}*iterateSelectionEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateSelectionEntriesWithRoot(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups)}*iterateRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*iterateAllRootEntries(){this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.forceEntries&&(yield*this.forceEntries)}*categoryLinksIterator(){this.categoryLinks&&(yield*this.categoryLinks)}*infoLinksIterator(){this.infoLinks&&(yield*this.infoLinks)}*infoGroupsIterator(){this.infoGroups&&(yield*this.infoGroups)}*infoRulesIterator(){this.rules&&(yield*this.rules)}*infoProfilesIterator(){this.profiles&&(yield*this.profiles)}forEachCond(e,r=0){if(e(this,0)===void 0)for(const s of this.selectionsIterator())s.forEachCond(e,r+1)}forEach(e){e(this);for(const r of this.selectionsIterator())r.forEach(e)}forEachNode(e){e(this);for(const r of this.nodesIterator())r.forEachNode(e)}forEachNodeCb(e){const r=[this],s=new Set;for(;r.length;){const a=r.pop();if(!s.has(a.id)){if(s.add(a.id),e(a),a.childs){r.push(...a.childs);continue}if(a.target){const o=a.target;o.selectionEntries&&r.push(...o.selectionEntries),o.selectionEntryGroups&&r.push(...o.selectionEntryGroups),o.entryLinks&&r.push(...o.entryLinks)}a.selectionEntries&&r.push(...a.selectionEntries),a.selectionEntryGroups&&r.push(...a.selectionEntryGroups),a.entryLinks&&r.push(...a.entryLinks)}}}forEachObject(e,r=vt,s){let a=[this],o=[],f=0;for(;a.length;){for(;a.length;){const c=a.pop();for(const l in c){const g=c[l];if(r.has(l)&&yt(g))if(Array.isArray(g)){if(g.length&&yt(g[0]))for(let _=0;_<g.length;_++){const w=g[_];e(w,c)!==!1&&o.push(w)}}else e(g,c)!==!1&&o.push(g)}}if(a=o,o=[],f++,s&&f>=s)break}}forEachObjectWhitelist(e,r=vt,s){return this.forEachObject(e,r,s)}findOption(e){for(const r of this.selectionsIterator())if(e(r))return r}findOptionRecursive(e){const r=[...this.selectionsIterator()];for(;r.length;){const s=r.pop();if(e(s))return s}}find_recursive(e,r=!1){let s=[this],a=[];for(;s.length;){for(;s.length;){const o=s.pop();for(const f in o){const c=o[f];if(vt.has(f)&&yt(c))if(Array.isArray(c)){if(c.length&&yt(c[0]))for(let l=0;l<c.length;l++){const g=c[l],_=e(g);if(_)return g;_!==!1&&(a.push(g),g.target&&r&&a.push(g.target))}}else{const l=e(c);if(l)return c;l!==!1&&(a.push(c),c.target&&r&&a.push(c.target))}}}s=a,a=[]}}find(e,r=!1){let s=[this],a=[],o=!0;for(;s.length;){for(;s.length;){const f=s.pop();for(const c in f){const l=f[c];if(vt.has(c)&&yt(l))if(Array.isArray(l)){if(l.length&&yt(l[0]))for(let g=0;g<l.length;g++){const _=l[g];if(e(_))return _;a.push(_),_.target&&r&&a.push(_.target)}}else{if(e(l))return l;a.push(l),l.target&&r&&a.push(l.target)}}}if(!o)return;o=!1,s=a,a=[]}}getCosts(){return this.costs||[]}getPrimaryCategory(){for(const e of this.categoryLinks||[])if(e.primary)return e.targetId;return this.getCategoryEntryId()??zt}getPrimaryCategoryLink(){for(const e of this.categoryLinks||[])if(e.primary)return e}getPackedConstraint(e){const r=Object.assign({},e);r.name=this.getName(),r.parent=this;const s=e.shared||this instanceof xs;r.childId=this.isLink()&&s?this.targetId:this.id,r.modifiers=[];for(const a of this.modifiersIterator())(a.field===e.id||a.field==="hidden"&&e.type==="min"&&!this.isCategory())&&r.modifiers.push(a);r.modifierGroups=[];for(const a of this.modifierGroupsIterator())e:for(const o of cn([a]))for(const f of o.modifiers||[])if(f.field===e.id||f.field==="hidden"&&e.type==="min"&&!this.isCategory()){r.modifierGroups.push(a);break e}return r}getBoundConstraint(e){const r=this.getPackedConstraint(e);return r.scope="self",r}getChildBoundConstraints(e){const r=[];for(const s of this.selectionsIterator())if(!(e&&s.isGroup())){for(const a of s.constraintsIterator())(a.type==="min"||a.type==="exactly")&&a.scope==="parent"&&r.push(s.getBoundConstraint(a));s.isGroup()&&r.push(...s.getChildBoundConstraints())}return r}canAmountBeAbove1(){const e=ja(this.constraintsIterator(),[...this.modifierGroupsIterator(),{modifiers:[...this.modifiersIterator()]}]);return!e.length||e.includes(-1)?!0:Math.min(...e)>1}hasOption(e){let r;return this.forEachCond(s=>(s.getName()===e&&(r=!0),r)),!!r}}class Vn extends Ve{isEntry(){return!0}isQuantifiable(){return!0}isIdUnique(){return!0}}class Hn extends Ve{getDefaultSelectionEntryId(){return this.defaultSelectionEntryId}isGroup(){return!0}isIdUnique(){return!0}}class Cr extends Ve{targetId;isLink(){return!0}isGroup(){return this.target?.isGroup()}isCategory(){return this.target?.isCategory()}isQuantifiable(){return this.target?.isQuantifiable()}isEntry(){return this.target?.isEntry()}isIdUnique(){return!1}isProfile(){return this.target?.isProfile()||!1}isRule(){return this.target?.isRule()||!1}isInfoGroup(){return this.target?.isInfoGroup()||!1}isUnit(){if(this.target.isUnit())return!0;for(const e of this.categoryLinks||[])if(e.primary)return!0;return!1}isCollapsible(){return this.collapsible||this.target.collapsible}getId(){return this.targetId}getType(){return this.target?.getType()}getPage(){return this.page||this.target?.page}getHidden(){return this.target.hidden||this.hidden}getDefaultSelectionEntryId(){return this.defaultSelectionEntryId||this.target?.getDefaultSelectionEntryId()}getCategoryEntryId(){return this.categoryEntryId??this.target?.categoryEntryId}get associationConstraints(){return this.target.associationConstraints}getAssociations(){return this.associations||this.target.associations}isCollective(){return super.isCollective()||this.target?.isCollective()}*extraConstraintsIterator(){yield*this.target.extraConstraintsIterator(),yield*super.extraConstraintsIterator()}*associationsIterator(){yield*this.target.associationsIterator(),yield*super.associationsIterator()}*rulesIterator(){yield*this.target.rulesIterator(),yield*super.rulesIterator()}*profilesIterator(){yield*this.target.profilesIterator(),yield*super.profilesIterator()}*constraintsIterator(){this.target&&(yield*this.target.constraintsIterator()),yield*super.constraintsIterator()}*modifierGroupsIterator(){yield*this.target.modifierGroupsIterator(),yield*super.modifierGroupsIterator()}*modifiersIterator(){yield*this.target.modifiersIterator(),yield*super.modifiersIterator()}*selectionsIterator(){yield*this.target.selectionsIterator(),yield*super.selectionsIterator()}*categoryLinksIterator(){yield*this.target.categoryLinksIterator(),yield*super.categoryLinksIterator()}*infoLinksIterator(){yield*this.target.infoLinksIterator(),yield*super.infoLinksIterator()}*infoGroupsIterator(){yield*this.target.infoGroupsIterator(),yield*super.infoGroupsIterator()}*infoRulesIterator(){yield*this.target.infoRulesIterator(),yield*super.infoRulesIterator()}*infoProfilesIterator(){yield*this.target.infoProfilesIterator(),yield*super.infoProfilesIterator()}getDefaultAmount(){return this.defaultAmount===""||this.defaultAmount===void 0?this.target.getDefaultAmount():this.defaultAmount}getName(){return this.target?.name??this.name??""}getPrimaryCategory(){for(const e of this.categoryLinks||[])if(e.primary)return e.targetId;for(const e of this.target?.categoryLinks||[])if(e.primary)return e.targetId;return this.getCategoryEntryId()??zt}getPrimaryCategoryLink(){for(const e of this.categoryLinks||[])if(e.primary)return e;for(const e of this.target?.categoryLinks||[])if(e.primary)return e}getCosts(){const e={};if(this.target?.costs)for(const r of this.target.costs)e[r.typeId]=r;if(this.costs)for(const r of this.costs)e[r.typeId]=r;return Object.values(e)}}Cr.prototype.keyInfoCache={};class Fa extends Cr{getTypeName(){return this.target?.typeName}getTypeId(){return this.target?.typeId}}class xs extends Cr{primary;main_catalogue;get units(){return this.target.units}*selectionsIterator(){yield*this.target.units}isEmpty(){return this.target.isEmpty()}}const zt="(No Category)",Yn="(Illegal Units)";class or extends Ve{units;main_catalogue;description;isCategory(){return!0}isEmpty(){return!this.units.length}isIdUnique(){return!this.isEmptyNode()}getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description||""}*selectionsIterator(){yield*this.units}}class tn extends Ve{childForcesLabel;categories;forces;main_catalogue;isForce(){return!0}isEntry(){return!0}isIdUnique(){return!0}*infoLinksIterator(){if(this.isForce()){const e=this.main_catalogue;for(const r of e.imports)yield*r.infoLinksIterator();yield*e.infoLinksIterator()}yield*super.infoLinksIterator()}*infoRulesIterator(){if(this.isForce()){const e=this.main_catalogue;for(const r of e.imports)yield*r.infoRulesIterator();yield*e.infoRulesIterator()}yield*super.infoRulesIterator()}*selectionsIterator(){yield*this.categories,this.forces&&(yield*this.forces)}*rulesIterator(){for(const e of Ar(this))e.rules&&(yield*e.rules),e.infoLinks&&(yield*e.infoLinks?.filter(r=>r.type==="rule").map(r=>r.target));this.main_catalogue&&(yield*this.main_catalogue.rulesIterator())}generateForces(e){const r=[];for(const s of this.forceEntries||[]){const a=Rt(s);a.main_catalogue=this.main_catalogue;const o=[];for(const f of s.categoryLinks||[])f.targetId in e&&o.push(e[f.targetId]);a.categories=o,this.main_catalogue.index[a.id]=a,r.push(a)}return this.forces=r,r}isEmpty(){for(const e of this.categories)if(!e.isEmpty())return!1;return!0}*forcesIterator(){this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const e of this.forces)yield e,yield*e.forcesIteratorRecursive()}}const Xn=1/0;function ja(n,e){const r=[];function s(a){r.push(a)}for(const a of n){const o=r.length;if(a.field!=="selections"||a.type!=="max")continue;if(a.value>1){s(a.value);continue}let f=a.value;for(const c of cn(e))for(const l of c.modifiers||[])if(l.field===a.id){if(l.type==="increment"){if(c.repeats?.length||l.repeats?.length){s(Xn);continue}if(f+=l.value,f>1){s(f);continue}}if(l.type==="decrement"&&l.value<0){if(c.repeats?.length||l.repeats?.length){s(Xn);continue}if(f-=l.value,f>1){s(f);continue}}if(l.type==="set"&&l.value>1){if(l.value===-1){s(Xn);continue}s(l.value)}}o===r.length&&s(f)}return r}class Ua extends Ve{}class Jn extends Ve{isProfile(){return!0}getTypeName(){return this.typeName}getTypeId(){return this.typeId}isIdUnique(){return!0}}class ns extends Ve{originalValue;getLabel(){return this.catalogue?this.catalogue.findOptionById(this.typeId)?.getName()??this.typeId:this.typeId}getTypeName(){return this.getLabel()}getName(){return`${this.getLabel()} = ${this.$text}`}}class Qn extends Ve{isInfoGroup(){return!0}isIdUnique(){return!0}}const is=new Set(["any","model","unit","upgrade","mount","crew","entry","roster","group","force","category"]);class Or extends Ve{}class si extends Or{}class Is extends Ve{}class Ss extends Ve{}class $a extends Ve{}class on extends Ve{getDescription(){return Array.isArray(this.description)?this.description.join(`
`):this.description||""}isRule(){return!0}isIdUnique(){return!0}}function*Ar(n){yield n;for(const e of n.infoGroups||[])yield*Ar(e);for(const e of n.infoLinks||[])e.type==="infoGroup"&&(yield*Ar(e.target))}function*cn(n){if(n)for(const e of n)yield e,yield*cn(e.modifierGroups)}const Ga=new Set([...vt,"defaultAmount","id","import","importRootEntries","name","hidden","field","scope","value","percentValue","shared","includeChildSelections","includeChildForces","childId","type","targetId","primary","typeId","collective","$text","page","typeName","defaultSelectionEntryId","revision","battleScribeVersion","authorName","authorContact","authorUrl","library","gameSystemId","gameSystemRevision","xmlns","readme","description","comment","publicationDate","publisher","publisherId","publisherUrl","shortName","repeats","roundUp","defaultCostLimit","publicationId","affects","label","labelMembers","maxAssociationsPerMember","ids","min","max","of","info","flatten","collapsible","sortIndex","subType","arg","position","join","automatic","negative","message","childForcesLabel","affects","alias","noindex","costTypeId","profileTypeId","characteristicTypeId"]);function Ma(n,e){return JSON.stringify(n,function(s,a){if(!(Array.isArray(a)&&a.length===0)&&(Ga.has(s)||isFinite(Number(s))||e?.has(s)))return a})}function wr(n,e,r=vt){for(const s in n)if(r.has(s)){const a=n[s];if(Array.isArray(a)&&a.length&&yt(a[0]))for(let o=0;o<a.length;o++){const f=a[o];e(f,n),wr(f,e,r)}}}function Ka(n,e){const r=[];return n.self&&(n.entries||n.forces)&&r.push("self"),n.entries&&r.push("entries"),n.forces&&r.push("forces"),n.recursive&&r.push("recursive"),n.filterBy&&n.filterBy!=="any"&&r.push(e(n.filterBy)),n.affectsWhat&&n.affectsWhat!=="entries"&&r.push(e(n.affectsWhat)),r.join(".")}function Da(n){const e=["profiles","constraints","costs","rules","categories"],r=[],s={self:!1,entries:!1,forces:!1,recursive:!1},a=(n||"").split(".");let o="entries";for(let f=0;f<a.length;f++){const c=a[f];if(e.includes(c)){o=a.slice(f).join(".");break}if(c in s){s[c]=!0;continue}r.push(c)}return!s.entries&&!s.forces&&(s.self=!0),{...s,filterBy:r.length?r.join("."):"any",affectsWhat:o}}const ar={};for(const n in Sr){const e=Sr[n];e.type&&(ar[n]=e.type)}const qa=new Set(["description","readme","comment"]),Wa=new Set(["alias"]),Za=new Set(["join"]),ss=/&(?:amp|lt|gt|quot|#39|apos);/g,Va={"&amp;":"&","&apos;":"'","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},os=n=>ss.test(n)?n.replace(ss,e=>Va[e]):n,Cs={};for(const n in ar)Cs[ar[n]]=n;for(const[n,e]of Object.entries(Sr))typeof e.allowedChildrens=="string"?e.allowedChildrens:new Set(e.allowedChildrens);function Ha(n){switch(n){case"true":return!0;case"false":return!1;default:if(isNaN(n))return n;const e=parseFloat(n);return isFinite(e)&&n.includes("+")==!1?e:n}}function Ya(n){const e={allowBooleanAttributes:!0,ignoreAttributes:!1,attributeNamePrefix:"",textNodeName:"$text",processEntities:!1,parseTagValue:!1,ignoreDeclaration:!0,alwaysCreateTextNode:!1,trimValues:!1,isArray:(s,a,o,f)=>!f&&(s in Cs||Wa.has(s)),attributeValueProcessor:(s,a)=>Ha(os(a)),tagValueProcessor:(s,a)=>os(a).trim()};return new la(e).parse(n)}async function Xa(n){if(typeof n=="string"){var e=new TextEncoder;n=e.encode(n)}const r=await Es(n);for(const s of Object.values(r.entries))return await s.text();throw"unzipFile failed: No Entries"}const Ja=["gst","gstz","cat","catz","json"];function Os(n){return n.split(".").pop().toLowerCase()}function Nu(n){const e=Os(n);return!!Ja.includes(e)}const as={sharedRules:"sharedRule",sharedProfiles:"sharedProfile",sharedInfoGroups:"sharedInfoGroup",sharedSelectionEntries:"sharedSelectionEntry",sharedSelectionEntryGroups:"sharedSelectionEntryGroup"};function oi(n){for(let e in n)if(n[e]===""&&!Za.has(e))delete n[e];else if(ar[e]&&n[e])if(e in as){const r=n[e][ar[e]],s=n[e][as[e]];n[e]=[...Array.isArray(r)?r:[],...Array.isArray(s)?s:[]],n[e]?.forEach(oi)}else{const r=n[e][ar[e]];Array.isArray(r)?(n[e]=r,n[e]?.forEach(oi)):yt(n[e])&&delete n[e]}else qa.has(e)&&typeof n[e]=="object"&&!Array.isArray(n[e])&&(n[e]=n[e].$text??"");return n}function us(n){const e=Ya(n),r=Object.keys(e)[0],s=e[r];switch(oi(s),r){case"catalogue":e.playable=1,e.id=oo(e.catalogue.id),e.include=[1e3],e.name=s.name,e.short=Di(s.name),e.playable=!s.library,e.version=s.battleScribeVersion,e.nrversion=s.revision;break;case"gameSystem":e.playable=0,e.id=1e3,e.name=s.name,e.short=Di(s.name),e.playable=!s.library,e.version=s.battleScribeVersion,e.nrversion=s.revision;break}return e}async function Pu(n,e){switch(e=Os(e),e){case"xml":case"cat":case"gst":return us(n);case"zip":case"catz":case"gstz":return us(await Xa(n));case"json":return JSON.parse(n);default:throw new Error("Extension not supported "+e)}}function cs(n,e){if(n)return n[e]||n["*"]}class Qa{index={};words(e){const r=`${e}`;return r.trim().match(/(\w+|\s|\W)/g)??[r]}clean(e){return e.match(/[a-z]/)?e.toLowerCase():e}add(e,r){typeof e!="string"||!e.match(/(?=.*[a-zA-Z0-9].*[a-zA-Z0-9])/)||this.addToIndex(this.index,r,this.words(e))}addToIndex(e,r,s,a=0){if(a<s.length){const o=this.clean(s[a]);o!==" "?(e[o]||(e[o]={}),this.addToIndex(e[o],r,s,a+1)):this.addToIndex(e,r,s,a+1)}else e.$||(e.$=[]),e.$.push(r)}match(e){if(typeof e!="string"||!e.match(/(?=.*[a-zA-Z0-9].*[a-zA-Z0-9])/))return[{text:e}];const r=this.words(e),s=r.map(this.clean,this),a=[];let o=[];for(let f=0;f<s.length;f++){let c=this.index,l=0,g;if(nu(s,f)){let _=eu(f,s);_!==-1&&(o.push(r.slice(f,_).join("")),f=_-1);continue}else if(ru(s,f)){let _=tu(f,s);_!==-1&&(o.push(r.slice(f,_).join("")),f=_-1);continue}if(s[f]!==" ")for(let _=f;_<s.length;_++){const w=s[_];if(w!==" ")if(c=c[w],c)c.$&&(l=1+(_-f),g=c.$);else break}l?(o.length&&(a.push({text:o.join("")}),o=[]),a.push({match:g,text:r.slice(f,f+l).join("")}),f+=l-1):o.push(r[f])}return o.length&&a.push({text:o.join("")}),a}}function eu(n,e){let r=-1;for(let s=n+3;s<e.length;s++)e[n]==="`"&&e[n+1]==="`"&&e[n+2]==="`"&&(r=s+3);return r}function tu(n,e){let r=-1;for(let s=n+1;s<e.length;s++)(e[n]==="`"||e[n]==`
`)&&(r=s+1);return r}function ru(n,e){return n[e]==="`"}function nu(n,e){return n[e]==="`"&&n[e+1]==="`"&&n[e+2]==="`"}const As=new Set(["force","roster","self","parent","ancestor","primary-category","force","roster","primary-catalogue","root-entry","unit","model","upgrade","model-or-unit"]);function iu(n,e){if(As.has(e))return!0;const s=n.catalogue.findOptionById(e);if(s&&(s.isForce()&&!n.isForce()||s.isCategory()||s.isCatalogue()))return!0;const a=[n];for(;a.length;){const o=a.pop();if(o.id===e)return!0;o.parent&&a.push(o.parent),o.refs&&a.push(...o.refs)}return!1}function Wt(n){return mo(n,r=>!(r instanceof Is||r instanceof Or||r instanceof Ss||r instanceof $a))}function su(n,e){if(!n||!e)return;const r=n.getCatalogue();if(n.parent){const a=Wt(n);if(a){for(const o of a.constraintsIterator())if(o.id===e)return o}}return r?.findOptionById(e)}function Ht(n,e){if(e===void 0)return"";if(n){if(`${e}`.startsWith("limit::"))return`limit::${Ht(n,li(`${e}`,"limit::"))}`;const r=n.catalogue||n,s=su(n,e);if(s){const o=s.type;if(o&&["min","max","exactly"].includes(o))return ou(n,s);if(s.name)return s.isCategory&&s.isCategory()?`${s.name}`:s.url?`${s.name}`:s.name}const a=r.manager;if(a)return(r.manager.findOptionById(e)||a.getCatalogueInfo({targetId:e}))?.name||e}return e}function ei(n,e,r=!1,s=Ht){const a=e.type||"none",o=e.value===void 0?1:e.percentValue?`${e.value}%`:e.value,f=s(n,e.field),c=["selections","forces"].includes(f)?` ${f}`:` ${s(n,f)}`,l=s(n,e.childId||"")+(r?`(${e.childId||"any"})`:""),g=l&&c?"of ":"",_=s(n,e.scope),w=_===n?.getName()?"":`${_}`,C=e.includeChildSelections?" (recursive)":"",y=w?` in ${w}${C}`:"";switch(a){case"instanceOf":return`${w} is ${l}`;case"notInstanceOf":return`${w} is not ${l}`;case"atLeast":return`${o}+${c} ${g}${l}${y}`;case"greaterThan":return`${Number(o)+1}+${c} ${g}${l}${y}`;case"atMost":return`${o}${o===0?"":"-"}${c} ${g}${l}${y}`;case"lessThan":return`${Number(o)-1}${Number(o)-1===0?"":"-"}${c} ${g}${l}${y}`;case"equalTo":return`${o}${c} ${g}${l}${y}`;case"notEqualTo":return`not ${o}${c} ${g}${l}${y}`;case"none":return`${c} ${g}${l}${y}`;default:return`${a} ${o}${c} ${g}${l}${y}`}}function ou(n,e,r=Ht){if(!yo(n.constraintsIterator(),e))return e.id;const s=e.field==="selections"?"":` ${r(n,e.field)}`,a=e.scope==="parent"?"":`(${r(n,e.scope)})`,o=e.childId?` ${r(n,e.childId)}`:"";return`${e.type}${s}${o}${a}`}function au(n,e,r=Ht){const s=[];e.scope&&s.push(e.scope),e.affects&&s.push(Ka(Da(e.affects),o=>r(n,o)));const a=s.length?` in ${s.join(".")}`:"";return e.type==="replace"?`${e.type} ${r(n,e.field)} ${e.arg} with ${r(n,e.value?.toString())}${a}`:`${e.type} ${r(n,e.field)} ${r(n,e.value?.toString())}${a}`}typeof $toRaw>"u"&&(globalThis.$toRaw=function(n){return n});class uu extends Ve{targetId;importRootEntries;isLink(){return!1}}class ls extends Ve{shortName;publisher;publicationDate;publisherUrl}class Ts extends Ve{library;revision;gameSystemId;gameSystemRevision;authorContact;authorName;authorUrl;battleScribeVersion;costTypes;catalogueLinks;gameSystem;initialized;loaded_wiki;loaded_editor;imports;importsWithEntries;index;infoIndex;unresolvedLinks={};forces;categories;units;roster_constraints;manager;book;short;version;nrversion;lastUpdated;costIndex;fullFilePath;errors;reset(){delete this.initialized,delete this.loaded,delete this.loaded_editor,delete this.loaded_wiki;for(const e of this.imports||[])delete e.initialized,delete e.loaded,delete e.loaded_editor,delete e.loaded_wiki}init(e=!0){this.initialized||(this.initialized=!0,this.generateImports(e),this.resolveAllLinks(e),this.generateCostIndex(),this.indexInfo())}process(){if(this.loaded)return;this.loaded=!0,this.init();const e=this.generateUnits(),r=this.generateCategories(e);this.categories=Object.values(r),this.generateForces(r,this.forcesIterator()),this.generateExtraConstraints()}processForWiki(e){if(this.loaded_wiki)return;this.loaded_wiki=!0,this.process();const r=e.rules||{};e.rules=r,this.imports.forEach(a=>{sr(a,"refs",this)});function s(a,o){a.id&&(a.parent=o,a.target&&sr(a.target,"refs",o),a instanceof on&&(r[a.id]=a))}wr(this,s,vt);for(const a of this.forces||[]){a.parent=this;for(const o of a.categories)o.parent=a}}processForEditor(){this.loaded_editor||(this.loaded_editor=!0,this.init(!1),this.gameSystem&&sr(this.gameSystem,"refs",this),wr(this,(e,r)=>{if(e.parent=r,e.catalogue=this,e.refs||(e.refs=[]),e.other_refs||(e.other_refs=[]),e.target&&sr(e.target,"refs",e),e.isProfile()&&!e.isLink()){const a=this.findOptionById(e.typeId);a&&sr(a,"refs",e)}const s=e.value;if(s){const a=this.findOptionById(s);a&&sr(a,"other_refs",e)}},vt),wr(this,e=>e.isLink()?this.updateLink(e):this.refreshErrors(e),vt))}get url(){return"%{book}"}isCatalogue(){return!0}isGameSystem(){return this.gameSystemId===this.id||!this.gameSystemId}isIdUnique(){return!0}getCatalogue(){return this}getGameSystem(){return this.isGameSystem()?this:this.gameSystem}getSystemId(){return this.isGameSystem()?this.id:this.gameSystemId}addError(e,r){this.removeError(e,r.id),e.errors||(e.errors=[]),this.errors||(this.errors=[]),e.errors.push(r),this.errors.push(r)}onRemoveError(e,r=!0){if(this.errors){const s=this.errors.indexOf(e);s>=0&&this.errors.splice(s,1)}if(e.other&&r){const s=e.other;s.getCatalogue()?.removeError(s,"duplicate-id-1",!1),s.getCatalogue()?.removeError(s,"duplicate-id-2",!1)}}removeErrors(e){e.errors?.forEach(r=>this.onRemoveError(r)),e instanceof si&&e.catalogue.updateConstraint(e,!0),delete e.errors}removeError(e,r,s=!0){e.errors?.length&&(e.errors=e.errors.filter(a=>(a.id===r&&this.onRemoveError(a,s),a.id!==r)))}*iterateCategoryEntries(){for(const e of this.imports)for(const r of e.categoryEntries||[])yield r;this.categoryEntries&&(yield*this.categoryEntries)}*iterateCostTypes(){for(const e of this.imports)for(const r of e.costTypes||[])yield r;this.costTypes&&(yield*this.costTypes)}*forcesIterator(){for(const e of this.imports)for(const r of e.forceEntries||[])yield r;this.forceEntries&&(yield*this.forceEntries)}*forcesIteratorRecursive(){if(this.forces)for(const e of this.forces)yield e,yield*e.forcesIteratorRecursive()}*iterateProfileTypes(){for(const e of this.imports)e.profileTypes&&(yield*e.profileTypes);this.profileTypes&&(yield*this.profileTypes)}*iteratePublications(){for(const e of this.imports)for(const r of e.publications||[])yield r;for(const e of this.publications||[])yield e}*iterateSelectionEntries(){for(const e of this.importsWithEntries){for(const r of e.sharedSelectionEntries||[])yield r;for(const r of e.sharedSelectionEntryGroups||[])yield r}this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllImported(){const e=["sharedSelectionEntries","sharedSelectionEntryGroups","sharedProfiles","sharedRules","sharedInfoGroups","categoryEntries"],r=["rules","entryLinks","profiles","infoGroups","selectionEntries","selectionEntryGroups"];for(const s of this.importsWithEntries)for(const a of r)for(const o of s[a]||[])o.import!==!1&&(yield o);for(const s of this.imports)for(const a of e)for(const o of s[a]||[])yield o;for(const s of r)for(const a of this[s]||[])yield a;for(const s of e)for(const a of this[s]||[])yield a}*iterateSelectionEntriesWithRoot(){for(const e of this.importsWithEntries){for(const r of e.selectionEntries||[])r.import!==!1&&(yield r);for(const r of e.entryLinks||[])r.import!==!1&&(yield r);for(const r of e.sharedSelectionEntries||[])yield r;for(const r of e.sharedSelectionEntryGroups||[])yield r}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks),this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups)}*iterateAllRootEntries(){for(const e of this.importsWithEntries){for(const r of e.selectionEntries||[])r.import!==!1&&(yield r);for(const r of e.entryLinks||[])r.import!==!1&&(yield r)}this.selectionEntries&&(yield*this.selectionEntries),this.entryLinks&&(yield*this.entryLinks)}*entriesIterator(){this.sharedSelectionEntries&&(yield*this.sharedSelectionEntries),this.selectionEntries&&(yield*this.selectionEntries),this.sharedSelectionEntryGroups&&(yield*this.sharedSelectionEntryGroups),this.selectionEntryGroups&&(yield*this.selectionEntryGroups),this.entryLinks&&(yield*this.entryLinks)}forEachNode(e){if(e(this),this.childs)for(const r of this.childs)r.forEachNode(e)}*selectionsIterator(){yield*this.forces}findOptionById(e){const r=this.index[e];if(r)return r;const s=this.imports.find(a=>e in a.index)?.index[e];if(s)return s;if(this.manager&&e)return this.manager.getLoadedCatalogue(e)??this.manager.getCatalogueInfo({targetId:e})}findOptionByIdGlobal(e){const r=this.index[e];if(r)return r;const s=this.imports.find(a=>e in a.index)?.index[e];if(s)return s;if(this.manager){const a=this.manager.findOptionById(e);return a||this.manager.getCatalogueInfo({targetId:e})}}findOptionsById(e){const r=[];for(const s of[this,...this.imports])for(const a of Object.values(s.index))a.id&&a.id===e&&r.push(a);return r}findOptionsByText(e,r=!1){if(!e||!e.trim()||r){const o=[];for(const f of[this,...this.imports])for(const c of Object.values(f.index))if(c.getName){if(c.isLink()&&c.target&&c.isCategory()&&!c.parent?.isForce())continue;r?c.getName()===e&&o.push(c):o.push(c)}return o}const s=[],a=po(e);for(const o of[this,...this.imports])for(const f of Object.values(o.index)){const c=f.getName?.call(f),l=f.id;if(c&&String(c).match(a)||l===e){if(f.isLink()&&f.target&&f.isCategory()&&!f.parent?.isForce())continue;s.push(f)}}return s}findForceByPath(e){if(!e.length)return;let r=this;for(const s of e)r=r?.forces?.find(a=>a.id===s);return r}generateNonConflictingId(e){if(e&&this.findOptionByIdGlobal(e)===void 0)return e;for(;;){const r=go();if(this.findOptionById(r)===void 0)return r}}generateCostIndex(){const e={};for(const r of this.imports)for(const s of r.costTypes||[])e[s.id]=s,this.index[s.id]=s;for(const r of this.costTypes||[])e[r.id]=r,this.index[r.id]=r;return this.costIndex=e,e}getSystem(){return this.gameSystem??this}indexInfo(){const e=this.gameSystem??this;e===this&&(e.infoIndex=new Qa);const r=e.infoIndex;if(!r)throw new Error("Couldn't index info: system isn't initialized");this.forEachObjectWhitelist((s,a)=>{if(!s.isLink()&&(s.isProfile()||s.isRule()||s.isCategory())&&(s.noindex||r.add(s.getName(),s),s.alias))for(const o of s.alias){const f=Rt(s);f.name=o,r.add(o,f)}})}generateImports(e=!0){const r={},s={};this.gameSystem&&(this.gameSystem.init(e),r[this.gameSystem.id]=this.gameSystem,s[this.gameSystem.id]=this.gameSystem,this.gameSystem.import||(this.gameSystem.imports=[]));for(const a of this.catalogueLinks||[]){const o=a.target;if(o){o.init(e);for(const f of o.imports)s[f.id]=f;for(const f of o.importsWithEntries)r[f.id]=f;a.importRootEntries&&(r[o.id]=o),s[o.id]=o}}return this.imports=Object.values(s),this.importsWithEntries=Object.values(r),this.imports}generateForces(e,r,s){s||(s=this);const a=[];for(const o of r){const f=Rt(o);f.main_catalogue=this;const c=[],l=new Set;if(e[zt]?.units?.length){c.push(e[zt]);for(const _ of e[zt].childs)l.add(_.id)}for(const _ of o.categoryLinks||[])if(_.targetId in e){const w=Rt(_);w.main_catalogue=this;const C=e[w.targetId];w.target=C,w.childs=C.childs;for(const y of w.childs)l.add(y.id);c.push(w)}for(const _ of o.categoryEntries||[])if(_.id in e){const w=e[_.id],C=Rt(w);C.main_catalogue=this;for(const y of C.childs)l.add(y.id);c.push(C)}const g=this.units.filter(_=>!l.has(_.id));if(g.length){const _=Rt(e[Yn]);_.childs=g,_.units=g,c.push(_)}f.childs=c,f.categories=c,this.index[f.id]=f,f.forceEntries&&f.generateForces(e),this.generateForces(e,f.forcesIterator(),f),a.push(f)}return fo(a,o=>o.sortIndex??1e3),s.forces=a,s.childs=a,a}generateCategories(e){const r={},s=new Set;for(const c of this.iterateCategoryEntries()){const l=Rt(c);l.main_catalogue=this;const g=e[l.id]||[];l.units=g,l.childs=g,this.index[c.id]=c,r[l.id]=l,s.add(l.id)}for(const c in e)if(!s.has(c)){const l=this.findOptionById(c);if(l){const g=Rt(l);g.main_catalogue=this;const _=e[g.id]||[];g.units=_,g.childs=_,this.index[l.id]=l,r[g.id]=g}}const a=e[zt]||[],o={name:"Uncategorized",id:zt,hidden:!1,units:a,childs:a,catalogue:this};r[zt]=Object.setPrototypeOf(o,or.prototype);const f={name:"Illegal Units",id:Yn,hidden:!0,units:[],childs:[],catalogue:this};return r[Yn]=Object.setPrototypeOf(f,or.prototype),r}generateUnits(){const e=[];for(const a of this.importsWithEntries){const o=a.isGameSystem();for(const f of a.selectionEntries||[])(o||f.import!==!1)&&e.push(f);for(const f of a.entryLinks||[])(o||f.import!==!1)&&e.push(f)}for(const a of this.selectionEntries||[])e.push(a);for(const a of this.entryLinks||[])e.push(a);const r=lo(e,a=>a.getName());return this.units=r,uo(r,a=>a.getPrimaryCategory())}generateExtraConstraints(){const e={},r=[],s={},a=new Set,o={};function f(c,l,g){const _=l.target||l;for(const w of g){if(w.type==="max")continue;const C=`${w.id}::${l.id}`;switch(w.scope){case"parent":break;case"roster":e[C]=l.getBoundConstraint(w);break;case"force":r.push(l.getBoundConstraint(w));break;case"primary-category":case"primary-catalogue":break;default:if(a.has(w.scope)){vr(s,w.scope,_.getBoundConstraint(w));break}const y=c.index[w.scope];if(y){const S=y.extra_constraints||[];S.push(l.getBoundConstraint(w)),y.extra_constraints=S;break}break}}}for(const c of this.forcesIteratorRecursive())f(this,c,c.constraintsIterator()),a.add(c.id);for(const c of this.categories)a.add(c.id);for(const c of this.categories){f(this,c,c.constraintsIterator());const l={};c.forEachNodeCb(g=>{if(g&&!g.isForce()&&(!g.isGroup()&&!g.extra_constraints&&(g.extra_constraints=g.getChildBoundConstraints(!0)),!(g.isCategory()&&g.isLink())&&!(!g.constraints&&!g.target?.constraints))){for(const _ of g.constraintsIterator())if(_.type==="min"||_.type==="exactly"){const w=`${_.id}::${g.id}`;switch(_.scope){case"parent":break;case"roster":e[w]=g.getBoundConstraint(_);break;case"force":l[w]=g.getBoundConstraint(_);break;case"primary-category":case"primary-catalogue":break;default:if(a.has(_.scope)){vr(s,_.scope,g.getBoundConstraint(_));break}const C=this.index[_.scope];if(C){const y=C.extra_constraints||[];y.push(g.getBoundConstraint(_)),C.extra_constraints=y;break}break}}}}),o[c.getId()]=Object.values(l)}for(const c of this.forcesIteratorRecursive()){const l=c.extra_constraints||[];l.push(...r),c.id in s&&l.push(...s[c.id]),l.length&&(c.extra_constraints=l);for(const g of c.categories)g.getId()in o&&l.push(...o[g.getId()]);l.length&&(c.extra_constraints=l);for(const g of c.forcesIterator())for(const _ of g.constraintsIterator())(_.type==="min"||_.type==="exactly")&&["parent","force",g.id].includes(_.scope)&&l.push(g.getBoundConstraint(_))}for(const c of this.categories){const l=c.extra_constraints||[];c.id in s&&l.push(...s[c.id]),l.length&&(c.extra_constraints=l)}this.roster_constraints=Object.values(e)}async reload(e=this.manager){delete this.initialized,delete this.loaded,delete this.loaded_editor;const r=this.refs;delete this.index;const s=this.isGameSystem()?"gameSystem":"catalogue",a=await e.loadData({[s]:this});if(this.processForEditor(),r)for(const o of r)o.editorTypeName==="catalogueLink"&&await o.catalogue?.reload(e);return a}refreshErrors(e,r=!1){if(this.removeErrors(e),e.comment?.startsWith("todo:")?this.addError(e,{source:e,severity:"info",msg:`${e.getName()}: ${e.comment}`,id:"comment"}):e.comment?.startsWith("warning:")?this.addError(e,{source:e,severity:"warning",msg:`${e.getName()}: ${e.comment}`,id:"comment"}):e.comment?.startsWith("error:")?this.addError(e,{source:e,severity:"error",msg:`${e.getName()}: ${e.comment}`,id:"comment"}):this.removeError(e,"comment"),e.isLink()){e.target?(Kn(this.unresolvedLinks,e.targetId,$toRaw(e)),Kn(this.manager.unresolvedLinks,e.targetId,$toRaw(e))):(this.addError(e,{source:e,severity:"error",msg:`(${e.editorTypeName}) ${e.name} has no target`,id:"no-target"}),!this.unresolvedLinks[e.targetId]?.includes($toRaw(e))&&!r&&vr(this.unresolvedLinks,e.targetId,$toRaw(e)),this.manager.unresolvedLinks[e.targetId]?.includes($toRaw(e))||vr(this.manager.unresolvedLinks,e.targetId,$toRaw(e)));const s=ai(e.targetId,this.getIndexes());if(gu(e).find(o=>o.id===e.targetId))e.catalogue.addError(e,{id:"bad-link-target",msg:"Link target cannot be itself or include itself as a child",source:e});else if(s?.isLink()){e.catalogue.addError(e,{id:"bad-link-target",msg:"Link target Cannot be a Link",source:e});return}}else e.isProfile()?e.typeId||this.addError(e,{source:e,severity:"error",msg:"Profile has no type",id:"no-profile-type"}):e instanceof Or&&this.updateCondition(e)}addToIndex(e){if(e.id){if(e.catalogue=this,this.manager?.settings?.globalDuplicateIdError){const r=this.manager.index;if(r[e.id]&&r[e.id]!==e&&(e.isIdUnique()||r[e.id].isIdUnique())){const s=r[e.id],a=s.getCatalogue();a&&this!==a&&(a.addError(s,{source:s,severity:"error",msg:`Duplicate id ${e.id} ${e.getName()}`,id:"duplicate-id-1",other:e,extra:a.name}),a.addError(e,{source:e,severity:"error",msg:`Duplicate id ${e.id} ${s.getName()}`,id:"duplicate-id-2",other:s,extra:this.name}),this.addError(s,{source:s,severity:"error",msg:`Duplicate id ${e.id}  ${e.getName()}`,id:"duplicate-id-1",other:e,extra:a.name}),this.addError(e,{source:e,severity:"error",msg:`Duplicate id ${e.id} ${s.getName()}`,id:"duplicate-id-2",other:s,extra:this.name}))}r[e.id]=e}else if(this.index[e.id]&&this.index[e.id]!==e){const r=this.index[e.id];(e.isIdUnique()||r.isIdUnique()||e.getName()!==r.getName())&&(this.addError(r,{source:r,severity:"error",msg:`Duplicate id ${e.id} ${e.getName()}`,id:"duplicate-id-1",other:e}),this.addError(e,{source:e,severity:"error",msg:`Duplicate id ${e.id} ${r.getName()}`,id:"duplicate-id-2",other:r}))}if(this.index[e.id]=e,this.unresolvedLinks&&this.unresolvedLinks[e.id])for(const r of[...this.unresolvedLinks[e.id]])r.isLink()&&r.catalogue?this.updateLink(r):this.refreshErrors(r);if(this.manager?.unresolvedLinks&&this.manager.unresolvedLinks[e.id]?.length)for(const r of[...this.manager.unresolvedLinks[e.id]])r.isLink()?r.catalogue?.updateLink(r):r.catalogue?.refreshErrors(r)}}removeFromIndex(e){e.id&&$toRaw(this.index[e.id])===$toRaw(e)&&delete this.index[e.id],this.removeErrors(e);for(const r of e.refs||[])delete r.target,r.catalogue.refreshErrors(r);for(const r of e.other_refs||[])r.catalogue?.refreshErrors(r,!0)}getIndexes(){const e=[];e.push(this.index);for(const r of this.imports)e.push(r.index);return e}resolveAllLinks(e=!0){const r=[],s=[],a=[];this.index=pu(),wr(this,(c,l)=>{this.addToIndex(c),c.publicationId&&(delete c.publication,s.push(c)),c.isLink()&&(delete c.target,r.push(c),a.push(l)),du(c)},vt);const o=this.getIndexes(),f=lu(r,o,a,e);if(fu(s,o),!e){this.unresolvedLinks={};for(const c of f)vr(this.unresolvedLinks,c.targetId,$toRaw(c)),delete c.target}}removeRef(e,r){r.refs||(r.refs=[]);const s=r.refs.indexOf(e);s>=0&&r.refs.splice(s,1)}addRef(e,r){r.refs||(r.refs=[]),r.refs.indexOf(e)===-1&&r.refs.push(e)}hasOtherRef(e,r){return r.other_refs&&r.other_refs.includes(e)}removeOtherRef(e,r){r.other_refs||(r.other_refs=[]);const s=r.other_refs.indexOf(e);s>=0&&r.other_refs.splice(s,1)}addOtherRef(e,r){r.other_refs||(r.other_refs=[]),r.other_refs.indexOf(e)===-1&&r.other_refs.push(e)}updateLink(e){e.target&&this.removeRef(e,e.target);const r=ai(e.targetId,this.getIndexes());if(e.target=r,e.target){e.name=r.name,this.addRef(e,e.target);const s=e.target.editorTypeName;s=="categoryEntry"?delete e.type:e.type=s}return this.refreshErrors(e),e.target!==void 0}updateConstraint(e,r=!1){const s=new Set,a=new Set;for(const o of e.parent?.constraintsIterator()||[])r&&e===o||(s.has(o.id)?a.add(o.id):s.add(o.id));for(const o of e.parent?.constraintsIterator()||[])r&&e===o||(a.has(o.id)?o.catalogue?.addError(o,{id:"duplicate-constraint-id",msg:"Duplicate constraints id",source:e}):o.catalogue?.removeError(o,"duplicate-constraint-id"))}updateCondition(e,r){if(e.scope){const a=Wt(e);if(a&&!iu(a,e.scope)?this.addError(e,{source:e,id:"invalid-scope",msg:`Invalid scope ${e.scope}`}):this.removeError(e,"invalid-scope"),e.scope&&!As.has(e.scope)){const o=this.findOptionById(e.scope);o&&o.getCatalogue().addOtherRef(e,o)}}if(e instanceof si)return this.updateConstraint(e);const s=["instanceOf","notInstanceOf"].includes(e.type);if(r&&!is.has(r)){const a=s?this.findOptionByIdGlobal(r):this.findOptionById(r);a&&this.removeOtherRef(e,a)}if(e.childId){if(is.has(e.childId)){this.removeError(e,"id-not-exist");return}const a=s?this.findOptionByIdGlobal(e.childId):this.findOptionById(e.childId);if(a){this.hasOtherRef(e,a)||this.addOtherRef(e,a),this.removeError(e,"id-not-exist"),Kn(this.manager.unresolvedLinks,e.childId,$toRaw(e));return}}e.editorTypeName!=="localConditionGroup"&&this.addError(e,{source:e,severity:"warning",msg:"child id does not exist",id:"id-not-exist"}),ho(this.manager.unresolvedLinks,e.childId,$toRaw(e))}unlinkLink(e){e.target&&this.removeRef(e,e.target)}getForceLabel(){return this.gameSystem.getForceLabel()}}class cu extends Ts{forceLabel;getForceLabel(){return this.forceLabel??"Force"}}function ai(n,e){for(const r of e)if(n in r)return r[n]}function lu(n=[],e,r,s=!0){n.length;let a=0;for(;n.length!==a;){const o=n,f=r;a=o.length,n=[],r=[];for(let c=0;c<o.length;c++){const l=o[c],g=f[c],_=l.targetId,w=ai(_,e);if(w){w.isLink()?console.warn(`Failed to resolve link (target is a link): ${l.getName()}(${l.id})`):l.target=w;continue}n.push(l),r.push(g)}}if(n.length&&s)for(let o=0;o<n.length;o++){const f=n[o],c=r[o];for(const[l,g]of Object.entries(c))if(g===f&&delete c[l],Array.isArray(g))for(const _ in g)g[_]===f&&g.splice(_,1)}return n}function fu(n=[],e){for(const r of n)for(const s of e)if(r.publicationId in s){r.publication=s[r.publicationId];break}}function du(n){return n.shared!==!1&&n.childId!==void 0}let hu=class{get[Symbol.toStringTag](){return"ObjectNoObserve"}};function pu(){return new hu}function gu(n){const e=[];if(n.isCatalogue()||!n.parent&&!n.refs?.length)return e;let r=[];const s=[],a=[n.parent,...n?.refs??[]].filter(Boolean),o=new Set;for(;a.length;){for(s.push(a.shift()),r=[];s.length;){const f=s.pop();o.has(f.id)||(o.add(f.id),r.push(f),f.parent&&!f.parent.isCatalogue()&&s.push(f.parent),f.refs&&a.push(...f.refs))}e.push(...r.reverse())}return e.filter(f=>f.editorTypeName!=="catalogueLink")}function Ns(n,e){if(e?.target)return Ns(e.target.parentKey,e.target)+"Link";const r=Sr[n]?.type;return r||n}function Ps(n){const e=n.parentKey;switch(e){case"selectionEntries":case"sharedSelectionEntries":case"selectionEntryGroups":case"sharedSelectionEntryGroups":case"entryLinks":case"forceEntries":case"categoryLinks":case"categoryEntries":case"sharedInfoGroups":case"infoGroups":case"catalogueLinks":case"publications":case"profileTypes":case"catalogue":case"gameSystem":case"rules":case"sharedRules":case"costs":case"costTypes":case"sharedProfiles":case"profiles":case"attributes":case"attributeTypes":case"characteristics":case"characteristicTypes":return n.getName();case"modifiers":return au(Wt(n),n);case"repeats":{const s=n,a=Wt(n);return a||console.error("no parent for repeat",n),`Repeat ${s.repeats} times for every ${s.value} ${Ht(a,s.field)} in ${Ht(a,s.scope)} of ${s.childId?Ht(a,s.childId):" any"}`+(s.includeChildSelections?" (recursive)":"")}case"constraints":const r=n;return ei(Wt(n),r);case"conditions":return ei(Wt(n),n);case"localConditionGroups":return ei(Wt(n),n)+" where:";case"modifierGroups":return"Modify...";case"conditionGroups":return`${n.type.toUpperCase()}`;case"infoLinks":return n.target?Ps(n.target):n.getName();case"associations":return n.name;default:return console.log(e,n),e}}class mu{get[Symbol.toStringTag](){return"ObjectNoObserve"}}function yu(){return new mu}const vu={};function bu(n,e,r){if(e in n)return n[e];class s extends Ve{parent;get parentKey(){return e}get editorTypeName(){return Ns(e,this)}toString(){return`${this.editorTypeName} - ${Ps(this)}`}}return s.prototype.parentKey,Object.setPrototypeOf(s.prototype,Object.getPrototypeOf(r)),n[e]=s.prototype,s.prototype}function _u(n,e,r){Object.setPrototypeOf(r,bu(n,e,r))}const ti={"*":Ve.prototype,catalogue:Ts.prototype,catalogueLinks:uu.prototype,gameSystem:cu.prototype,forceEntries:tn.prototype,forces:tn.prototype,forceEntry:tn.prototype,force:tn.prototype,categoryEntries:or.prototype,categoryEntry:or.prototype,category:or.prototype,categories:or.prototype,link:Cr.prototype,infoLinks:Fa.prototype,categoryLinks:xs.prototype,entry:Vn.prototype,selectionEntries:Vn.prototype,entryLinks:Cr.prototype,sharedSelectionEntries:Vn.prototype,group:Hn.prototype,selectionEntryGroups:Hn.prototype,sharedSelectionEntryGroups:Hn.prototype,sharedRules:on.prototype,rules:on.prototype,rule:on.prototype,profileTypes:Ua.prototype,sharedProfiles:Jn.prototype,profiles:Jn.prototype,profile:Jn.prototype,characteristics:ns.prototype,characteristic:ns.prototype,characteristicTypes:Ve.prototype,characteristicType:Ve.prototype,sharedInfoGroups:Qn.prototype,infoGroups:Qn.prototype,infoGroup:Qn.prototype,publications:ls.prototype,publication:ls.prototype,repeats:Or.prototype,conditions:Or.prototype,constraints:si.prototype,modifiers:Is.prototype,modifierGroups:Ss.prototype};function wu(n){return n in ti?ti[n]:ti["*"]}function ui(n,e){const r=wu(e);return r&&(Object.setPrototypeOf(n,r),n.post_init&&n.post_init(),globalThis.isEditor&&_u(n.keyInfoCache||vu,e,n)),n}function ku(n){const e=[n];for(;e.length;){const r=e.pop();for(const s of Object.keys(r)){const a=r[s];if(yt(a))if(Array.isArray(a)){if(a.length&&yt(a[0]))for(let o=a.length;o--;){const f=a[o];Wi(f)&&(ui(f,s),e.push(f))}}else Wi(a)&&(ui(a,s),e.push(a))}}}async function ln(n,e,r,s){if(!e.catalogue&&!e.gameSystem)throw Error("invalid loadBsData argument: no .catalogue or .gameSystem in data");const a=e.catalogue?"catalogue":"gameSystem",o=a==="gameSystem",f=a==="catalogue",c=e[a],l=c;if(l instanceof Ve)return l;ku(c);const g=ui(c,a);if(g.manager=n,f){const w={targetId:g.gameSystemId},C=n.getLoadedCatalogue(w,r);if(C)g.gameSystem=C;else{const y=await n.getData(w,r),S=n.getLoadedCatalogue(w,r);S?g.gameSystem=S:g.gameSystem=await ln(n,y,r)}}const _=[];for(const w of g?.catalogueLinks||[]){if(!w.targetId){console.warn(`invalid link: no targetId in link: ${w}, found in ${c.name}`);continue}if(w.targetId===g.id){w.target=g;continue}const C=n.getLoadedCatalogue(w,r);if(C){w.target=C;continue}const y=n.getData(w,r).then(S=>{const b=n.getLoadedCatalogue(w,r);if(b){w.target=b;return}return ln(n,S,r).then(E=>w.target=E)});_.push(y)}return await Promise.all(_),o&&n.addLoadedSystem(g),f&&n.addLoadedCatalogue(g),g}class Eu{catalogues={};unresolvedLinks;settings;system;translations;async getData(e,r){throw new Error("Method not implemented.")}async loadAll(){throw new Error("Method not implemented.")}async translate(e){if(this.translations){const r=this.translations;qi(rs(e),(s,a,o)=>{typeof s=="string"&&s in r&&(o[a]=r[s],o[`original_${a}`]=s)},(s,a)=>!(!vt.has(a)||!(s instanceof Ve)))}}async untranslate(e){qi(rs(e),(r,s,a)=>{if(s.startsWith("original_")){const o=li(s,"original_");a[o]=r,delete a[s]}},(r,s)=>!(!vt.has(s)||!(r instanceof Ve)))}async setTranslations(e){const r=this.translations;this.translations=e??void 0;for(const s of this.getAllLoadedCatalogues())r&&await this.untranslate(s),e&&await this.translate(s)}getTranslations(){return this.translations}getCatalogueInfo(e){return this.system?.books.array?.find(r=>r.bsid===e.targetId)}findOptionById(e){}getLoadedCatalogue(e,r){const s=typeof e=="string"?e:e.targetId||e.name,a=cs(r,s)||"default",o=this.catalogues[s];return o?o[a]:void 0}getAllLoadedCatalogues(){return Object.values(this.catalogues).map(e=>Object.values(e)).flat(1)}addLoadedCatalogue(e,r){const s=cs(r,e.id)||"default";this.catalogues[e.name]||(this.catalogues[e.name]={}),this.catalogues[e.id]||(this.catalogues[e.id]={}),this.catalogues[e.name][s]=e,this.catalogues[e.id][s]=e}addLoadedSystem(e,r){return this.addLoadedCatalogue(e,r)}unloadAll(){this.catalogues={}}async loadData(e,r){const s=await ln(this,e,r);return s.process(),s}async loadCatalogue(e,r,s){const a=this.getLoadedCatalogue(e,r);if(a&&!s)return a;const o=await this.getData(e,r);if(o)return await this.loadData(o,r);throw Error(`Couldn't load catalogue: couldn't getData ${e}`)}}var an={exports:{}},xu=an.exports,fs;function Iu(){return fs||(fs=1,function(n,e){(function(r,s){n.exports=s()})(xu,function(){var r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var p in d)Object.prototype.hasOwnProperty.call(d,p)&&(u[p]=d[p])})(t,i)},s=function(){return(s=Object.assign||function(t){for(var i,u=1,d=arguments.length;u<d;u++)for(var p in i=arguments[u])Object.prototype.hasOwnProperty.call(i,p)&&(t[p]=i[p]);return t}).apply(this,arguments)};function a(t,i,u){for(var d,p=0,v=i.length;p<v;p++)!d&&p in i||((d=d||Array.prototype.slice.call(i,0,p))[p]=i[p]);return t.concat(d||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:_r,f=Object.keys,c=Array.isArray;function l(t,i){return typeof i!="object"||f(i).forEach(function(u){t[u]=i[u]}),t}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var g=Object.getPrototypeOf,_={}.hasOwnProperty;function w(t,i){return _.call(t,i)}function C(t,i){typeof i=="function"&&(i=i(g(t))),(typeof Reflect>"u"?f:Reflect.ownKeys)(i).forEach(function(u){S(t,u,i[u])})}var y=Object.defineProperty;function S(t,i,u,d){y(t,i,l(u&&w(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},d))}function b(t){return{from:function(i){return t.prototype=Object.create(i.prototype),S(t.prototype,"constructor",t),{extend:C.bind(null,t.prototype)}}}}var E=Object.getOwnPropertyDescriptor,k=[].slice;function A(t,i,u){return k.call(t,i,u)}function L(t,i){return i(t)}function M(t){if(!t)throw new Error("Assertion Failed")}function j(t){o.setImmediate?setImmediate(t):setTimeout(t,0)}function te(t,i){if(typeof i=="string"&&w(t,i))return t[i];if(!i)return t;if(typeof i!="string"){for(var u=[],d=0,p=i.length;d<p;++d){var v=te(t,i[d]);u.push(v)}return u}var x=i.indexOf(".");if(x!==-1){var T=t[i.substr(0,x)];return T==null?void 0:te(T,i.substr(x+1))}}function X(t,i,u){if(t&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof i!="string"&&"length"in i){M(typeof u!="string"&&"length"in u);for(var d=0,p=i.length;d<p;++d)X(t,i[d],u[d])}else{var v,x,T=i.indexOf(".");T!==-1?(v=i.substr(0,T),(x=i.substr(T+1))===""?u===void 0?c(t)&&!isNaN(parseInt(v))?t.splice(v,1):delete t[v]:t[v]=u:X(T=!(T=t[v])||!w(t,v)?t[v]={}:T,x,u)):u===void 0?c(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=u}}function ue(t){var i,u={};for(i in t)w(t,i)&&(u[i]=t[i]);return u}var ee=[].concat;function he(t){return ee.apply([],t)}var Se="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(he([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(i){return i+t+"Array"})}))).filter(function(t){return o[t]}),Ce=new Set(Se.map(function(t){return o[t]})),P=null;function Q(t){return P=new WeakMap,t=function i(u){if(!u||typeof u!="object")return u;var d=P.get(u);if(d)return d;if(c(u)){d=[],P.set(u,d);for(var p=0,v=u.length;p<v;++p)d.push(i(u[p]))}else if(Ce.has(u.constructor))d=u;else{var x,T=g(u);for(x in d=T===Object.prototype?{}:Object.create(T),P.set(u,d),u)w(u,x)&&(d[x]=i(u[x]))}return d}(t),P=null,t}var m={}.toString;function ie(t){return m.call(t).slice(8,-1)}var Te=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ae=typeof Te=="symbol"?function(t){var i;return t!=null&&(i=t[Te])&&i.apply(t)}:function(){return null};function Pe(t,i){return i=t.indexOf(i),0<=i&&t.splice(i,1),0<=i}var ce={};function Ae(t){var i,u,d,p;if(arguments.length===1){if(c(t))return t.slice();if(this===ce&&typeof t=="string")return[t];if(p=ae(t)){for(u=[];!(d=p.next()).done;)u.push(d.value);return u}if(t==null)return[t];if(typeof(i=t.length)!="number")return[t];for(u=new Array(i);i--;)u[i]=t[i];return u}for(i=arguments.length,u=new Array(i);i--;)u[i]=arguments[i];return u}var Y=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},pe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],mt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(pe),Z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Oe(t,i){this.name=t,this.message=i}function ke(t,i){return t+". Errors: "+Object.keys(i).map(function(u){return i[u].toString()}).filter(function(u,d,p){return p.indexOf(u)===d}).join(`
`)}function ye(t,i,u,d){this.failures=i,this.failedKeys=d,this.successCount=u,this.message=ke(t,i)}function Ke(t,i){this.name="BulkError",this.failures=Object.keys(i).map(function(u){return i[u]}),this.failuresByPos=i,this.message=ke(t,this.failures)}b(Oe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),b(ye).from(Oe),b(Ke).from(Oe);var Qe=mt.reduce(function(t,i){return t[i]=i+"Error",t},{}),Ue=Oe,me=mt.reduce(function(t,i){var u=i+"Error";function d(p,v){this.name=u,p?typeof p=="string"?(this.message="".concat(p).concat(v?`
 `+v:""),this.inner=v||null):typeof p=="object"&&(this.message="".concat(p.name," ").concat(p.message),this.inner=p):(this.message=Z[i]||u,this.inner=null)}return b(d).from(Ue),t[i]=d,t},{});me.Syntax=SyntaxError,me.Type=TypeError,me.Range=RangeError;var He=pe.reduce(function(t,i){return t[i+"Error"]=me[i],t},{}),De=mt.reduce(function(t,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(t[i+"Error"]=me[i]),t},{});function Re(){}function nt(t){return t}function h(t,i){return t==null||t===nt?i:function(u){return i(t(u))}}function re(t,i){return function(){t.apply(this,arguments),i.apply(this,arguments)}}function J(t,i){return t===Re?i:function(){var u=t.apply(this,arguments);u!==void 0&&(arguments[0]=u);var d=this.onsuccess,p=this.onerror;this.onsuccess=null,this.onerror=null;var v=i.apply(this,arguments);return d&&(this.onsuccess=this.onsuccess?re(d,this.onsuccess):d),p&&(this.onerror=this.onerror?re(p,this.onerror):p),v!==void 0?v:u}}function O(t,i){return t===Re?i:function(){t.apply(this,arguments);var u=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?re(u,this.onsuccess):u),d&&(this.onerror=this.onerror?re(d,this.onerror):d)}}function I(t,i){return t===Re?i:function(u){var d=t.apply(this,arguments);l(u,d);var p=this.onsuccess,v=this.onerror;return this.onsuccess=null,this.onerror=null,u=i.apply(this,arguments),p&&(this.onsuccess=this.onsuccess?re(p,this.onsuccess):p),v&&(this.onerror=this.onerror?re(v,this.onerror):v),d===void 0?u===void 0?void 0:u:l(d,u)}}function G(t,i){return t===Re?i:function(){return i.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function oe(t,i){return t===Re?i:function(){var u=t.apply(this,arguments);if(u&&typeof u.then=="function"){for(var d=this,p=arguments.length,v=new Array(p);p--;)v[p]=arguments[p];return u.then(function(){return i.apply(d,v)})}return i.apply(this,arguments)}}De.ModifyError=ye,De.DexieError=Oe,De.BulkError=Ke;var se=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function q(t){se=t}var le={},Ee=100,Se=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,g(t),t];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,g(i),t]}(),pe=Se[0],mt=Se[1],Se=Se[2],mt=mt&&mt.then,Ge=pe&&pe.constructor,ze=!!Se,et=function(t,i){St.push([t,i]),ut&&(queueMicrotask(Bs),ut=!1)},wt=!0,ut=!0,dt=[],qe=[],It=nt,gt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Re,pgp:!1,env:{},finalize:Re},xe=gt,St=[],kt=0,Yt=[];function we(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=xe;if(typeof t!="function"){if(t!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ot(this,this._value))}this._state=null,this._value=null,++i.ref,function u(d,p){try{p(function(v){if(d._state===null){if(v===d)throw new TypeError("A promise cannot be resolved with itself.");var x=d._lib&&Jt();v&&typeof v.then=="function"?u(d,function(T,B){v instanceof we?v._then(T,B):v.then(T,B)}):(d._state=!0,d._value=v,hi(d)),x&&Qt()}},Ot.bind(null,d))}catch(v){Ot(d,v)}}(this,t)}var Xt={get:function(){var t=xe,i=Lr;function u(d,p){var v=this,x=!t.global&&(t!==xe||i!==Lr),T=x&&!Tt(),B=new we(function(z,$){dn(v,new Ct(gi(d,t,x,T),gi(p,t,x,T),z,$,t))});return this._consoleTask&&(B._consoleTask=this._consoleTask),B}return u.prototype=le,u},set:function(t){S(this,"then",t&&t.prototype===le?Xt:{get:function(){return t},set:Xt.set})}};function Ct(t,i,u,d,p){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof i=="function"?i:null,this.resolve=u,this.reject=d,this.psd=p}function Ot(t,i){var u,d;qe.push(i),t._state===null&&(u=t._lib&&Jt(),i=It(i),t._state=!1,t._value=i,d=t,dt.some(function(p){return p._value===d._value})||dt.push(d),hi(t),u&&Qt())}function hi(t){var i=t._listeners;t._listeners=[];for(var u=0,d=i.length;u<d;++u)dn(t,i[u]);var p=t._PSD;--p.ref||p.finalize(),kt===0&&(++kt,et(function(){--kt==0&&hn()},[]))}function dn(t,i){if(t._state!==null){var u=t._state?i.onFulfilled:i.onRejected;if(u===null)return(t._state?i.resolve:i.reject)(t._value);++i.psd.ref,++kt,et(Ls,[u,t,i])}else t._listeners.push(i)}function Ls(t,i,u){try{var d,p=i._value;!i._state&&qe.length&&(qe=[]),d=se&&i._consoleTask?i._consoleTask.run(function(){return t(p)}):t(p),i._state||qe.indexOf(p)!==-1||function(v){for(var x=dt.length;x;)if(dt[--x]._value===v._value)return dt.splice(x,1)}(i),u.resolve(d)}catch(v){u.reject(v)}finally{--kt==0&&hn(),--u.psd.ref||u.psd.finalize()}}function Bs(){jt(gt,function(){Jt()&&Qt()})}function Jt(){var t=wt;return ut=wt=!1,t}function Qt(){var t,i,u;do for(;0<St.length;)for(t=St,St=[],u=t.length,i=0;i<u;++i){var d=t[i];d[0].apply(null,d[1])}while(0<St.length);ut=wt=!0}function hn(){var t=dt;dt=[],t.forEach(function(d){d._PSD.onunhandled.call(null,d._value,d)});for(var i=Yt.slice(0),u=i.length;u;)i[--u]()}function Tr(t){return new we(le,!1,t)}function Ze(t,i){var u=xe;return function(){var d=Jt(),p=xe;try{return Nt(u,!0),t.apply(this,arguments)}catch(v){i&&i(v)}finally{Nt(p,!1),d&&Qt()}}}C(we.prototype,{then:Xt,_then:function(t,i){dn(this,new Ct(null,null,t,i,xe))},catch:function(t){if(arguments.length===1)return this.then(null,t);var i=t,u=arguments[1];return typeof i=="function"?this.then(null,function(d){return(d instanceof i?u:Tr)(d)}):this.then(null,function(d){return(d&&d.name===i?u:Tr)(d)})},finally:function(t){return this.then(function(i){return we.resolve(t()).then(function(){return i})},function(i){return we.resolve(t()).then(function(){return Tr(i)})})},timeout:function(t,i){var u=this;return t<1/0?new we(function(d,p){var v=setTimeout(function(){return p(new me.Timeout(i))},t);u.then(d,p).finally(clearTimeout.bind(null,v))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&S(we.prototype,Symbol.toStringTag,"Dexie.Promise"),gt.env=pi(),C(we,{all:function(){var t=Ae.apply(null,arguments).map(Br);return new we(function(i,u){t.length===0&&i([]);var d=t.length;t.forEach(function(p,v){return we.resolve(p).then(function(x){t[v]=x,--d||i(t)},u)})})},resolve:function(t){return t instanceof we?t:t&&typeof t.then=="function"?new we(function(i,u){t.then(i,u)}):new we(le,!0,t)},reject:Tr,race:function(){var t=Ae.apply(null,arguments).map(Br);return new we(function(i,u){t.map(function(d){return we.resolve(d).then(i,u)})})},PSD:{get:function(){return xe},set:function(t){return xe=t}},totalEchoes:{get:function(){return Lr}},newPSD:At,usePSD:jt,scheduler:{get:function(){return et},set:function(t){et=t}},rejectionMapper:{get:function(){return It},set:function(t){It=t}},follow:function(t,i){return new we(function(u,d){return At(function(p,v){var x=xe;x.unhandleds=[],x.onunhandled=v,x.finalize=re(function(){var T,B=this;T=function(){B.unhandleds.length===0?p():v(B.unhandleds[0])},Yt.push(function z(){T(),Yt.splice(Yt.indexOf(z),1)}),++kt,et(function(){--kt==0&&hn()},[])},x.finalize),t()},i,u,d)})}}),Ge&&(Ge.allSettled&&S(we,"allSettled",function(){var t=Ae.apply(null,arguments).map(Br);return new we(function(i){t.length===0&&i([]);var u=t.length,d=new Array(u);t.forEach(function(p,v){return we.resolve(p).then(function(x){return d[v]={status:"fulfilled",value:x}},function(x){return d[v]={status:"rejected",reason:x}}).then(function(){return--u||i(d)})})})}),Ge.any&&typeof AggregateError<"u"&&S(we,"any",function(){var t=Ae.apply(null,arguments).map(Br);return new we(function(i,u){t.length===0&&u(new AggregateError([]));var d=t.length,p=new Array(d);t.forEach(function(v,x){return we.resolve(v).then(function(T){return i(T)},function(T){p[x]=T,--d||u(new AggregateError(p))})})})}),Ge.withResolvers&&(we.withResolvers=Ge.withResolvers));var tt={awaits:0,echoes:0,id:0},Rs=0,Nr=[],Pr=0,Lr=0,zs=0;function At(t,i,u,d){var p=xe,v=Object.create(p);return v.parent=p,v.ref=0,v.global=!1,v.id=++zs,gt.env,v.env=ze?{Promise:we,PromiseProp:{value:we,configurable:!0,writable:!0},all:we.all,race:we.race,allSettled:we.allSettled,any:we.any,resolve:we.resolve,reject:we.reject}:{},i&&l(v,i),++p.ref,v.finalize=function(){--this.parent.ref||this.parent.finalize()},d=jt(v,t,u,d),v.ref===0&&v.finalize(),d}function er(){return tt.id||(tt.id=++Rs),++tt.awaits,tt.echoes+=Ee,tt.id}function Tt(){return!!tt.awaits&&(--tt.awaits==0&&(tt.id=0),tt.echoes=tt.awaits*Ee,!0)}function Br(t){return tt.echoes&&t&&t.constructor===Ge?(er(),t.then(function(i){return Tt(),i},function(i){return Tt(),Ye(i)})):t}function Fs(){var t=Nr[Nr.length-1];Nr.pop(),Nt(t,!1)}function Nt(t,i){var u,d=xe;(i?!tt.echoes||Pr++&&t===xe:!Pr||--Pr&&t===xe)||queueMicrotask(i?(function(p){++Lr,tt.echoes&&--tt.echoes!=0||(tt.echoes=tt.awaits=tt.id=0),Nr.push(xe),Nt(p,!0)}).bind(null,t):Fs),t!==xe&&(xe=t,d===gt&&(gt.env=pi()),ze&&(u=gt.env.Promise,i=t.env,(d.global||t.global)&&(Object.defineProperty(o,"Promise",i.PromiseProp),u.all=i.all,u.race=i.race,u.resolve=i.resolve,u.reject=i.reject,i.allSettled&&(u.allSettled=i.allSettled),i.any&&(u.any=i.any))))}function pi(){var t=o.Promise;return ze?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function jt(t,i,u,d,p){var v=xe;try{return Nt(t,!0),i(u,d,p)}finally{Nt(v,!1)}}function gi(t,i,u,d){return typeof t!="function"?t:function(){var p=xe;u&&er(),Nt(i,!0);try{return t.apply(this,arguments)}finally{Nt(p,!1),d&&queueMicrotask(Tt)}}}function pn(t){Promise===Ge&&tt.echoes===0?Pr===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+mt).indexOf("[native code]")===-1&&(er=Tt=Re);var Ye=we.reject,Ut="￿",Et="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",mi="String expected.",tr=[],Rr="__dbnames",gn="readonly",mn="readwrite";function $t(t,i){return t?i?function(){return t.apply(this,arguments)&&i.apply(this,arguments)}:t:i}var yi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function zr(t){return typeof t!="string"||/\./.test(t)?function(i){return i}:function(i){return i[t]===void 0&&t in i&&delete(i=Q(i))[t],i}}function vi(){throw me.Type()}function $e(t,i){try{var u=bi(t),d=bi(i);if(u!==d)return u==="Array"?1:d==="Array"?-1:u==="binary"?1:d==="binary"?-1:u==="string"?1:d==="string"?-1:u==="Date"?1:d!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return i<t?1:t<i?-1:0;case"binary":return function(p,v){for(var x=p.length,T=v.length,B=x<T?x:T,z=0;z<B;++z)if(p[z]!==v[z])return p[z]<v[z]?-1:1;return x===T?0:x<T?-1:1}(_i(t),_i(i));case"Array":return function(p,v){for(var x=p.length,T=v.length,B=x<T?x:T,z=0;z<B;++z){var $=$e(p[z],v[z]);if($!==0)return $}return x===T?0:x<T?-1:1}(t,i)}}catch{}return NaN}function bi(t){var i=typeof t;return i!="object"?i:ArrayBuffer.isView(t)?"binary":(t=ie(t),t==="ArrayBuffer"?"binary":t)}function _i(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var wi=(We.prototype._trans=function(t,i,u){var d=this._tx||xe.trans,p=this.name,v=se&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function x(z,$,N){if(!N.schema[p])throw new me.NotFound("Table "+p+" not part of transaction");return i(N.idbtrans,N)}var T=Jt();try{var B=d&&d.db._novip===this.db._novip?d===xe.trans?d._promise(t,x,u):At(function(){return d._promise(t,x,u)},{trans:d,transless:xe.transless||xe}):function z($,N,D,R){if($.idbdb&&($._state.openComplete||xe.letThrough||$._vip)){var U=$._createTransaction(N,D,$._dbSchema);try{U.create(),$._state.PR1398_maxLoop=3}catch(K){return K.name===Qe.InvalidState&&$.isOpen()&&0<--$._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),$.close({disableAutoOpen:!1}),$.open().then(function(){return z($,N,D,R)})):Ye(K)}return U._promise(N,function(K,F){return At(function(){return xe.trans=U,R(K,F,U)})}).then(function(K){if(N==="readwrite")try{U.idbtrans.commit()}catch{}return N==="readonly"?K:U._completion.then(function(){return K})})}if($._state.openComplete)return Ye(new me.DatabaseClosed($._state.dbOpenError));if(!$._state.isBeingOpened){if(!$._state.autoOpen)return Ye(new me.DatabaseClosed);$.open().catch(Re)}return $._state.dbReadyPromise.then(function(){return z($,N,D,R)})}(this.db,t,[this.name],x);return v&&(B._consoleTask=v,B=B.catch(function(z){return console.trace(z),Ye(z)})),B}finally{T&&Qt()}},We.prototype.get=function(t,i){var u=this;return t&&t.constructor===Object?this.where(t).first(i):t==null?Ye(new me.Type("Invalid argument to Table.get()")):this._trans("readonly",function(d){return u.core.get({trans:d,key:t}).then(function(p){return u.hook.reading.fire(p)})}).then(i)},We.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(c(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var i=f(t);if(i.length===1)return this.where(i[0]).equals(t[i[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(T){if(T.compound&&i.every(function(z){return 0<=T.keyPath.indexOf(z)})){for(var B=0;B<i.length;++B)if(i.indexOf(T.keyPath[B])===-1)return!1;return!0}return!1}).sort(function(T,B){return T.keyPath.length-B.keyPath.length})[0];if(u&&this.db._maxKey!==Ut){var v=u.keyPath.slice(0,i.length);return this.where(v).equals(v.map(function(B){return t[B]}))}!u&&se&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var d=this.schema.idxByName;function p(T,B){return $e(T,B)===0}var x=i.reduce(function(N,B){var z=N[0],$=N[1],N=d[B],D=t[B];return[z||N,z||!N?$t($,N&&N.multi?function(R){return R=te(R,B),c(R)&&R.some(function(U){return p(D,U)})}:function(R){return p(D,te(R,B))}):$]},[null,null]),v=x[0],x=x[1];return v?this.where(v.name).equals(t[v.keyPath]).filter(x):u?this.filter(x):this.where(i).equals("")},We.prototype.filter=function(t){return this.toCollection().and(t)},We.prototype.count=function(t){return this.toCollection().count(t)},We.prototype.offset=function(t){return this.toCollection().offset(t)},We.prototype.limit=function(t){return this.toCollection().limit(t)},We.prototype.each=function(t){return this.toCollection().each(t)},We.prototype.toArray=function(t){return this.toCollection().toArray(t)},We.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},We.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,c(t)?"[".concat(t.join("+"),"]"):t))},We.prototype.reverse=function(){return this.toCollection().reverse()},We.prototype.mapToClass=function(t){var i,u=this.db,d=this.name;function p(){return i!==null&&i.apply(this,arguments)||this}(this.schema.mappedClass=t).prototype instanceof vi&&(function(B,z){if(typeof z!="function"&&z!==null)throw new TypeError("Class extends value "+String(z)+" is not a constructor or null");function $(){this.constructor=B}r(B,z),B.prototype=z===null?Object.create(z):($.prototype=z.prototype,new $)}(p,i=t),Object.defineProperty(p.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),p.prototype.table=function(){return d},t=p);for(var v=new Set,x=t.prototype;x;x=g(x))Object.getOwnPropertyNames(x).forEach(function(B){return v.add(B)});function T(B){if(!B)return B;var z,$=Object.create(t.prototype);for(z in B)if(!v.has(z))try{$[z]=B[z]}catch{}return $}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=T,this.hook("reading",T),t},We.prototype.defineClass=function(){return this.mapToClass(function(t){l(this,t)})},We.prototype.add=function(t,i){var u=this,d=this.schema.primKey,p=d.auto,v=d.keyPath,x=t;return v&&p&&(x=zr(v)(t)),this._trans("readwrite",function(T){return u.core.mutate({trans:T,type:"add",keys:i!=null?[i]:null,values:[x]})}).then(function(T){return T.numFailures?we.reject(T.failures[0]):T.lastResult}).then(function(T){if(v)try{X(t,v,T)}catch{}return T})},We.prototype.update=function(t,i){return typeof t!="object"||c(t)?this.where(":id").equals(t).modify(i):(t=te(t,this.schema.primKey.keyPath),t===void 0?Ye(new me.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(i))},We.prototype.put=function(t,i){var u=this,d=this.schema.primKey,p=d.auto,v=d.keyPath,x=t;return v&&p&&(x=zr(v)(t)),this._trans("readwrite",function(T){return u.core.mutate({trans:T,type:"put",values:[x],keys:i!=null?[i]:null})}).then(function(T){return T.numFailures?we.reject(T.failures[0]):T.lastResult}).then(function(T){if(v)try{X(t,v,T)}catch{}return T})},We.prototype.delete=function(t){var i=this;return this._trans("readwrite",function(u){return i.core.mutate({trans:u,type:"delete",keys:[t]})}).then(function(u){return u.numFailures?we.reject(u.failures[0]):void 0})},We.prototype.clear=function(){var t=this;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"deleteRange",range:yi})}).then(function(i){return i.numFailures?we.reject(i.failures[0]):void 0})},We.prototype.bulkGet=function(t){var i=this;return this._trans("readonly",function(u){return i.core.getMany({keys:t,trans:u}).then(function(d){return d.map(function(p){return i.hook.reading.fire(p)})})})},We.prototype.bulkAdd=function(t,i,u){var d=this,p=Array.isArray(i)?i:void 0,v=(u=u||(p?void 0:i))?u.allKeys:void 0;return this._trans("readwrite",function(x){var z=d.schema.primKey,T=z.auto,z=z.keyPath;if(z&&p)throw new me.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(p&&p.length!==t.length)throw new me.InvalidArgument("Arguments objects and keys must have the same length");var B=t.length,z=z&&T?t.map(zr(z)):t;return d.core.mutate({trans:x,type:"add",keys:p,values:z,wantResults:v}).then(function(U){var N=U.numFailures,D=U.results,R=U.lastResult,U=U.failures;if(N===0)return v?D:R;throw new Ke("".concat(d.name,".bulkAdd(): ").concat(N," of ").concat(B," operations failed"),U)})})},We.prototype.bulkPut=function(t,i,u){var d=this,p=Array.isArray(i)?i:void 0,v=(u=u||(p?void 0:i))?u.allKeys:void 0;return this._trans("readwrite",function(x){var z=d.schema.primKey,T=z.auto,z=z.keyPath;if(z&&p)throw new me.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(p&&p.length!==t.length)throw new me.InvalidArgument("Arguments objects and keys must have the same length");var B=t.length,z=z&&T?t.map(zr(z)):t;return d.core.mutate({trans:x,type:"put",keys:p,values:z,wantResults:v}).then(function(U){var N=U.numFailures,D=U.results,R=U.lastResult,U=U.failures;if(N===0)return v?D:R;throw new Ke("".concat(d.name,".bulkPut(): ").concat(N," of ").concat(B," operations failed"),U)})})},We.prototype.bulkUpdate=function(t){var i=this,u=this.core,d=t.map(function(x){return x.key}),p=t.map(function(x){return x.changes}),v=[];return this._trans("readwrite",function(x){return u.getMany({trans:x,keys:d,cache:"clone"}).then(function(T){var B=[],z=[];t.forEach(function(N,D){var R=N.key,U=N.changes,K=T[D];if(K){for(var F=0,W=Object.keys(U);F<W.length;F++){var V=W[F],H=U[V];if(V===i.schema.primKey.keyPath){if($e(H,R)!==0)throw new me.Constraint("Cannot update primary key in bulkUpdate()")}else X(K,V,H)}v.push(D),B.push(R),z.push(K)}});var $=B.length;return u.mutate({trans:x,type:"put",keys:B,values:z,updates:{keys:d,changeSpecs:p}}).then(function(N){var D=N.numFailures,R=N.failures;if(D===0)return $;for(var U=0,K=Object.keys(R);U<K.length;U++){var F,W=K[U],V=v[Number(W)];V!=null&&(F=R[W],delete R[W],R[V]=F)}throw new Ke("".concat(i.name,".bulkUpdate(): ").concat(D," of ").concat($," operations failed"),R)})})})},We.prototype.bulkDelete=function(t){var i=this,u=t.length;return this._trans("readwrite",function(d){return i.core.mutate({trans:d,type:"delete",keys:t})}).then(function(x){var p=x.numFailures,v=x.lastResult,x=x.failures;if(p===0)return v;throw new Ke("".concat(i.name,".bulkDelete(): ").concat(p," of ").concat(u," operations failed"),x)})},We);function We(){}function cr(t){function i(x,T){if(T){for(var B=arguments.length,z=new Array(B-1);--B;)z[B-1]=arguments[B];return u[x].subscribe.apply(null,z),t}if(typeof x=="string")return u[x]}var u={};i.addEventType=v;for(var d=1,p=arguments.length;d<p;++d)v(arguments[d]);return i;function v(x,T,B){if(typeof x!="object"){var z;T=T||G;var $={subscribers:[],fire:B=B||Re,subscribe:function(N){$.subscribers.indexOf(N)===-1&&($.subscribers.push(N),$.fire=T($.fire,N))},unsubscribe:function(N){$.subscribers=$.subscribers.filter(function(D){return D!==N}),$.fire=$.subscribers.reduce(T,B)}};return u[x]=i[x]=$}f(z=x).forEach(function(N){var D=z[N];if(c(D))v(N,z[N][0],z[N][1]);else{if(D!=="asap")throw new me.InvalidArgument("Invalid event config");var R=v(N,nt,function(){for(var U=arguments.length,K=new Array(U);U--;)K[U]=arguments[U];R.subscribers.forEach(function(F){j(function(){F.apply(null,K)})})})}})}}function lr(t,i){return b(i).from({prototype:t}),i}function rr(t,i){return!(t.filter||t.algorithm||t.or)&&(i?t.justLimit:!t.replayFilter)}function yn(t,i){t.filter=$t(t.filter,i)}function vn(t,i,u){var d=t.replayFilter;t.replayFilter=d?function(){return $t(d(),i())}:i,t.justLimit=u&&!d}function Fr(t,i){if(t.isPrimKey)return i.primaryKey;var u=i.getIndexByKeyPath(t.index);if(!u)throw new me.Schema("KeyPath "+t.index+" on object store "+i.name+" is not indexed");return u}function ki(t,i,u){var d=Fr(t,i.schema);return i.openCursor({trans:u,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:d,range:t.range}})}function jr(t,i,u,d){var p=t.replayFilter?$t(t.filter,t.replayFilter()):t.filter;if(t.or){var v={},x=function(T,B,z){var $,N;p&&!p(B,z,function(D){return B.stop(D)},function(D){return B.fail(D)})||((N=""+($=B.primaryKey))=="[object ArrayBuffer]"&&(N=""+new Uint8Array($)),w(v,N)||(v[N]=!0,i(T,B,z)))};return Promise.all([t.or._iterate(x,u),Ei(ki(t,d,u),t.algorithm,x,!t.keysOnly&&t.valueMapper)])}return Ei(ki(t,d,u),$t(t.algorithm,p),i,!t.keysOnly&&t.valueMapper)}function Ei(t,i,u,d){var p=Ze(d?function(v,x,T){return u(d(v),x,T)}:u);return t.then(function(v){if(v)return v.start(function(){var x=function(){return v.continue()};i&&!i(v,function(T){return x=T},function(T){v.stop(T),x=Re},function(T){v.fail(T),x=Re})||p(v.value,v,function(T){return x=T}),x()})})}var fr=(xi.prototype.execute=function(t){var i=this["@@propmod"];if(i.add!==void 0){var u=i.add;if(c(u))return a(a([],c(t)?t:[],!0),u).sort();if(typeof u=="number")return(Number(t)||0)+u;if(typeof u=="bigint")try{return BigInt(t)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(i.remove!==void 0){var d=i.remove;if(c(d))return c(t)?t.filter(function(p){return!d.includes(p)}).sort():[];if(typeof d=="number")return Number(t)-d;if(typeof d=="bigint")try{return BigInt(t)-d}catch{return BigInt(0)-d}throw new TypeError("Invalid subtrahend ".concat(d))}return u=(u=i.replacePrefix)===null||u===void 0?void 0:u[0],u&&typeof t=="string"&&t.startsWith(u)?i.replacePrefix[1]+t.substring(u.length):t},xi);function xi(t){this["@@propmod"]=t}var js=(Me.prototype._read=function(t,i){var u=this._ctx;return u.error?u.table._trans(null,Ye.bind(null,u.error)):u.table._trans("readonly",t).then(i)},Me.prototype._write=function(t){var i=this._ctx;return i.error?i.table._trans(null,Ye.bind(null,i.error)):i.table._trans("readwrite",t,"locked")},Me.prototype._addAlgorithm=function(t){var i=this._ctx;i.algorithm=$t(i.algorithm,t)},Me.prototype._iterate=function(t,i){return jr(this._ctx,t,i,this._ctx.table.core)},Me.prototype.clone=function(t){var i=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return t&&l(u,t),i._ctx=u,i},Me.prototype.raw=function(){return this._ctx.valueMapper=null,this},Me.prototype.each=function(t){var i=this._ctx;return this._read(function(u){return jr(i,t,u,i.table.core)})},Me.prototype.count=function(t){var i=this;return this._read(function(u){var d=i._ctx,p=d.table.core;if(rr(d,!0))return p.count({trans:u,query:{index:Fr(d,p.schema),range:d.range}}).then(function(x){return Math.min(x,d.limit)});var v=0;return jr(d,function(){return++v,!1},u,p).then(function(){return v})}).then(t)},Me.prototype.sortBy=function(t,i){var u=t.split(".").reverse(),d=u[0],p=u.length-1;function v(B,z){return z?v(B[u[z]],z-1):B[d]}var x=this._ctx.dir==="next"?1:-1;function T(B,z){return $e(v(B,p),v(z,p))*x}return this.toArray(function(B){return B.sort(T)}).then(i)},Me.prototype.toArray=function(t){var i=this;return this._read(function(u){var d=i._ctx;if(d.dir==="next"&&rr(d,!0)&&0<d.limit){var p=d.valueMapper,v=Fr(d,d.table.core.schema);return d.table.core.query({trans:u,limit:d.limit,values:!0,query:{index:v,range:d.range}}).then(function(T){return T=T.result,p?T.map(p):T})}var x=[];return jr(d,function(T){return x.push(T)},u,d.table.core).then(function(){return x})},t)},Me.prototype.offset=function(t){var i=this._ctx;return t<=0||(i.offset+=t,rr(i)?vn(i,function(){var u=t;return function(d,p){return u===0||(u===1?--u:p(function(){d.advance(u),u=0}),!1)}}):vn(i,function(){var u=t;return function(){return--u<0}})),this},Me.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),vn(this._ctx,function(){var i=t;return function(u,d,p){return--i<=0&&d(p),0<=i}},!0),this},Me.prototype.until=function(t,i){return yn(this._ctx,function(u,d,p){return!t(u.value)||(d(p),i)}),this},Me.prototype.first=function(t){return this.limit(1).toArray(function(i){return i[0]}).then(t)},Me.prototype.last=function(t){return this.reverse().first(t)},Me.prototype.filter=function(t){var i;return yn(this._ctx,function(u){return t(u.value)}),(i=this._ctx).isMatch=$t(i.isMatch,t),this},Me.prototype.and=function(t){return this.filter(t)},Me.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},Me.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Me.prototype.desc=function(){return this.reverse()},Me.prototype.eachKey=function(t){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(u,d){t(d.key,d)})},Me.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},Me.prototype.eachPrimaryKey=function(t){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(u,d){t(d.primaryKey,d)})},Me.prototype.keys=function(t){var i=this._ctx;i.keysOnly=!i.isMatch;var u=[];return this.each(function(d,p){u.push(p.key)}).then(function(){return u}).then(t)},Me.prototype.primaryKeys=function(t){var i=this._ctx;if(i.dir==="next"&&rr(i,!0)&&0<i.limit)return this._read(function(d){var p=Fr(i,i.table.core.schema);return i.table.core.query({trans:d,values:!1,limit:i.limit,query:{index:p,range:i.range}})}).then(function(d){return d.result}).then(t);i.keysOnly=!i.isMatch;var u=[];return this.each(function(d,p){u.push(p.primaryKey)}).then(function(){return u}).then(t)},Me.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},Me.prototype.firstKey=function(t){return this.limit(1).keys(function(i){return i[0]}).then(t)},Me.prototype.lastKey=function(t){return this.reverse().firstKey(t)},Me.prototype.distinct=function(){var t=this._ctx,t=t.index&&t.table.schema.idxByName[t.index];if(!t||!t.multi)return this;var i={};return yn(this._ctx,function(p){var d=p.primaryKey.toString(),p=w(i,d);return i[d]=!0,!p}),this},Me.prototype.modify=function(t){var i=this,u=this._ctx;return this._write(function(d){var p,v,x;x=typeof t=="function"?t:(p=f(t),v=p.length,function(F){for(var W=!1,V=0;V<v;++V){var H=p[V],ne=t[H],fe=te(F,H);ne instanceof fr?(X(F,H,ne.execute(fe)),W=!0):fe!==ne&&(X(F,H,ne),W=!0)}return W});var T=u.table.core,N=T.schema.primaryKey,B=N.outbound,z=N.extractKey,$=200,N=i.db._options.modifyChunkSize;N&&($=typeof N=="object"?N[T.name]||N["*"]||200:N);function D(F,H){var V=H.failures,H=H.numFailures;U+=F-H;for(var ne=0,fe=f(V);ne<fe.length;ne++){var be=fe[ne];R.push(V[be])}}var R=[],U=0,K=[];return i.clone().primaryKeys().then(function(F){function W(H){var ne=Math.min($,F.length-H);return T.getMany({trans:d,keys:F.slice(H,H+ne),cache:"immutable"}).then(function(fe){for(var be=[],de=[],ge=B?[]:null,_e=[],ve=0;ve<ne;++ve){var Ie=fe[ve],Be={value:Q(Ie),primKey:F[H+ve]};x.call(Be,Be.value,Be)!==!1&&(Be.value==null?_e.push(F[H+ve]):B||$e(z(Ie),z(Be.value))===0?(de.push(Be.value),B&&ge.push(F[H+ve])):(_e.push(F[H+ve]),be.push(Be.value)))}return Promise.resolve(0<be.length&&T.mutate({trans:d,type:"add",values:be}).then(function(Fe){for(var je in Fe.failures)_e.splice(parseInt(je),1);D(be.length,Fe)})).then(function(){return(0<de.length||V&&typeof t=="object")&&T.mutate({trans:d,type:"put",keys:ge,values:de,criteria:V,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<H}).then(function(Fe){return D(de.length,Fe)})}).then(function(){return(0<_e.length||V&&t===bn)&&T.mutate({trans:d,type:"delete",keys:_e,criteria:V,isAdditionalChunk:0<H}).then(function(Fe){return D(_e.length,Fe)})}).then(function(){return F.length>H+ne&&W(H+$)})})}var V=rr(u)&&u.limit===1/0&&(typeof t!="function"||t===bn)&&{index:u.index,range:u.range};return W(0).then(function(){if(0<R.length)throw new ye("Error modifying one or more objects",R,U,K);return F.length})})})},Me.prototype.delete=function(){var t=this._ctx,i=t.range;return rr(t)&&(t.isPrimKey||i.type===3)?this._write(function(u){var d=t.table.core.schema.primaryKey,p=i;return t.table.core.count({trans:u,query:{index:d,range:p}}).then(function(v){return t.table.core.mutate({trans:u,type:"deleteRange",range:p}).then(function(x){var T=x.failures;if(x.lastResult,x.results,x=x.numFailures,x)throw new ye("Could not delete some values",Object.keys(T).map(function(B){return T[B]}),v-x);return v-x})})}):this.modify(bn)},Me);function Me(){}var bn=function(t,i){return i.value=null};function Us(t,i){return t<i?-1:t===i?0:1}function $s(t,i){return i<t?-1:t===i?0:1}function ht(t,i,u){return t=t instanceof Si?new t.Collection(t):t,t._ctx.error=new(u||TypeError)(i),t}function nr(t){return new t.Collection(t,function(){return Ii("")}).limit(0)}function Ur(t,i,u,d){var p,v,x,T,B,z,$,N=u.length;if(!u.every(function(U){return typeof U=="string"}))return ht(t,mi);function D(U){p=U==="next"?function(F){return F.toUpperCase()}:function(F){return F.toLowerCase()},v=U==="next"?function(F){return F.toLowerCase()}:function(F){return F.toUpperCase()},x=U==="next"?Us:$s;var K=u.map(function(F){return{lower:v(F),upper:p(F)}}).sort(function(F,W){return x(F.lower,W.lower)});T=K.map(function(F){return F.upper}),B=K.map(function(F){return F.lower}),$=(z=U)==="next"?"":d}D("next"),t=new t.Collection(t,function(){return Pt(T[0],B[N-1]+d)}),t._ondirectionchange=function(U){D(U)};var R=0;return t._addAlgorithm(function(U,K,F){var W=U.key;if(typeof W!="string")return!1;var V=v(W);if(i(V,B,R))return!0;for(var H=null,ne=R;ne<N;++ne){var fe=function(be,de,ge,_e,ve,Ie){for(var Be=Math.min(be.length,_e.length),Fe=-1,je=0;je<Be;++je){var pt=de[je];if(pt!==_e[je])return ve(be[je],ge[je])<0?be.substr(0,je)+ge[je]+ge.substr(je+1):ve(be[je],_e[je])<0?be.substr(0,je)+_e[je]+ge.substr(je+1):0<=Fe?be.substr(0,Fe)+de[Fe]+ge.substr(Fe+1):null;ve(be[je],pt)<0&&(Fe=je)}return Be<_e.length&&Ie==="next"?be+ge.substr(be.length):Be<be.length&&Ie==="prev"?be.substr(0,ge.length):Fe<0?null:be.substr(0,Fe)+_e[Fe]+ge.substr(Fe+1)}(W,V,T[ne],B[ne],x,z);fe===null&&H===null?R=ne+1:(H===null||0<x(H,fe))&&(H=fe)}return K(H!==null?function(){U.continue(H+$)}:F),!1}),t}function Pt(t,i,u,d){return{type:2,lower:t,upper:i,lowerOpen:u,upperOpen:d}}function Ii(t){return{type:1,lower:t,upper:t}}var Si=(Object.defineProperty(rt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),rt.prototype.between=function(t,i,u,d){u=u!==!1,d=d===!0;try{return 0<this._cmp(t,i)||this._cmp(t,i)===0&&(u||d)&&(!u||!d)?nr(this):new this.Collection(this,function(){return Pt(t,i,!u,!d)})}catch{return ht(this,Et)}},rt.prototype.equals=function(t){return t==null?ht(this,Et):new this.Collection(this,function(){return Ii(t)})},rt.prototype.above=function(t){return t==null?ht(this,Et):new this.Collection(this,function(){return Pt(t,void 0,!0)})},rt.prototype.aboveOrEqual=function(t){return t==null?ht(this,Et):new this.Collection(this,function(){return Pt(t,void 0,!1)})},rt.prototype.below=function(t){return t==null?ht(this,Et):new this.Collection(this,function(){return Pt(void 0,t,!1,!0)})},rt.prototype.belowOrEqual=function(t){return t==null?ht(this,Et):new this.Collection(this,function(){return Pt(void 0,t)})},rt.prototype.startsWith=function(t){return typeof t!="string"?ht(this,mi):this.between(t,t+Ut,!0,!0)},rt.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):Ur(this,function(i,u){return i.indexOf(u[0])===0},[t],Ut)},rt.prototype.equalsIgnoreCase=function(t){return Ur(this,function(i,u){return i===u[0]},[t],"")},rt.prototype.anyOfIgnoreCase=function(){var t=Ae.apply(ce,arguments);return t.length===0?nr(this):Ur(this,function(i,u){return u.indexOf(i)!==-1},t,"")},rt.prototype.startsWithAnyOfIgnoreCase=function(){var t=Ae.apply(ce,arguments);return t.length===0?nr(this):Ur(this,function(i,u){return u.some(function(d){return i.indexOf(d)===0})},t,Ut)},rt.prototype.anyOf=function(){var t=this,i=Ae.apply(ce,arguments),u=this._cmp;try{i.sort(u)}catch{return ht(this,Et)}if(i.length===0)return nr(this);var d=new this.Collection(this,function(){return Pt(i[0],i[i.length-1])});d._ondirectionchange=function(v){u=v==="next"?t._ascending:t._descending,i.sort(u)};var p=0;return d._addAlgorithm(function(v,x,T){for(var B=v.key;0<u(B,i[p]);)if(++p===i.length)return x(T),!1;return u(B,i[p])===0||(x(function(){v.continue(i[p])}),!1)}),d},rt.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},rt.prototype.noneOf=function(){var t=Ae.apply(ce,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ht(this,Et)}var i=t.reduce(function(u,d){return u?u.concat([[u[u.length-1][1],d]]):[[-1/0,d]]},null);return i.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},rt.prototype.inAnyRange=function(W,i){var u=this,d=this._cmp,p=this._ascending,v=this._descending,x=this._min,T=this._max;if(W.length===0)return nr(this);if(!W.every(function(V){return V[0]!==void 0&&V[1]!==void 0&&p(V[0],V[1])<=0}))return ht(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",me.InvalidArgument);var B=!i||i.includeLowers!==!1,z=i&&i.includeUppers===!0,$,N=p;function D(V,H){return N(V[0],H[0])}try{($=W.reduce(function(V,H){for(var ne=0,fe=V.length;ne<fe;++ne){var be=V[ne];if(d(H[0],be[1])<0&&0<d(H[1],be[0])){be[0]=x(be[0],H[0]),be[1]=T(be[1],H[1]);break}}return ne===fe&&V.push(H),V},[])).sort(D)}catch{return ht(this,Et)}var R=0,U=z?function(V){return 0<p(V,$[R][1])}:function(V){return 0<=p(V,$[R][1])},K=B?function(V){return 0<v(V,$[R][0])}:function(V){return 0<=v(V,$[R][0])},F=U,W=new this.Collection(this,function(){return Pt($[0][0],$[$.length-1][1],!B,!z)});return W._ondirectionchange=function(V){N=V==="next"?(F=U,p):(F=K,v),$.sort(D)},W._addAlgorithm(function(V,H,ne){for(var fe,be=V.key;F(be);)if(++R===$.length)return H(ne),!1;return!U(fe=be)&&!K(fe)||(u._cmp(be,$[R][1])===0||u._cmp(be,$[R][0])===0||H(function(){N===p?V.continue($[R][0]):V.continue($[R][1])}),!1)}),W},rt.prototype.startsWithAnyOf=function(){var t=Ae.apply(ce,arguments);return t.every(function(i){return typeof i=="string"})?t.length===0?nr(this):this.inAnyRange(t.map(function(i){return[i,i+Ut]})):ht(this,"startsWithAnyOf() only works with strings")},rt);function rt(){}function bt(t){return Ze(function(i){return dr(i),t(i.target.error),!1})}function dr(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var hr="storagemutated",_n="x-storagemutated-1",Lt=cr(null,hr),Gs=(_t.prototype._lock=function(){return M(!xe.global),++this._reculock,this._reculock!==1||xe.global||(xe.lockOwnerFor=this),this},_t.prototype._unlock=function(){if(M(!xe.global),--this._reculock==0)for(xe.global||(xe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{jt(t[1],t[0])}catch{}}return this},_t.prototype._locked=function(){return this._reculock&&xe.lockOwnerFor!==this},_t.prototype.create=function(t){var i=this;if(!this.mode)return this;var u=this.db.idbdb,d=this.db._state.dbOpenError;if(M(!this.idbtrans),!t&&!u)switch(d&&d.name){case"DatabaseClosedError":throw new me.DatabaseClosed(d);case"MissingAPIError":throw new me.MissingAPI(d.message,d);default:throw new me.OpenFailed(d)}if(!this.active)throw new me.TransactionInactive;return M(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ze(function(p){dr(p),i._reject(t.error)}),t.onabort=Ze(function(p){dr(p),i.active&&i._reject(new me.Abort(t.error)),i.active=!1,i.on("abort").fire(p)}),t.oncomplete=Ze(function(){i.active=!1,i._resolve(),"mutatedParts"in t&&Lt.storagemutated.fire(t.mutatedParts)}),this},_t.prototype._promise=function(t,i,u){var d=this;if(t==="readwrite"&&this.mode!=="readwrite")return Ye(new me.ReadOnly("Transaction is readonly"));if(!this.active)return Ye(new me.TransactionInactive);if(this._locked())return new we(function(v,x){d._blockedFuncs.push([function(){d._promise(t,i,u).then(v,x)},xe])});if(u)return At(function(){var v=new we(function(x,T){d._lock();var B=i(x,T,d);B&&B.then&&B.then(x,T)});return v.finally(function(){return d._unlock()}),v._lib=!0,v});var p=new we(function(v,x){var T=i(v,x,d);T&&T.then&&T.then(v,x)});return p._lib=!0,p},_t.prototype._root=function(){return this.parent?this.parent._root():this},_t.prototype.waitFor=function(t){var i,u=this._root(),d=we.resolve(t);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return d}):(u._waitingFor=d,u._waitingQueue=[],i=u.idbtrans.objectStore(u.storeNames[0]),function v(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(i.get(-1/0).onsuccess=v)}());var p=u._waitingFor;return new we(function(v,x){d.then(function(T){return u._waitingQueue.push(Ze(v.bind(null,T)))},function(T){return u._waitingQueue.push(Ze(x.bind(null,T)))}).finally(function(){u._waitingFor===p&&(u._waitingFor=null)})})},_t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new me.Abort))},_t.prototype.table=function(t){var i=this._memoizedTables||(this._memoizedTables={});if(w(i,t))return i[t];var u=this.schema[t];if(!u)throw new me.NotFound("Table "+t+" not part of transaction");return u=new this.db.Table(t,u,this),u.core=this.db.core.table(t),i[t]=u},_t);function _t(){}function wn(t,i,u,d,p,v,x){return{name:t,keyPath:i,unique:u,multi:d,auto:p,compound:v,src:(u&&!x?"&":"")+(d?"*":"")+(p?"++":"")+Ci(i)}}function Ci(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function kn(t,i,u){return{name:t,primKey:i,indexes:u,mappedClass:null,idxByName:(d=function(p){return[p.name,p]},u.reduce(function(p,v,x){return x=d(v,x),x&&(p[x[0]]=x[1]),p},{}))};var d}var pr=function(t){try{return t.only([[]]),pr=function(){return[[]]},[[]]}catch{return pr=function(){return Ut},Ut}};function En(t){return t==null?function(){}:typeof t=="string"?(i=t).split(".").length===1?function(u){return u[i]}:function(u){return te(u,i)}:function(u){return te(u,t)};var i}function Oi(t){return[].slice.call(t)}var Ms=0;function gr(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function Ks(t,i,B){function d(F){if(F.type===3)return null;if(F.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var R=F.lower,U=F.upper,K=F.lowerOpen,F=F.upperOpen;return R===void 0?U===void 0?null:i.upperBound(U,!!F):U===void 0?i.lowerBound(R,!!K):i.bound(R,U,!!K,!!F)}function p(D){var R,U=D.name;return{name:U,schema:D,mutate:function(K){var F=K.trans,W=K.type,V=K.keys,H=K.values,ne=K.range;return new Promise(function(fe,be){fe=Ze(fe);var de=F.objectStore(U),ge=de.keyPath==null,_e=W==="put"||W==="add";if(!_e&&W!=="delete"&&W!=="deleteRange")throw new Error("Invalid operation type: "+W);var ve,Ie=(V||H||{length:1}).length;if(V&&H&&V.length!==H.length)throw new Error("Given keys array must have same length as given values array.");if(Ie===0)return fe({numFailures:0,failures:{},results:[],lastResult:void 0});function Be(ct){++pt,dr(ct)}var Fe=[],je=[],pt=0;if(W==="deleteRange"){if(ne.type===4)return fe({numFailures:pt,failures:je,results:[],lastResult:void 0});ne.type===3?Fe.push(ve=de.clear()):Fe.push(ve=de.delete(d(ne)))}else{var ge=_e?ge?[H,V]:[H,null]:[V,null],Le=ge[0],ot=ge[1];if(_e)for(var at=0;at<Ie;++at)Fe.push(ve=ot&&ot[at]!==void 0?de[W](Le[at],ot[at]):de[W](Le[at])),ve.onerror=Be;else for(at=0;at<Ie;++at)Fe.push(ve=de[W](Le[at])),ve.onerror=Be}function Jr(ct){ct=ct.target.result,Fe.forEach(function(Kt,Gn){return Kt.error!=null&&(je[Gn]=Kt.error)}),fe({numFailures:pt,failures:je,results:W==="delete"?V:Fe.map(function(Kt){return Kt.result}),lastResult:ct})}ve.onerror=function(ct){Be(ct),Jr(ct)},ve.onsuccess=Jr})},getMany:function(K){var F=K.trans,W=K.keys;return new Promise(function(V,H){V=Ze(V);for(var ne,fe=F.objectStore(U),be=W.length,de=new Array(be),ge=0,_e=0,ve=function(Fe){Fe=Fe.target,de[Fe._pos]=Fe.result,++_e===ge&&V(de)},Ie=bt(H),Be=0;Be<be;++Be)W[Be]!=null&&((ne=fe.get(W[Be]))._pos=Be,ne.onsuccess=ve,ne.onerror=Ie,++ge);ge===0&&V(de)})},get:function(K){var F=K.trans,W=K.key;return new Promise(function(V,H){V=Ze(V);var ne=F.objectStore(U).get(W);ne.onsuccess=function(fe){return V(fe.target.result)},ne.onerror=bt(H)})},query:(R=z,function(K){return new Promise(function(F,W){F=Ze(F);var V,H,ne,ge=K.trans,fe=K.values,be=K.limit,ve=K.query,de=be===1/0?void 0:be,_e=ve.index,ve=ve.range,ge=ge.objectStore(U),_e=_e.isPrimaryKey?ge:ge.index(_e.name),ve=d(ve);if(be===0)return F({result:[]});R?((de=fe?_e.getAll(ve,de):_e.getAllKeys(ve,de)).onsuccess=function(Ie){return F({result:Ie.target.result})},de.onerror=bt(W)):(V=0,H=!fe&&"openKeyCursor"in _e?_e.openKeyCursor(ve):_e.openCursor(ve),ne=[],H.onsuccess=function(Ie){var Be=H.result;return Be?(ne.push(fe?Be.value:Be.primaryKey),++V===be?F({result:ne}):void Be.continue()):F({result:ne})},H.onerror=bt(W))})}),openCursor:function(K){var F=K.trans,W=K.values,V=K.query,H=K.reverse,ne=K.unique;return new Promise(function(fe,be){fe=Ze(fe);var _e=V.index,de=V.range,ge=F.objectStore(U),ge=_e.isPrimaryKey?ge:ge.index(_e.name),_e=H?ne?"prevunique":"prev":ne?"nextunique":"next",ve=!W&&"openKeyCursor"in ge?ge.openKeyCursor(d(de),_e):ge.openCursor(d(de),_e);ve.onerror=bt(be),ve.onsuccess=Ze(function(Ie){var Be,Fe,je,pt,Le=ve.result;Le?(Le.___id=++Ms,Le.done=!1,Be=Le.continue.bind(Le),Fe=(Fe=Le.continuePrimaryKey)&&Fe.bind(Le),je=Le.advance.bind(Le),pt=function(){throw new Error("Cursor not stopped")},Le.trans=F,Le.stop=Le.continue=Le.continuePrimaryKey=Le.advance=function(){throw new Error("Cursor not started")},Le.fail=Ze(be),Le.next=function(){var ot=this,at=1;return this.start(function(){return at--?ot.continue():ot.stop()}).then(function(){return ot})},Le.start=function(ot){function at(){if(ve.result)try{ot()}catch(ct){Le.fail(ct)}else Le.done=!0,Le.start=function(){throw new Error("Cursor behind last entry")},Le.stop()}var Jr=new Promise(function(ct,Kt){ct=Ze(ct),ve.onerror=bt(Kt),Le.fail=Kt,Le.stop=function(Gn){Le.stop=Le.continue=Le.continuePrimaryKey=Le.advance=pt,ct(Gn)}});return ve.onsuccess=Ze(function(ct){ve.onsuccess=at,at()}),Le.continue=Be,Le.continuePrimaryKey=Fe,Le.advance=je,at(),Jr},fe(Le)):fe(null)},be)})},count:function(K){var F=K.query,W=K.trans,V=F.index,H=F.range;return new Promise(function(ne,fe){var be=W.objectStore(U),de=V.isPrimaryKey?be:be.index(V.name),be=d(H),de=be?de.count(be):de.count();de.onsuccess=Ze(function(ge){return ne(ge.target.result)}),de.onerror=bt(fe)})}}}var v,x,T,$=(x=B,T=Oi((v=t).objectStoreNames),{schema:{name:v.name,tables:T.map(function(D){return x.objectStore(D)}).map(function(D){var R=D.keyPath,F=D.autoIncrement,U=c(R),K={},F={name:D.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:R==null,compound:U,keyPath:R,autoIncrement:F,unique:!0,extractKey:En(R)},indexes:Oi(D.indexNames).map(function(W){return D.index(W)}).map(function(ne){var V=ne.name,H=ne.unique,fe=ne.multiEntry,ne=ne.keyPath,fe={name:V,compound:c(ne),keyPath:ne,unique:H,multiEntry:fe,extractKey:En(ne)};return K[gr(ne)]=fe}),getIndexByKeyPath:function(W){return K[gr(W)]}};return K[":id"]=F.primaryKey,R!=null&&(K[gr(R)]=F.primaryKey),F})},hasGetAll:0<T.length&&"getAll"in x.objectStore(T[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),B=$.schema,z=$.hasGetAll,$=B.tables.map(p),N={};return $.forEach(function(D){return N[D.name]=D}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(D){if(!N[D])throw new Error("Table '".concat(D,"' not found"));return N[D]},MIN_KEY:-1/0,MAX_KEY:pr(i),schema:B}}function Ds(t,i,u,d){var p=u.IDBKeyRange;return u.indexedDB,{dbcore:(d=Ks(i,p,d),t.dbcore.reduce(function(v,x){return x=x.create,s(s({},v),x(v))},d))}}function $r(t,d){var u=d.db,d=Ds(t._middlewares,u,t._deps,d);t.core=d.dbcore,t.tables.forEach(function(p){var v=p.name;t.core.schema.tables.some(function(x){return x.name===v})&&(p.core=t.core.table(v),t[v]instanceof t.Table&&(t[v].core=p.core))})}function Gr(t,i,u,d){u.forEach(function(p){var v=d[p];i.forEach(function(x){var T=function B(z,$){return E(z,$)||(z=g(z))&&B(z,$)}(x,p);(!T||"value"in T&&T.value===void 0)&&(x===t.Transaction.prototype||x instanceof t.Transaction?S(x,p,{get:function(){return this.table(p)},set:function(B){y(this,p,{value:B,writable:!0,configurable:!0,enumerable:!0})}}):x[p]=new t.Table(p,v))})})}function xn(t,i){i.forEach(function(u){for(var d in u)u[d]instanceof t.Table&&delete u[d]})}function qs(t,i){return t._cfg.version-i._cfg.version}function Ws(t,i,u,d){var p=t._dbSchema;u.objectStoreNames.contains("$meta")&&!p.$meta&&(p.$meta=kn("$meta",Ti("")[0],[]),t._storeNames.push("$meta"));var v=t._createTransaction("readwrite",t._storeNames,p);v.create(u),v._completion.catch(d);var x=v._reject.bind(v),T=xe.transless||xe;At(function(){return xe.trans=v,xe.transless=T,i!==0?($r(t,u),z=i,((B=v).storeNames.includes("$meta")?B.table("$meta").get("version").then(function($){return $??z}):we.resolve(z)).then(function($){return D=$,R=v,U=u,K=[],$=(N=t)._versions,F=N._dbSchema=Kr(0,N.idbdb,U),($=$.filter(function(W){return W._cfg.version>=D})).length!==0?($.forEach(function(W){K.push(function(){var V=F,H=W._cfg.dbschema;Dr(N,V,U),Dr(N,H,U),F=N._dbSchema=H;var ne=In(V,H);ne.add.forEach(function(_e){Sn(U,_e[0],_e[1].primKey,_e[1].indexes)}),ne.change.forEach(function(_e){if(_e.recreate)throw new me.Upgrade("Not yet support for changing primary key");var ve=U.objectStore(_e.name);_e.add.forEach(function(Ie){return Mr(ve,Ie)}),_e.change.forEach(function(Ie){ve.deleteIndex(Ie.name),Mr(ve,Ie)}),_e.del.forEach(function(Ie){return ve.deleteIndex(Ie)})});var fe=W._cfg.contentUpgrade;if(fe&&W._cfg.version>D){$r(N,U),R._memoizedTables={};var be=ue(H);ne.del.forEach(function(_e){be[_e]=V[_e]}),xn(N,[N.Transaction.prototype]),Gr(N,[N.Transaction.prototype],f(be),be),R.schema=be;var de,ge=Y(fe);return ge&&er(),ne=we.follow(function(){var _e;(de=fe(R))&&ge&&(_e=Tt.bind(null,null),de.then(_e,_e))}),de&&typeof de.then=="function"?we.resolve(de):ne.then(function(){return de})}}),K.push(function(V){var H,ne,fe=W._cfg.dbschema;H=fe,ne=V,[].slice.call(ne.db.objectStoreNames).forEach(function(be){return H[be]==null&&ne.db.deleteObjectStore(be)}),xn(N,[N.Transaction.prototype]),Gr(N,[N.Transaction.prototype],N._storeNames,N._dbSchema),R.schema=N._dbSchema}),K.push(function(V){N.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(N.idbdb.version/10)===W._cfg.version?(N.idbdb.deleteObjectStore("$meta"),delete N._dbSchema.$meta,N._storeNames=N._storeNames.filter(function(H){return H!=="$meta"})):V.objectStore("$meta").put(W._cfg.version,"version"))})}),function W(){return K.length?we.resolve(K.shift()(R.idbtrans)).then(W):we.resolve()}().then(function(){Ai(F,U)})):we.resolve();var N,D,R,U,K,F}).catch(x)):(f(p).forEach(function($){Sn(u,$,p[$].primKey,p[$].indexes)}),$r(t,u),void we.follow(function(){return t.on.populate.fire(v)}).catch(x));var B,z})}function Zs(t,i){Ai(t._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var u=Kr(0,t.idbdb,i);Dr(t,t._dbSchema,i);for(var d=0,p=In(u,t._dbSchema).change;d<p.length;d++){var v=function(x){if(x.change.length||x.recreate)return console.warn("Unable to patch indexes of table ".concat(x.name," because it has changes on the type of index or primary key.")),{value:void 0};var T=i.objectStore(x.name);x.add.forEach(function(B){se&&console.debug("Dexie upgrade patch: Creating missing index ".concat(x.name,".").concat(B.src)),Mr(T,B)})}(p[d]);if(typeof v=="object")return v.value}}function In(t,i){var u,d={del:[],add:[],change:[]};for(u in t)i[u]||d.del.push(u);for(u in i){var p=t[u],v=i[u];if(p){var x={name:u,def:v,recreate:!1,del:[],add:[],change:[]};if(""+(p.primKey.keyPath||"")!=""+(v.primKey.keyPath||"")||p.primKey.auto!==v.primKey.auto)x.recreate=!0,d.change.push(x);else{var T=p.idxByName,B=v.idxByName,z=void 0;for(z in T)B[z]||x.del.push(z);for(z in B){var $=T[z],N=B[z];$?$.src!==N.src&&x.change.push(N):x.add.push(N)}(0<x.del.length||0<x.add.length||0<x.change.length)&&d.change.push(x)}}else d.add.push([u,v])}return d}function Sn(t,i,u,d){var p=t.db.createObjectStore(i,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return d.forEach(function(v){return Mr(p,v)}),p}function Ai(t,i){f(t).forEach(function(u){i.db.objectStoreNames.contains(u)||(se&&console.debug("Dexie: Creating missing table",u),Sn(i,u,t[u].primKey,t[u].indexes))})}function Mr(t,i){t.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function Kr(t,i,u){var d={};return A(i.objectStoreNames,0).forEach(function(p){for(var v=u.objectStore(p),x=wn(Ci(z=v.keyPath),z||"",!0,!1,!!v.autoIncrement,z&&typeof z!="string",!0),T=[],B=0;B<v.indexNames.length;++B){var $=v.index(v.indexNames[B]),z=$.keyPath,$=wn($.name,z,!!$.unique,!!$.multiEntry,!1,z&&typeof z!="string",!1);T.push($)}d[p]=kn(p,x,T)}),d}function Dr(t,i,u){for(var d=u.db.objectStoreNames,p=0;p<d.length;++p){var v=d[p],x=u.objectStore(v);t._hasGetAll="getAll"in x;for(var T=0;T<x.indexNames.length;++T){var B=x.indexNames[T],z=x.index(B).keyPath,$=typeof z=="string"?z:"["+A(z).join("+")+"]";!i[v]||(z=i[v].idxByName[$])&&(z.name=B,delete i[v].idxByName[$],i[v].idxByName[B]=z)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Ti(t){return t.split(",").map(function(i,u){var d=(i=i.trim()).replace(/([&*]|\+\+)/g,""),p=/^\[/.test(d)?d.match(/^\[(.*)\]$/)[1].split("+"):d;return wn(d,p||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),c(p),u===0)})}var Vs=(qr.prototype._parseStoresSpec=function(t,i){f(t).forEach(function(u){if(t[u]!==null){var d=Ti(t[u]),p=d.shift();if(p.unique=!0,p.multi)throw new me.Schema("Primary key cannot be multi-valued");d.forEach(function(v){if(v.auto)throw new me.Schema("Only primary key can be marked as autoIncrement (++)");if(!v.keyPath)throw new me.Schema("Index must have a name and cannot be an empty string")}),i[u]=kn(u,p,d)}})},qr.prototype.stores=function(u){var i=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,u):u;var u=i._versions,d={},p={};return u.forEach(function(v){l(d,v._cfg.storesSource),p=v._cfg.dbschema={},v._parseStoresSpec(d,p)}),i._dbSchema=p,xn(i,[i._allTables,i,i.Transaction.prototype]),Gr(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],f(p),p),i._storeNames=f(p),this},qr.prototype.upgrade=function(t){return this._cfg.contentUpgrade=oe(this._cfg.contentUpgrade||Re,t),this},qr);function qr(){}function Cn(t,i){var u=t._dbNamesDB;return u||(u=t._dbNamesDB=new xt(Rr,{addons:[],indexedDB:t,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function On(t){return t&&typeof t.databases=="function"}function An(t){return At(function(){return xe.letThrough=!0,t()})}function Tn(t){return!("from"in t)}var st=function(t,i){if(!this){var u=new st;return t&&"d"in t&&l(u,t),u}l(this,arguments.length?{d:1,from:t,to:1<arguments.length?i:t}:{d:0})};function mr(t,i,u){var d=$e(i,u);if(!isNaN(d)){if(0<d)throw RangeError();if(Tn(t))return l(t,{from:i,to:u,d:1});var p=t.l,d=t.r;if($e(u,t.from)<0)return p?mr(p,i,u):t.l={from:i,to:u,d:1,l:null,r:null},Pi(t);if(0<$e(i,t.to))return d?mr(d,i,u):t.r={from:i,to:u,d:1,l:null,r:null},Pi(t);$e(i,t.from)<0&&(t.from=i,t.l=null,t.d=d?d.d+1:1),0<$e(u,t.to)&&(t.to=u,t.r=null,t.d=t.l?t.l.d+1:1),u=!t.r,p&&!t.l&&yr(t,p),d&&u&&yr(t,d)}}function yr(t,i){Tn(i)||function u(d,B){var v=B.from,x=B.to,T=B.l,B=B.r;mr(d,v,x),T&&u(d,T),B&&u(d,B)}(t,i)}function Ni(t,i){var u=Wr(i),d=u.next();if(d.done)return!1;for(var p=d.value,v=Wr(t),x=v.next(p.from),T=x.value;!d.done&&!x.done;){if($e(T.from,p.to)<=0&&0<=$e(T.to,p.from))return!0;$e(p.from,T.from)<0?p=(d=u.next(T.from)).value:T=(x=v.next(p.from)).value}return!1}function Wr(t){var i=Tn(t)?null:{s:0,n:t};return{next:function(u){for(var d=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,d)for(;i.n.l&&$e(u,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!d||$e(u,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Pi(t){var i,u,d=(((i=t.r)===null||i===void 0?void 0:i.d)||0)-(((u=t.l)===null||u===void 0?void 0:u.d)||0),p=1<d?"r":d<-1?"l":"";p&&(i=p=="r"?"l":"r",u=s({},t),d=t[p],t.from=d.from,t.to=d.to,t[p]=d[p],u[p]=d[i],(t[i]=u).d=Li(u)),t.d=Li(t)}function Li(u){var i=u.r,u=u.l;return(i?u?Math.max(i.d,u.d):i.d:u?u.d:0)+1}function Zr(t,i){return f(i).forEach(function(u){t[u]?yr(t[u],i[u]):t[u]=function d(p){var v,x,T={};for(v in p)w(p,v)&&(x=p[v],T[v]=!x||typeof x!="object"||Ce.has(x.constructor)?x:d(x));return T}(i[u])}),t}function Nn(t,i){return t.all||i.all||Object.keys(t).some(function(u){return i[u]&&Ni(i[u],t[u])})}C(st.prototype,((mt={add:function(t){return yr(this,t),this},addKey:function(t){return mr(this,t,t),this},addKeys:function(t){var i=this;return t.forEach(function(u){return mr(i,u,u)}),this},hasKey:function(t){var i=Wr(this).next(t).value;return i&&$e(i.from,t)<=0&&0<=$e(i.to,t)}})[Te]=function(){return Wr(this)},mt));var Gt={},Pn={},Ln=!1;function Vr(t){Zr(Pn,t),Ln||(Ln=!0,setTimeout(function(){Ln=!1,Bn(Pn,!(Pn={}))},0))}function Bn(t,i){i===void 0&&(i=!1);var u=new Set;if(t.all)for(var d=0,p=Object.values(Gt);d<p.length;d++)Bi(x=p[d],t,u,i);else for(var v in t){var x,T=/^idb\:\/\/(.*)\/(.*)\//.exec(v);T&&(v=T[1],T=T[2],(x=Gt["idb://".concat(v,"/").concat(T)])&&Bi(x,t,u,i))}u.forEach(function(B){return B()})}function Bi(t,i,u,d){for(var p=[],v=0,x=Object.entries(t.queries.query);v<x.length;v++){for(var T=x[v],B=T[0],z=[],$=0,N=T[1];$<N.length;$++){var D=N[$];Nn(i,D.obsSet)?D.subscribers.forEach(function(F){return u.add(F)}):d&&z.push(D)}d&&p.push([B,z])}if(d)for(var R=0,U=p;R<U.length;R++){var K=U[R],B=K[0],z=K[1];t.queries.query[B]=z}}function Hs(t){var i=t._state,u=t._deps.indexedDB;if(i.isBeingOpened||t.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Ye(i.dbOpenError):t});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var d=i.openCanceller,p=Math.round(10*t.verno),v=!1;function x(){if(i.openCanceller!==d)throw new me.DatabaseClosed("db.open() was cancelled")}function T(){return new we(function(D,R){if(x(),!u)throw new me.MissingAPI;var U=t.name,K=i.autoSchema||!p?u.open(U):u.open(U,p);if(!K)throw new me.MissingAPI;K.onerror=bt(R),K.onblocked=Ze(t._fireOnBlocked),K.onupgradeneeded=Ze(function(F){var W;$=K.transaction,i.autoSchema&&!t._options.allowEmptyDB?(K.onerror=dr,$.abort(),K.result.close(),(W=u.deleteDatabase(U)).onsuccess=W.onerror=Ze(function(){R(new me.NoSuchDatabase("Database ".concat(U," doesnt exist")))})):($.onerror=bt(R),F=F.oldVersion>Math.pow(2,62)?0:F.oldVersion,N=F<1,t.idbdb=K.result,v&&Zs(t,$),Ws(t,F/10,$,R))},R),K.onsuccess=Ze(function(){$=null;var F,W,V,H,ne,fe=t.idbdb=K.result,be=A(fe.objectStoreNames);if(0<be.length)try{var de=fe.transaction((H=be).length===1?H[0]:H,"readonly");if(i.autoSchema)W=fe,V=de,(F=t).verno=W.version/10,V=F._dbSchema=Kr(0,W,V),F._storeNames=A(W.objectStoreNames,0),Gr(F,[F._allTables],f(V),V);else if(Dr(t,t._dbSchema,de),((ne=In(Kr(0,(ne=t).idbdb,de),ne._dbSchema)).add.length||ne.change.some(function(ge){return ge.add.length||ge.change.length}))&&!v)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),fe.close(),p=fe.version+1,v=!0,D(T());$r(t,de)}catch{}tr.push(t),fe.onversionchange=Ze(function(ge){i.vcFired=!0,t.on("versionchange").fire(ge)}),fe.onclose=Ze(function(ge){t.on("close").fire(ge)}),N&&(ne=t._deps,de=U,fe=ne.indexedDB,ne=ne.IDBKeyRange,On(fe)||de===Rr||Cn(fe,ne).put({name:de}).catch(Re)),D()},R)}).catch(function(D){switch(D?.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),T();break;case"VersionError":if(0<p)return p=0,T()}return we.reject(D)})}var B,z=i.dbReadyResolve,$=null,N=!1;return we.race([d,(typeof navigator>"u"?we.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(D){function R(){return indexedDB.databases().finally(D)}B=setInterval(R,100),R()}).finally(function(){return clearInterval(B)}):Promise.resolve()).then(T)]).then(function(){return x(),i.onReadyBeingFired=[],we.resolve(An(function(){return t.on.ready.fire(t.vip)})).then(function D(){if(0<i.onReadyBeingFired.length){var R=i.onReadyBeingFired.reduce(oe,Re);return i.onReadyBeingFired=[],we.resolve(An(function(){return R(t.vip)})).then(D)}})}).finally(function(){i.openCanceller===d&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(D){i.dbOpenError=D;try{$&&$.abort()}catch{}return d===i.openCanceller&&t._close(),Ye(D)}).finally(function(){i.openComplete=!0,z()}).then(function(){var D;return N&&(D={},t.tables.forEach(function(R){R.schema.indexes.forEach(function(U){U.name&&(D["idb://".concat(t.name,"/").concat(R.name,"/").concat(U.name)]=new st(-1/0,[[[]]]))}),D["idb://".concat(t.name,"/").concat(R.name,"/")]=D["idb://".concat(t.name,"/").concat(R.name,"/:dels")]=new st(-1/0,[[[]]])}),Lt(hr).fire(D),Bn(D,!0)),t})}function Rn(t){function i(v){return t.next(v)}var u=p(i),d=p(function(v){return t.throw(v)});function p(v){return function(B){var T=v(B),B=T.value;return T.done?B:B&&typeof B.then=="function"?B.then(u,d):c(B)?Promise.all(B).then(u,d):u(B)}}return p(i)()}function Hr(t,i,u){for(var d=c(t)?t.slice():[t],p=0;p<u;++p)d.push(i);return d}var Ys={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return s(s({},t),{table:function(i){var u=t.table(i),d=u.schema,p={},v=[];function x(N,D,R){var U=gr(N),K=p[U]=p[U]||[],F=N==null?0:typeof N=="string"?1:N.length,W=0<D,W=s(s({},R),{name:W?"".concat(U,"(virtual-from:").concat(R.name,")"):R.name,lowLevelIndex:R,isVirtual:W,keyTail:D,keyLength:F,extractKey:En(N),unique:!W&&R.unique});return K.push(W),W.isPrimaryKey||v.push(W),1<F&&x(F===2?N[0]:N.slice(0,F-1),D+1,R),K.sort(function(V,H){return V.keyTail-H.keyTail}),W}i=x(d.primaryKey.keyPath,0,d.primaryKey),p[":id"]=[i];for(var T=0,B=d.indexes;T<B.length;T++){var z=B[T];x(z.keyPath,0,z)}function $(N){var D,R=N.query.index;return R.isVirtual?s(s({},N),{query:{index:R.lowLevelIndex,range:(D=N.query.range,R=R.keyTail,{type:D.type===1?2:D.type,lower:Hr(D.lower,D.lowerOpen?t.MAX_KEY:t.MIN_KEY,R),lowerOpen:!0,upper:Hr(D.upper,D.upperOpen?t.MIN_KEY:t.MAX_KEY,R),upperOpen:!0})}}):N}return s(s({},u),{schema:s(s({},d),{primaryKey:i,indexes:v,getIndexByKeyPath:function(N){return(N=p[gr(N)])&&N[0]}}),count:function(N){return u.count($(N))},query:function(N){return u.query($(N))},openCursor:function(N){var D=N.query.index,R=D.keyTail,U=D.isVirtual,K=D.keyLength;return U?u.openCursor($(N)).then(function(W){return W&&F(W)}):u.openCursor(N);function F(W){return Object.create(W,{continue:{value:function(V){V!=null?W.continue(Hr(V,N.reverse?t.MAX_KEY:t.MIN_KEY,R)):N.unique?W.continue(W.key.slice(0,K).concat(N.reverse?t.MIN_KEY:t.MAX_KEY,R)):W.continue()}},continuePrimaryKey:{value:function(V,H){W.continuePrimaryKey(Hr(V,t.MAX_KEY,R),H)}},primaryKey:{get:function(){return W.primaryKey}},key:{get:function(){var V=W.key;return K===1?V[0]:V.slice(0,K)}},value:{get:function(){return W.value}}})}}})}})}};function zn(t,i,u,d){return u=u||{},d=d||"",f(t).forEach(function(p){var v,x,T;w(i,p)?(v=t[p],x=i[p],typeof v=="object"&&typeof x=="object"&&v&&x?(T=ie(v))!==ie(x)?u[d+p]=i[p]:T==="Object"?zn(v,x,u,d+p+"."):v!==x&&(u[d+p]=i[p]):v!==x&&(u[d+p]=i[p])):u[d+p]=void 0}),f(i).forEach(function(p){w(t,p)||(u[d+p]=i[p])}),u}function Fn(t,i){return i.type==="delete"?i.keys:i.keys||i.values.map(t.extractKey)}var Xs={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return s(s({},t),{table:function(i){var u=t.table(i),d=u.schema.primaryKey;return s(s({},u),{mutate:function(p){var v=xe.trans,x=v.table(i).hook,T=x.deleting,B=x.creating,z=x.updating;switch(p.type){case"add":if(B.fire===Re)break;return v._promise("readwrite",function(){return $(p)},!0);case"put":if(B.fire===Re&&z.fire===Re)break;return v._promise("readwrite",function(){return $(p)},!0);case"delete":if(T.fire===Re)break;return v._promise("readwrite",function(){return $(p)},!0);case"deleteRange":if(T.fire===Re)break;return v._promise("readwrite",function(){return function N(D,R,U){return u.query({trans:D,values:!1,query:{index:d,range:R},limit:U}).then(function(K){var F=K.result;return $({type:"delete",keys:F,trans:D}).then(function(W){return 0<W.numFailures?Promise.reject(W.failures[0]):F.length<U?{failures:[],numFailures:0,lastResult:void 0}:N(D,s(s({},R),{lower:F[F.length-1],lowerOpen:!0}),U)})})}(p.trans,p.range,1e4)},!0)}return u.mutate(p);function $(N){var D,R,U,K=xe.trans,F=N.keys||Fn(d,N);if(!F)throw new Error("Keys missing");return(N=N.type==="add"||N.type==="put"?s(s({},N),{keys:F}):s({},N)).type!=="delete"&&(N.values=a([],N.values)),N.keys&&(N.keys=a([],N.keys)),D=u,U=F,((R=N).type==="add"?Promise.resolve([]):D.getMany({trans:R.trans,keys:U,cache:"immutable"})).then(function(W){var V=F.map(function(H,ne){var fe,be,de,ge=W[ne],_e={onerror:null,onsuccess:null};return N.type==="delete"?T.fire.call(_e,H,ge,K):N.type==="add"||ge===void 0?(fe=B.fire.call(_e,H,N.values[ne],K),H==null&&fe!=null&&(N.keys[ne]=H=fe,d.outbound||X(N.values[ne],d.keyPath,H))):(fe=zn(ge,N.values[ne]),(be=z.fire.call(_e,fe,H,ge,K))&&(de=N.values[ne],Object.keys(be).forEach(function(ve){w(de,ve)?de[ve]=be[ve]:X(de,ve,be[ve])}))),_e});return u.mutate(N).then(function(H){for(var ne=H.failures,fe=H.results,be=H.numFailures,H=H.lastResult,de=0;de<F.length;++de){var ge=(fe||F)[de],_e=V[de];ge==null?_e.onerror&&_e.onerror(ne[de]):_e.onsuccess&&_e.onsuccess(N.type==="put"&&W[de]?N.values[de]:ge)}return{failures:ne,results:fe,numFailures:be,lastResult:H}}).catch(function(H){return V.forEach(function(ne){return ne.onerror&&ne.onerror(H)}),Promise.reject(H)})})}}})}})}};function Ri(t,i,u){try{if(!i||i.keys.length<t.length)return null;for(var d=[],p=0,v=0;p<i.keys.length&&v<t.length;++p)$e(i.keys[p],t[v])===0&&(d.push(u?Q(i.values[p]):i.values[p]),++v);return d.length===t.length?d:null}catch{return null}}var Js={stack:"dbcore",level:-1,create:function(t){return{table:function(i){var u=t.table(i);return s(s({},u),{getMany:function(d){if(!d.cache)return u.getMany(d);var p=Ri(d.keys,d.trans._cache,d.cache==="clone");return p?we.resolve(p):u.getMany(d).then(function(v){return d.trans._cache={keys:d.keys,values:d.cache==="clone"?Q(v):v},v})},mutate:function(d){return d.type!=="add"&&(d.trans._cache=null),u.mutate(d)}})}}}};function zi(t,i){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Fi(t,i){switch(t){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Qs={stack:"dbcore",level:0,name:"Observability",create:function(t){var i=t.schema.name,u=new st(t.MIN_KEY,t.MAX_KEY);return s(s({},t),{transaction:function(d,p,v){if(xe.subscr&&p!=="readonly")throw new me.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(xe.querier));return t.transaction(d,p,v)},table:function(d){var p=t.table(d),v=p.schema,x=v.primaryKey,N=v.indexes,T=x.extractKey,B=x.outbound,z=x.autoIncrement&&N.filter(function(R){return R.compound&&R.keyPath.includes(x.keyPath)}),$=s(s({},p),{mutate:function(R){function U(ve){return ve="idb://".concat(i,"/").concat(d,"/").concat(ve),H[ve]||(H[ve]=new st)}var K,F,W,V=R.trans,H=R.mutatedParts||(R.mutatedParts={}),ne=U(""),fe=U(":dels"),be=R.type,_e=R.type==="deleteRange"?[R.range]:R.type==="delete"?[R.keys]:R.values.length<50?[Fn(x,R).filter(function(ve){return ve}),R.values]:[],de=_e[0],ge=_e[1],_e=R.trans._cache;return c(de)?(ne.addKeys(de),(_e=be==="delete"||de.length===ge.length?Ri(de,_e):null)||fe.addKeys(de),(_e||ge)&&(K=U,F=_e,W=ge,v.indexes.forEach(function(ve){var Ie=K(ve.name||"");function Be(je){return je!=null?ve.extractKey(je):null}function Fe(je){return ve.multiEntry&&c(je)?je.forEach(function(pt){return Ie.addKey(pt)}):Ie.addKey(je)}(F||W).forEach(function(je,ot){var Le=F&&Be(F[ot]),ot=W&&Be(W[ot]);$e(Le,ot)!==0&&(Le!=null&&Fe(Le),ot!=null&&Fe(ot))})}))):de?(ge={from:(ge=de.lower)!==null&&ge!==void 0?ge:t.MIN_KEY,to:(ge=de.upper)!==null&&ge!==void 0?ge:t.MAX_KEY},fe.add(ge),ne.add(ge)):(ne.add(u),fe.add(u),v.indexes.forEach(function(ve){return U(ve.name).add(u)})),p.mutate(R).then(function(ve){return!de||R.type!=="add"&&R.type!=="put"||(ne.addKeys(ve.results),z&&z.forEach(function(Ie){for(var Be=R.values.map(function(Le){return Ie.extractKey(Le)}),Fe=Ie.keyPath.findIndex(function(Le){return Le===x.keyPath}),je=0,pt=ve.results.length;je<pt;++je)Be[je][Fe]=ve.results[je];U(Ie.name).addKeys(Be)})),V.mutatedParts=Zr(V.mutatedParts||{},H),ve})}}),N=function(U){var K=U.query,U=K.index,K=K.range;return[U,new st((U=K.lower)!==null&&U!==void 0?U:t.MIN_KEY,(K=K.upper)!==null&&K!==void 0?K:t.MAX_KEY)]},D={get:function(R){return[x,new st(R.key)]},getMany:function(R){return[x,new st().addKeys(R.keys)]},count:N,query:N,openCursor:N};return f(D).forEach(function(R){$[R]=function(U){var K=xe.subscr,F=!!K,W=zi(xe,p)&&Fi(R,U)?U.obsSet={}:K;if(F){var V=function(ge){return ge="idb://".concat(i,"/").concat(d,"/").concat(ge),W[ge]||(W[ge]=new st)},H=V(""),ne=V(":dels"),K=D[R](U),F=K[0],K=K[1];if((R==="query"&&F.isPrimaryKey&&!U.values?ne:V(F.name||"")).add(K),!F.isPrimaryKey){if(R!=="count"){var fe=R==="query"&&B&&U.values&&p.query(s(s({},U),{values:!1}));return p[R].apply(this,arguments).then(function(ge){if(R==="query"){if(B&&U.values)return fe.then(function(Be){return Be=Be.result,H.addKeys(Be),ge});var _e=U.values?ge.result.map(T):ge.result;(U.values?H:ne).addKeys(_e)}else if(R==="openCursor"){var ve=ge,Ie=U.values;return ve&&Object.create(ve,{key:{get:function(){return ne.addKey(ve.primaryKey),ve.key}},primaryKey:{get:function(){var Be=ve.primaryKey;return ne.addKey(Be),Be}},value:{get:function(){return Ie&&H.addKey(ve.primaryKey),ve.value}}})}return ge})}ne.add(u)}}return p[R].apply(this,arguments)}}),$}})}};function ji(t,i,u){if(u.numFailures===0)return i;if(i.type==="deleteRange")return null;var d=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;return u.numFailures===d?null:(i=s({},i),c(i.keys)&&(i.keys=i.keys.filter(function(p,v){return!(v in u.failures)})),"values"in i&&c(i.values)&&(i.values=i.values.filter(function(p,v){return!(v in u.failures)})),i)}function jn(t,i){return u=t,((d=i).lower===void 0||(d.lowerOpen?0<$e(u,d.lower):0<=$e(u,d.lower)))&&(t=t,(i=i).upper===void 0||(i.upperOpen?$e(t,i.upper)<0:$e(t,i.upper)<=0));var u,d}function Ui(t,i,D,d,p,v){if(!D||D.length===0)return t;var x=i.query.index,T=x.multiEntry,B=i.query.range,z=d.schema.primaryKey.extractKey,$=x.extractKey,N=(x.lowLevelIndex||x).extractKey,D=D.reduce(function(R,U){var K=R,F=[];if(U.type==="add"||U.type==="put")for(var W=new st,V=U.values.length-1;0<=V;--V){var H,ne=U.values[V],fe=z(ne);W.hasKey(fe)||(H=$(ne),(T&&c(H)?H.some(function(ve){return jn(ve,B)}):jn(H,B))&&(W.addKey(fe),F.push(ne)))}switch(U.type){case"add":var be=new st().addKeys(i.values?R.map(function(Ie){return z(Ie)}):R),K=R.concat(i.values?F.filter(function(Ie){return Ie=z(Ie),!be.hasKey(Ie)&&(be.addKey(Ie),!0)}):F.map(function(Ie){return z(Ie)}).filter(function(Ie){return!be.hasKey(Ie)&&(be.addKey(Ie),!0)}));break;case"put":var de=new st().addKeys(U.values.map(function(Ie){return z(Ie)}));K=R.filter(function(Ie){return!de.hasKey(i.values?z(Ie):Ie)}).concat(i.values?F:F.map(function(Ie){return z(Ie)}));break;case"delete":var ge=new st().addKeys(U.keys);K=R.filter(function(Ie){return!ge.hasKey(i.values?z(Ie):Ie)});break;case"deleteRange":var _e=U.range;K=R.filter(function(Ie){return!jn(z(Ie),_e)})}return K},t);return D===t?t:(D.sort(function(R,U){return $e(N(R),N(U))||$e(z(R),z(U))}),i.limit&&i.limit<1/0&&(D.length>i.limit?D.length=i.limit:t.length===i.limit&&D.length<i.limit&&(p.dirty=!0)),v?Object.freeze(D):D)}function $i(t,i){return $e(t.lower,i.lower)===0&&$e(t.upper,i.upper)===0&&!!t.lowerOpen==!!i.lowerOpen&&!!t.upperOpen==!!i.upperOpen}function eo(t,i){return function(u,d,p,v){if(u===void 0)return d!==void 0?-1:0;if(d===void 0)return 1;if((d=$e(u,d))===0){if(p&&v)return 0;if(p)return 1;if(v)return-1}return d}(t.lower,i.lower,t.lowerOpen,i.lowerOpen)<=0&&0<=function(u,d,p,v){if(u===void 0)return d!==void 0?1:0;if(d===void 0)return-1;if((d=$e(u,d))===0){if(p&&v)return 0;if(p)return-1;if(v)return 1}return d}(t.upper,i.upper,t.upperOpen,i.upperOpen)}function to(t,i,u,d){t.subscribers.add(u),d.addEventListener("abort",function(){var p,v;t.subscribers.delete(u),t.subscribers.size===0&&(p=t,v=i,setTimeout(function(){p.subscribers.size===0&&Pe(v,p)},3e3))})}var ro={stack:"dbcore",level:0,name:"Cache",create:function(t){var i=t.schema.name;return s(s({},t),{transaction:function(u,d,p){var v,x,T=t.transaction(u,d,p);return d==="readwrite"&&(x=(v=new AbortController).signal,p=function(B){return function(){if(v.abort(),d==="readwrite"){for(var z=new Set,$=0,N=u;$<N.length;$++){var D=N[$],R=Gt["idb://".concat(i,"/").concat(D)];if(R){var U=t.table(D),K=R.optimisticOps.filter(function(Ie){return Ie.trans===T});if(T._explicit&&B&&T.mutatedParts)for(var F=0,W=Object.values(R.queries.query);F<W.length;F++)for(var V=0,H=(be=W[F]).slice();V<H.length;V++)Nn((de=H[V]).obsSet,T.mutatedParts)&&(Pe(be,de),de.subscribers.forEach(function(Ie){return z.add(Ie)}));else if(0<K.length){R.optimisticOps=R.optimisticOps.filter(function(Ie){return Ie.trans!==T});for(var ne=0,fe=Object.values(R.queries.query);ne<fe.length;ne++)for(var be,de,ge,_e=0,ve=(be=fe[ne]).slice();_e<ve.length;_e++)(de=ve[_e]).res!=null&&T.mutatedParts&&(B&&!de.dirty?(ge=Object.isFrozen(de.res),ge=Ui(de.res,de.req,K,U,de,ge),de.dirty?(Pe(be,de),de.subscribers.forEach(function(Ie){return z.add(Ie)})):ge!==de.res&&(de.res=ge,de.promise=we.resolve({result:ge}))):(de.dirty&&Pe(be,de),de.subscribers.forEach(function(Ie){return z.add(Ie)})))}}}z.forEach(function(Ie){return Ie()})}}},T.addEventListener("abort",p(!1),{signal:x}),T.addEventListener("error",p(!1),{signal:x}),T.addEventListener("complete",p(!0),{signal:x})),T},table:function(u){var d=t.table(u),p=d.schema.primaryKey;return s(s({},d),{mutate:function(v){var x=xe.trans;if(p.outbound||x.db._options.cache==="disabled"||x.explicit||x.idbtrans.mode!=="readwrite")return d.mutate(v);var T=Gt["idb://".concat(i,"/").concat(u)];return T?(x=d.mutate(v),v.type!=="add"&&v.type!=="put"||!(50<=v.values.length||Fn(p,v).some(function(B){return B==null}))?(T.optimisticOps.push(v),v.mutatedParts&&Vr(v.mutatedParts),x.then(function(B){0<B.numFailures&&(Pe(T.optimisticOps,v),(B=ji(0,v,B))&&T.optimisticOps.push(B),v.mutatedParts&&Vr(v.mutatedParts))}),x.catch(function(){Pe(T.optimisticOps,v),v.mutatedParts&&Vr(v.mutatedParts)})):x.then(function(B){var z=ji(0,s(s({},v),{values:v.values.map(function($,N){var D;return B.failures[N]?$:($=(D=p.keyPath)!==null&&D!==void 0&&D.includes(".")?Q($):s({},$),X($,p.keyPath,B.results[N]),$)})}),B);T.optimisticOps.push(z),queueMicrotask(function(){return v.mutatedParts&&Vr(v.mutatedParts)})}),x):d.mutate(v)},query:function(v){if(!zi(xe,d)||!Fi("query",v))return d.query(v);var x=((z=xe.trans)===null||z===void 0?void 0:z.db._options.cache)==="immutable",N=xe,T=N.requery,B=N.signal,z=function(U,K,F,W){var V=Gt["idb://".concat(U,"/").concat(K)];if(!V)return[];if(!(K=V.queries[F]))return[null,!1,V,null];var H=K[(W.query?W.query.index.name:null)||""];if(!H)return[null,!1,V,null];switch(F){case"query":var ne=H.find(function(fe){return fe.req.limit===W.limit&&fe.req.values===W.values&&$i(fe.req.query.range,W.query.range)});return ne?[ne,!0,V,H]:[H.find(function(fe){return("limit"in fe.req?fe.req.limit:1/0)>=W.limit&&(!W.values||fe.req.values)&&eo(fe.req.query.range,W.query.range)}),!1,V,H];case"count":return ne=H.find(function(fe){return $i(fe.req.query.range,W.query.range)}),[ne,!!ne,V,H]}}(i,u,"query",v),$=z[0],N=z[1],D=z[2],R=z[3];return $&&N?$.obsSet=v.obsSet:(N=d.query(v).then(function(U){var K=U.result;if($&&($.res=K),x){for(var F=0,W=K.length;F<W;++F)Object.freeze(K[F]);Object.freeze(K)}else U.result=Q(K);return U}).catch(function(U){return R&&$&&Pe(R,$),Promise.reject(U)}),$={obsSet:v.obsSet,promise:N,subscribers:new Set,type:"query",req:v,dirty:!1},R?R.push($):(R=[$],(D=D||(Gt["idb://".concat(i,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[v.query.index.name||""]=R)),to($,R,T,B),$.promise.then(function(U){return{result:Ui(U.result,v,D?.optimisticOps,d,$,x)}})}})}})}};function Yr(t,i){return new Proxy(t,{get:function(u,d,p){return d==="db"?i:Reflect.get(u,d,p)}})}var xt=(Xe.prototype.version=function(t){if(isNaN(t)||t<.1)throw new me.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new me.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var i=this._versions,u=i.filter(function(d){return d._cfg.version===t})[0];return u||(u=new this.Version(t),i.push(u),i.sort(qs),u.stores({}),this._state.autoSchema=!1,u)},Xe.prototype._whenReady=function(t){var i=this;return this.idbdb&&(this._state.openComplete||xe.letThrough||this._vip)?t():new we(function(u,d){if(i._state.openComplete)return d(new me.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void d(new me.DatabaseClosed);i.open().catch(Re)}i._state.dbReadyPromise.then(u,d)}).then(t)},Xe.prototype.use=function(t){var i=t.stack,u=t.create,d=t.level,p=t.name;return p&&this.unuse({stack:i,name:p}),t=this._middlewares[i]||(this._middlewares[i]=[]),t.push({stack:i,create:u,level:d??10,name:p}),t.sort(function(v,x){return v.level-x.level}),this},Xe.prototype.unuse=function(t){var i=t.stack,u=t.name,d=t.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(p){return d?p.create!==d:!!u&&p.name!==u})),this},Xe.prototype.open=function(){var t=this;return jt(gt,function(){return Hs(t)})},Xe.prototype._close=function(){var t=this._state,i=tr.indexOf(this);if(0<=i&&tr.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new we(function(u){t.dbReadyResolve=u}),t.openCanceller=new we(function(u,d){t.cancelOpen=d}))},Xe.prototype.close=function(u){var i=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;i?(u.isBeingOpened&&u.cancelOpen(new me.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new me.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},Xe.prototype.delete=function(t){var i=this;t===void 0&&(t={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",d=this._state;return new we(function(p,v){function x(){i.close(t);var T=i._deps.indexedDB.deleteDatabase(i.name);T.onsuccess=Ze(function(){var B,z,$;B=i._deps,z=i.name,$=B.indexedDB,B=B.IDBKeyRange,On($)||z===Rr||Cn($,B).delete(z).catch(Re),p()}),T.onerror=bt(v),T.onblocked=i._fireOnBlocked}if(u)throw new me.InvalidArgument("Invalid closeOptions argument to db.delete()");d.isBeingOpened?d.dbReadyPromise.then(x):x()})},Xe.prototype.backendDB=function(){return this.idbdb},Xe.prototype.isOpen=function(){return this.idbdb!==null},Xe.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},Xe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Xe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Xe.prototype,"tables",{get:function(){var t=this;return f(this._allTables).map(function(i){return t._allTables[i]})},enumerable:!1,configurable:!0}),Xe.prototype.transaction=function(){var t=(function(i,u,d){var p=arguments.length;if(p<2)throw new me.InvalidArgument("Too few arguments");for(var v=new Array(p-1);--p;)v[p-1]=arguments[p];return d=v.pop(),[i,he(v),d]}).apply(this,arguments);return this._transaction.apply(this,t)},Xe.prototype._transaction=function(t,i,u){var d=this,p=xe.trans;p&&p.db===this&&t.indexOf("!")===-1||(p=null);var v,x,T=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");try{if(x=i.map(function(z){if(z=z instanceof d.Table?z.name:z,typeof z!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return z}),t=="r"||t===gn)v=gn;else{if(t!="rw"&&t!=mn)throw new me.InvalidArgument("Invalid transaction mode: "+t);v=mn}if(p){if(p.mode===gn&&v===mn){if(!T)throw new me.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");p=null}p&&x.forEach(function(z){if(p&&p.storeNames.indexOf(z)===-1){if(!T)throw new me.SubTransaction("Table "+z+" not included in parent transaction.");p=null}}),T&&p&&!p.active&&(p=null)}}catch(z){return p?p._promise(null,function($,N){N(z)}):Ye(z)}var B=(function z($,N,D,R,U){return we.resolve().then(function(){var K=xe.transless||xe,F=$._createTransaction(N,D,$._dbSchema,R);if(F.explicit=!0,K={trans:F,transless:K},R)F.idbtrans=R.idbtrans;else try{F.create(),F.idbtrans._explicit=!0,$._state.PR1398_maxLoop=3}catch(H){return H.name===Qe.InvalidState&&$.isOpen()&&0<--$._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),$.close({disableAutoOpen:!1}),$.open().then(function(){return z($,N,D,null,U)})):Ye(H)}var W,V=Y(U);return V&&er(),K=we.follow(function(){var H;(W=U.call(F,F))&&(V?(H=Tt.bind(null,null),W.then(H,H)):typeof W.next=="function"&&typeof W.throw=="function"&&(W=Rn(W)))},K),(W&&typeof W.then=="function"?we.resolve(W).then(function(H){return F.active?H:Ye(new me.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):K.then(function(){return W})).then(function(H){return R&&F._resolve(),F._completion.then(function(){return H})}).catch(function(H){return F._reject(H),Ye(H)})})}).bind(null,this,v,x,p,u);return p?p._promise(v,B,"lock"):xe.trans?jt(xe.transless,function(){return d._whenReady(B)}):this._whenReady(B)},Xe.prototype.table=function(t){if(!w(this._allTables,t))throw new me.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},Xe);function Xe(t,i){var u=this;this._middlewares={},this.verno=0;var d=Xe.dependencies;this._options=i=s({addons:Xe.addons,autoOpen:!0,indexedDB:d.indexedDB,IDBKeyRange:d.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},d=i.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var p,v,x,T,B,z={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Re,dbReadyPromise:null,cancelOpen:Re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen};z.dbReadyPromise=new we(function(N){z.dbReadyResolve=N}),z.openCanceller=new we(function(N,D){z.cancelOpen=D}),this._state=z,this.name=t,this.on=cr(this,"populate","blocked","versionchange","close",{ready:[oe,Re]}),this.on.ready.subscribe=L(this.on.ready.subscribe,function(N){return function(D,R){Xe.vip(function(){var U,K=u._state;K.openComplete?(K.dbOpenError||we.resolve().then(D),R&&N(D)):K.onReadyBeingFired?(K.onReadyBeingFired.push(D),R&&N(D)):(N(D),U=u,R||N(function F(){U.on.ready.unsubscribe(D),U.on.ready.unsubscribe(F)}))})}}),this.Collection=(p=this,lr(js.prototype,function(W,F){this.db=p;var R=yi,U=null;if(F)try{R=F()}catch(V){U=V}var K=W._ctx,F=K.table,W=F.hook.reading.fire;this._ctx={table:F,index:K.index,isPrimKey:!K.index||F.schema.primKey.keyPath&&K.index===F.schema.primKey.name,range:R,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:U,or:K.or,valueMapper:W!==nt?W:null}})),this.Table=(v=this,lr(wi.prototype,function(N,D,R){this.db=v,this._tx=R,this.name=N,this.schema=D,this.hook=v._allTables[N]?v._allTables[N].hook:cr(null,{creating:[J,Re],reading:[h,nt],updating:[I,Re],deleting:[O,Re]})})),this.Transaction=(x=this,lr(Gs.prototype,function(N,D,R,U,K){var F=this;this.db=x,this.mode=N,this.storeNames=D,this.schema=R,this.chromeTransactionDurability=U,this.idbtrans=null,this.on=cr(this,"complete","error","abort"),this.parent=K||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new we(function(W,V){F._resolve=W,F._reject=V}),this._completion.then(function(){F.active=!1,F.on.complete.fire()},function(W){var V=F.active;return F.active=!1,F.on.error.fire(W),F.parent?F.parent._reject(W):V&&F.idbtrans&&F.idbtrans.abort(),Ye(W)})})),this.Version=(T=this,lr(Vs.prototype,function(N){this.db=T,this._cfg={version:N,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(B=this,lr(Si.prototype,function(N,D,R){if(this.db=B,this._ctx={table:N,index:D===":id"?null:D,or:R},this._cmp=this._ascending=$e,this._descending=function(U,K){return $e(K,U)},this._max=function(U,K){return 0<$e(U,K)?U:K},this._min=function(U,K){return $e(U,K)<0?U:K},this._IDBKeyRange=B._deps.IDBKeyRange,!this._IDBKeyRange)throw new me.MissingAPI})),this.on("versionchange",function(N){0<N.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(N){!N.newVersion||N.newVersion<N.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(N.oldVersion/10))}),this._maxKey=pr(i.IDBKeyRange),this._createTransaction=function(N,D,R,U){return new u.Transaction(N,D,R,u._options.chromeTransactionDurability,U)},this._fireOnBlocked=function(N){u.on("blocked").fire(N),tr.filter(function(D){return D.name===u.name&&D!==u&&!D._state.vcFired}).map(function(D){return D.on("versionchange").fire(N)})},this.use(Js),this.use(ro),this.use(Qs),this.use(Ys),this.use(Xs);var $=new Proxy(this,{get:function(N,D,R){if(D==="_vip")return!0;if(D==="table")return function(K){return Yr(u.table(K),$)};var U=Reflect.get(N,D,R);return U instanceof wi?Yr(U,$):D==="tables"?U.map(function(K){return Yr(K,$)}):D==="_createTransaction"?function(){return Yr(U.apply(this,arguments),$)}:U}});this.vip=$,d.forEach(function(N){return N(u)})}var Xr,mt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",no=(Un.prototype.subscribe=function(t,i,u){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:i,complete:u})},Un.prototype[mt]=function(){return this},Un);function Un(t){this._subscribe=t}try{Xr={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{Xr={indexedDB:null,IDBKeyRange:null}}function Gi(t){var i,u=!1,d=new no(function(p){var v=Y(t),x,T=!1,B={},z={},$={get closed(){return T},unsubscribe:function(){T||(T=!0,x&&x.abort(),N&&Lt.storagemutated.unsubscribe(R))}};p.start&&p.start($);var N=!1,D=function(){return pn(U)},R=function(K){Zr(B,K),Nn(z,B)&&D()},U=function(){var K,F,W;!T&&Xr.indexedDB&&(B={},K={},x&&x.abort(),x=new AbortController,W=function(V){var H=Jt();try{v&&er();var ne=At(t,V);return ne=v?ne.finally(Tt):ne}finally{H&&Qt()}}(F={subscr:K,signal:x.signal,requery:D,querier:t,trans:null}),Promise.resolve(W).then(function(V){u=!0,i=V,T||F.signal.aborted||(B={},function(H){for(var ne in H)if(w(H,ne))return;return 1}(z=K)||N||(Lt(hr,R),N=!0),pn(function(){return!T&&p.next&&p.next(V)}))},function(V){u=!1,["DatabaseClosedError","AbortError"].includes(V?.name)||T||pn(function(){T||p.error&&p.error(V)})}))};return setTimeout(D,0),$});return d.hasValue=function(){return u},d.getValue=function(){return i},d}var Mt=xt;function $n(t){var i=Bt;try{Bt=!0,Lt.storagemutated.fire(t),Bn(t,!0)}finally{Bt=i}}C(Mt,s(s({},De),{delete:function(t){return new Mt(t,{addons:[]}).delete()},exists:function(t){return new Mt(t,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return i=Mt.dependencies,u=i.indexedDB,i=i.IDBKeyRange,(On(u)?Promise.resolve(u.databases()).then(function(d){return d.map(function(p){return p.name}).filter(function(p){return p!==Rr})}):Cn(u,i).toCollection().primaryKeys()).then(t)}catch{return Ye(new me.MissingAPI)}var i,u},defineClass:function(){return function(t){l(this,t)}},ignoreTransaction:function(t){return xe.trans?jt(xe.transless,t):t()},vip:An,async:function(t){return function(){try{var i=Rn(t.apply(this,arguments));return i&&typeof i.then=="function"?i:we.resolve(i)}catch(u){return Ye(u)}}},spawn:function(t,i,u){try{var d=Rn(t.apply(u,i||[]));return d&&typeof d.then=="function"?d:we.resolve(d)}catch(p){return Ye(p)}},currentTransaction:{get:function(){return xe.trans||null}},waitFor:function(t,i){return i=we.resolve(typeof t=="function"?Mt.ignoreTransaction(t):t).timeout(i||6e4),xe.trans?xe.trans.waitFor(i):i},Promise:we,debug:{get:function(){return se},set:function(t){q(t)}},derive:b,extend:l,props:C,override:L,Events:cr,on:Lt,liveQuery:Gi,extendObservabilitySet:Zr,getByKeyPath:te,setByKeyPath:X,delByKeyPath:function(t,i){typeof i=="string"?X(t,i,void 0):"length"in i&&[].map.call(i,function(u){X(t,u,void 0)})},shallowClone:ue,deepClone:Q,getObjectDiff:zn,cmp:$e,asap:j,minKey:-1/0,addons:[],connections:tr,errnames:Qe,dependencies:Xr,cache:Gt,semVer:"4.0.11",version:"4.0.11".split(".").map(function(t){return parseInt(t)}).reduce(function(t,i,u){return t+i/Math.pow(10,2*u)})})),Mt.maxKey=pr(Mt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Lt(hr,function(t){Bt||(t=new CustomEvent(_n,{detail:t}),Bt=!0,dispatchEvent(t),Bt=!1)}),addEventListener(_n,function(t){t=t.detail,Bt||$n(t)}));var ir,Bt=!1,Mi=function(){};return typeof BroadcastChannel<"u"&&((Mi=function(){(ir=new BroadcastChannel(_n)).onmessage=function(t){return t.data&&$n(t.data)}})(),typeof ir.unref=="function"&&ir.unref(),Lt(hr,function(t){Bt||ir.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!xt.disableBfCache&&t.persisted){se&&console.debug("Dexie: handling persisted pagehide"),ir?.close();for(var i=0,u=tr;i<u.length;i++)u[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!xt.disableBfCache&&t.persisted&&(se&&console.debug("Dexie: handling persisted pageshow"),Mi(),$n({all:new st(-1/0,[[]])}))})),we.rejectionMapper=function(t,i){return!t||t instanceof Oe||t instanceof TypeError||t instanceof SyntaxError||!t.name||!He[t.name]?t:(i=new He[t.name](i||t.message,t),"stack"in t&&S(i,"stack",{get:function(){return this.inner.stack}}),i)},q(se),s(xt,Object.freeze({__proto__:null,Dexie:xt,liveQuery:Gi,Entity:vi,cmp:$e,PropModification:fr,replacePrefix:function(t,i){return new fr({replacePrefix:[t,i]})},add:function(t){return new fr({add:t})},remove:function(t){return new fr({remove:t})},default:xt,RangeSet:st,mergeRanges:yr,rangesOverlap:Ni}),{default:xt}),xt})}(an)),an.exports}var Su=Iu();const ci=io(Su),ds=Symbol.for("Dexie"),fn=globalThis[ds]||(globalThis[ds]=ci);if(ci.semVer!==fn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${ci.semVer} and ${fn.semVer}`);const{liveQuery:Bu,mergeRanges:Ru,rangesOverlap:zu,RangeSet:Fu,cmp:ju,Entity:Uu,PropModification:$u,replacePrefix:Gu,add:Mu,remove:Ku}=fn;class Cu extends fn{catalogues;systems;systemrows;constructor(){super("nr-editor"),this.version(6).stores({catalogues:"id, content.catalogue.id, content.catalogue.gameSystemId",systems:"id",systemrows:"id"})}}const rn=new Cu;class Du extends Eu{gameSystem=null;catalogueFiles=yu();allLoaded;loadedCatalogues={};github;unresolvedLinks={};index={};update;async loadData(e,r){return await ln(this,e,r)}findOptionById(e){for(const r of Object.values(this.loadedCatalogues))if(r.index&&r.index[e])return r.index[e]}unloadAll(){super.unloadAll();for(const e of Object.values(this.loadedCatalogues))e.reset();this.loadedCatalogues={},this.index={},delete this.allLoaded}async loadAll(e){let r=Object.values(this.catalogueFiles).length+1,s=0;if(this.allLoaded||console.log("Loading all catalogues in",this.gameSystem?.gameSystem?.name),this.gameSystem){e&&await e(s,r,`Loading ${this.gameSystem.gameSystem.name}`),(await this.loadCatalogue({targetId:this.gameSystem.gameSystem.id})).processForEditor(),s++;for(const o of Object.values(this.catalogueFiles))e&&await e(s,r,`Loading ${o.catalogue.name}`),(await this.loadCatalogue({targetId:o.catalogue.id})).processForEditor(),s++,e&&await e(s,r,`Loading ${o.catalogue.name}`)}this.allLoaded=!0}getLoadedCatalogue(e,r){const s=e.targetId||e.name;return this.loadedCatalogues[s]}addLoadedCatalogue(e,r){this.loadedCatalogues[e.id]=e}getAllLoadedCatalogues(){return this.gameSystem?.gameSystem.id?Object.values(this.loadedCatalogues):[]}getId(){return this.gameSystem?.gameSystem.id}getCatalogueInfo(e){if(this.gameSystem?.gameSystem.id===e.targetId)return this.gameSystem?.gameSystem;for(const r of Object.values(this.catalogueFiles))if(r.catalogue.id===e.targetId)return r.catalogue}getAllCatalogueFiles(){return[...this.gameSystem?[this.gameSystem]:[],...Object.values(this.catalogueFiles)]}setSystem(e){this.gameSystem=e;const r=rn.systems.put({id:e.gameSystem.id,content:e});return this.update&&this.update(e),r}setCatalogue(e){const r=e.catalogue.id;this.catalogueFiles[r]=e;const s=rn.catalogues.put({id:e.catalogue.id,content:e});return this.update&&this.update(e),s}removeCatalogue(e){for(const[r,s]of Object.entries(this.catalogueFiles))s.catalogue.id===e.catalogue.id&&delete this.catalogueFiles[r]}async getData(e,r){if(e.targetId==this.gameSystem?.gameSystem.id)return this.gameSystem;if(e.targetId in this.catalogueFiles)return this.catalogueFiles[e.targetId];const s=await rn.catalogues.get({"content.catalogue.id":e.targetId});if(s)return s.content;const a=await rn.systems.get(e.targetId);if(a)return a.content;const o=e.name?`name ${e.name}`:`id ${e.targetId}`;throw Error(`Couldn't import catalogue with ${o}, perhaps it wasnt uploaded?`)}}export{Du as G,rs as a,Pu as c,qi as f,Tu as g,Nu as i,Ou as n,Au as p};
//# sourceMappingURL=hOP14oPP.js.map
